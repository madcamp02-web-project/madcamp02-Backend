# âš™ï¸ MadCamp02: ë°±ì—”ë“œ ê°œë°œ ê³„íšì„œ

**Ver 2.7.21 - Backend Development Blueprint (Spec-Driven Alignment)**

---

## ğŸ“ ë³€ê²½ ì´ë ¥

| ë²„ì „      | ë‚ ì§œ           | ë³€ê²½ ë‚´ìš©                                                                                           | ì‘ì„±ì        |
| --------- | -------------- | --------------------------------------------------------------------------------------------------- | ------------- |
| 1.0       | 2026-01-15     | ì´ˆê¸° ëª…ì„¸ì„œ ì‘ì„±                                                                                    | MadCamp02     |
| 2.0       | 2026-01-16     | Exception êµ¬ì¡° ì •ë¦¬, ErrorResponse DTO ì¶”ê°€                                                         | MadCamp02     |
| 2.1       | 2026-01-17     | ì¹´ì¹´ì˜¤ OAuth, ì¼ë°˜ íšŒì›ê°€ì…/ë¡œê·¸ì¸ ì¶”ê°€                                                             | MadCamp02     |
| 2.2       | 2026-01-17     | OAuth2 ë°±ì—”ë“œ ì£¼ë„ ë°©ì‹ìœ¼ë¡œ ë³€ê²½                                                                    | MadCamp02     |
| 2.3       | 2026-01-18     | í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„ í˜„í™© ë°˜ì˜ (Market, Shop, Trade í˜ì´ì§€ API ì¶”ê°€)                                     | MadCamp02     |
| 2.4       | 2026-01-18     | í†µí•© ëª…ì„¸ì„œ ë° í”„ë¡ íŠ¸ ê³„íš ì™„ì „ ë™ê¸°í™”                                                              | MadCamp02     |
| 2.5       | 2026-01-18     | í†µí•© ëª…ì„¸ì„œ(FULL_SPECIFICATION)ì™€ ë²„ì „ ë™ê¸°í™” ë° ìµœì¢… ì ê²€                                          | MadCamp02     |
| **2.6**   | **2026-01-18** | **í•˜ì´ë¸Œë¦¬ë“œ ì¸ì¦ ë°©ì‹(Frontend/Backend Driven) ëª…ì„¸ ë°˜ì˜ ë° êµ¬í˜„ í˜„í™© ì ê²€**                       | **MadCamp02** |
| **2.7**   | **2026-01-18** | **3ê°œ ë¬¸ì„œ ë²„ì „ ë™ê¸°í™” ë° ì—”ë“œí¬ì¸íŠ¸/ìš©ì–´ ë¬¸êµ¬ ì •ë¦¬(í”„ë¡ íŠ¸ ì—°ë™ ê¸°ì¤€)**                             | **MadCamp02** |
| **2.7.1** | **2026-01-18** | **Phase 0: ì‘ë‹µ DTO(ìµœì†Œ í•„ë“œ) ê·œì•½ì„ FULL_SPECì— ê³ ì • + STOMP(`/ws-stomp`) ì„¤ì •/ë³´ì•ˆ ì˜ˆì™¸ ê³ ì •**   | **MadCamp02** |
| **2.7.2** | **2026-01-18** | **í…ŒìŠ¤íŠ¸ ê²½ë¡œ ì •ê·œí™”(src/test/java) + CIì—ì„œ â€œì‹¤ì œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰â€ì„ ìœ„í•œ í›„ì†(CI/CD) ì‘ì—… í•­ëª© ëª…ì‹œ** | **MadCamp02** |
| **2.7.3** | **2026-01-18** | **Phase 1: `items.category` ë ˆê±°ì‹œâ†’ëª©í‘œ ë§¤í•‘ í‘œ ë° Unknown ê°’ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨(raise) ì •ì±… ê³ ì •**  | **MadCamp02** |
| **2.7.4** | **2026-01-18** | **Phase 2 í™•ì¥: ì •ë°€ ì‚¬ì£¼ ê³„ì‚°(ì„±ë³„/ì–‘ë ¥ìŒë ¥/ì‹œê°„ í¬í•¨) ë° íƒ€ì¸ í”„ë¡œí•„ ê³µê°œ API DTO ë¶„ë¦¬**          | **MadCamp02** |
| **2.7.5** | **2026-01-18** | **Phase 2 ì™„ì„±: ì›”ì£¼/ì‹œì£¼ ê³„ì‚° êµ¬í˜„, í•œêµ­ì²œë¬¸ì—°êµ¬ì› API ì—°ë™(ì–‘ë ¥â†”ìŒë ¥ ë³€í™˜), ë ˆê±°ì‹œ í˜¸í™˜ ì œê±°**    | **MadCamp02** |
| **2.7.6** | **2026-01-19** | **ë°ì´í„° ì „ëµ ë°˜ì˜: EODHD + DB ìºì‹± ì „ëµ, WebSocket êµ¬ë… ê´€ë¦¬ì(LRU), Quota ê´€ë¦¬ ë¡œì§, API ì œí•œ ëŒ€ì‘** | **MadCamp02** |
| **2.7.7** | **2026-01-19** | **EODHD ë¬´ë£Œ êµ¬ë… ì œí•œ(ìµœê·¼ 1ë…„) ì£¼ì˜ì‚¬í•­ ì¶”ê°€, ì™¸ë¶€ API í™•ì¥ ì „ëµ(Phase 9) ì¶”ê°€** | **MadCamp02** |
| **2.7.8** | **2026-01-19** | **ì§€ìˆ˜ ì¡°íšŒë¥¼ ETFë¡œ ë³€ê²½ (Finnhub Quote APIëŠ” ì§€ìˆ˜ ì‹¬ë³¼ ë¯¸ì§€ì›) - SPY, QQQ, DIA ì‚¬ìš©** | **MadCamp02** |
| **2.7.9** | **2026-01-19** | **Phase 4: Trade/Portfolio Engine ì™„ì „ êµ¬í˜„ ë° ë¬¸ì„œ í†µí•© (íŠ¸ëœì­ì…˜/ë½ ì „ëµ, ë‹¤ì´ì–´ê·¸ë¨ í¬í•¨)** | **MadCamp02** |
| **2.7.10** | **2026-01-19** | **Phase 5: Game/Shop/Ranking API êµ¬í˜„ ì™„ë£Œ (ê°€ì± /ì¸ë²¤í† ë¦¬/ì¥ì°©/ë­í‚¹)** | **MadCamp02** |
| **2.7.11** | **2026-01-19** | **í”„ë¡ íŠ¸ 2.7.11 ìŠ¤ëƒ…ìƒ· ë°˜ì˜, Phase 5 ì™„ë£Œ ìƒíƒœ ê¸°ë°˜ â€œPhase 5.5: í”„ë¡ íŠ¸ ì—°ë™Â·DB ì œì•½ ë³´ê°•â€ ê³„íš ì¶”ê°€(Shop/Gacha/Inventory/Ranking ì‹¤ë°ì´í„° ì „í™˜, `{items:[]}`Â·ì¹´í…Œê³ ë¦¬/ETF/STOMP ì •í•©ì„± ê³ ì •)** | **MadCamp02** |
| **2.7.12** | **2026-01-19** | **Phase 5.5 ì‹¤í–‰: Game/Shop/Inventory/Ranking ì—ëŸ¬ ì½”ë“œÂ·DB ì œì•½Â·í”„ë¡ íŠ¸ ì—°ë™ ê°€ì´ë“œ ìµœì¢… ë°˜ì˜(GAME_001~003, items.category CHECK, is_ranking_joined í•„í„° ê²€ì¦)** | **MadCamp02** |
| **2.7.13** | **2026-01-19** | **Phase 6 ì‹¤í–‰: Finnhub Trades WebSocket ì—°ë™ ì™„ë£Œ - ì‹±ê¸€í†¤ í´ë¼ì´ì–¸íŠ¸, ë©”ì‹œì§€ íŒŒì‹±/ì •ê·œí™”, Redis/STOMP ë¸Œë¡œë“œìºìŠ¤íŠ¸, destination ì•ˆì „ì„± ì •ì±… ê³ ì •** | **MadCamp02** |
| **2.7.14** | **2026-01-19** | **Phase 4~6 êµ¬í˜„ ì½”ë“œ ê¸°ì¤€ Game/Trade/Realtime(WebSocket) ì •í•©ì„± ì¬ì •ë¦¬ ë° ìƒíƒœ í…Œì´ë¸”/í˜ì´ë¡œë“œÂ·destination ì„¤ëª… ë³´ì™„** | **MadCamp02** |
| **2.7.15** | **2026-01-19** | **Phase 3.6: ë°±ì—”ë“œ Redis ìºì‹± í™•ì¥ (Market Indices/News/Movers) ë° í”„ë¡ íŠ¸ì—”ë“œ ì´ì¤‘ ìºì‹± ì „ëµ ìˆ˜ë¦½** | **MadCamp02** |
| **2.7.16** | **2026-01-19** | **Phase 3.4: Candles API ë‚ ì§œ ë²”ìœ„ í•„í„°ë§ êµ¬í˜„ ì™„ë£Œ ë‚´ìš© ë¬¸ì„œí™” (period í•„ë“œ, ë°°ì¹˜ ë¡œë“œ ì „ëµ, Quota ê´€ë¦¬ ìƒì„¸ ëª…ì„¸ ì¶”ê°€)** | **MadCamp02** |
| **2.7.17** | **2026-01-20** | **Kakao ë™ì˜ ìŠ¤ì½”í”„ë¥¼ `profile_nickname` ë‹¨ì¼ë¡œ ì¶•ì†Œ, ì´ë©”ì¼ ë¯¸ìš”ì²­ ì‹œ ë°±ì—”ë“œê°€ ì„ì˜ ì´ë©”ì¼(`kakao-{timestamp}-{random}@auth.madcamp02.local`)ì„ ìƒì„±Â·ì¤‘ë³µ ê²€ì‚¬ í›„ ê°€ì…í•˜ë„ë¡ í”„ë¡œë¹„ì €ë‹ ë¡œì§ ë³´ê°•(í•˜ì´ë¸Œë¦¬ë“œ OAuth ê³µí†µ)** | **MadCamp02** |
| **2.7.18** | **2026-01-20** | **`POST /api/v1/user/onboarding`ê°€ ìµœì´ˆ ì˜¨ë³´ë”©ê³¼ ë§ˆì´í˜ì´ì§€ ì‚¬ì£¼ ì •ë³´ ìˆ˜ì • ì‹œ ì¬ê³„ì‚°(ì¬ì˜¨ë³´ë”©)ì„ ëª¨ë‘ ì²˜ë¦¬í•˜ëŠ” idempotent ì—”ë“œí¬ì¸íŠ¸ì„ì„ ëª…ì‹œí•˜ê³ , ì¬ì˜¨ë³´ë”© ì‹œ `users.*` ì‚¬ì£¼ ê´€ë ¨ ì»¬ëŸ¼ì„ ì•ˆì „í•˜ê²Œ ë®ì–´ì“°ë„ë¡ ì •ì±…ì„ ê³ ì •. ì˜¨ë³´ë”© ì™„ë£Œ ì—¬ë¶€ëŠ” ë³„ë„ í”Œë˜ê·¸ ì—†ì´ `users.birth_date + users.saju_element` ì¡°í•©ìœ¼ë¡œ í•´ì„í•¨ì„ ëª…ì‹œ.** | **MadCamp02** |
| **2.7.19** | **2026-01-21** | **í™˜ìœ¨ í…Œì´ë¸”(`exchange_rates`) ë° í•œêµ­ìˆ˜ì¶œì…ì€í–‰ Open API ê¸°ë°˜ í™˜ìœ¨ ìˆ˜ì§‘ ë°°ì¹˜/ì¡°íšŒ API(`/api/v1/exchange-rates`) ì„¤ê³„Â·êµ¬í˜„ í˜„í™©ê³¼ Calc API(ë°°ë‹¹/ì„¸ê¸ˆ ê³„ì‚°) 1ì°¨ ë²„ì „ ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°/ì‘ë‹µ ê·œì•½ì„ ë¬¸ì„œì— ë°˜ì˜. ì˜¨ë³´ë”© ì „ìš© ì—ëŸ¬ ì½”ë“œ(ONBOARDING_001~003)ì™€ `User.hasCompletedOnboarding()` í—¬í¼ ë„ì…ì„ ê³„íšì„œì— ê¸°ë¡.** | **MadCamp02** |
| **2.7.20** | **2026-01-21** | **`GET /api/v1/auth/me` ì‘ë‹µì— `birthDate` í•„ë“œë¥¼ í¬í•¨í•˜ë„ë¡ `AuthResponse`Â·`AuthController.me`Â·`AuthService`ë¥¼ ì •ë¦¬í•˜ê³ , `User.hasCompletedOnboarding()` ê¸°ì¤€(`birthDate + sajuElement`)ì— ë§ì¶° ì˜¨ë³´ë”© ê°•ì œ í”Œë¡œìš°(ë°±ì—”ë“œ/í”„ë¡ íŠ¸ `hasCompletedOnboarding(user)`/AuthGuard)ê°€ ì‹¤ì œ êµ¬í˜„ê³¼ ì •í•©í•˜ê²Œ ë™ì‘í•¨ì„ í™•ì¸. ê°œë°œ/í…ŒìŠ¤íŠ¸ ê³„ì • ë”ë¯¸ ë°ì´í„°(`V7__insert_test_data.sql`)ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ê³µí†µ ê°’(í‰ë¬¸ `Password123!`)ìœ¼ë¡œ í†µì¼í•˜ê³  ì£¼ì„ìœ¼ë¡œ ëª…ì‹œí•˜ì—¬ ë¡œê·¸ì¸ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë¬¸ì„œí™”.** | **MadCamp02** |
| **2.7.21** | **2026-01-21** | **í”„ë¡ íŠ¸ ì—°ë™ ë¬¸ì„œ(`FRONTEND_API_WIRING`)ì™€ 3ëŒ€ ìŠ¤í™ ë¬¸ì„œ(Backend/Frontend Plan, Full Spec)ì˜ â€œí˜„ì¬ê¹Œì§€ ì™„ë£Œëœ êµ¬í˜„/ì—°ë™â€ì„ ë‹¨ì¼ ìš”ì•½ ì„¹ì…˜ìœ¼ë¡œ í†µí•© ì •ë¦¬(ê³„ì•½/í˜„í™©/ë¯¸ì™„ë£Œ í•­ëª© ë¶„ë¦¬).** | **MadCamp02** |
| **2.7.22** | **2026-01-21** | **AI ê´€ë ¨ ìƒì„¸ ìŠ¤í™(ëª¨ë¸ ì „ëµ, FastAPI AI Gateway, Spring SSE í”„ë¡ì‹œ, `/oracle` ì—°ë™)ì€ `docs/AI_SERVER_SPEC.md` 1.1.0ìœ¼ë¡œ ì´ì „í•˜ê³ , ë³¸ ë¬¸ì„œì—ëŠ” AI ì—°ë™ì„ ìš”ì•½+ì°¸ì¡° í˜•íƒœë¡œë§Œ ìœ ì§€í•˜ë„ë¡ ì •ë¦¬** | **MadCamp02** |

### Ver 2.6 ì£¼ìš” ë³€ê²½ ì‚¬í•­

1.  **ì¸ì¦ ì•„í‚¤í…ì²˜ í˜„ì‹¤í™”**: ì‹¤ì œ ì½”ë“œ(`SecurityConfig`, `AuthController`)ì— êµ¬í˜„ëœ **í•˜ì´ë¸Œë¦¬ë“œ ì¸ì¦(Hybrid Auth)** ë°©ì‹ì„ ëª…ì„¸ì— ë°˜ì˜. ë°±ì—”ë“œ ì£¼ë„(Redirect)ì™€ í”„ë¡ íŠ¸ì—”ë“œ ì£¼ë„(Token API) ë°©ì‹ì„ ëª¨ë‘ ì§€ì›í•¨.
2.  **êµ¬í˜„ í˜„í™© ì¶”ì **: í˜„ì¬ ì½”ë“œë² ì´ìŠ¤ ìƒíƒœì™€ ëª…ì„¸ì„œ ê°„ì˜ ê°­(Gap)ì„ ë¶„ì„í•˜ì—¬ 'êµ¬í˜„ í˜„í™©' ì„¹ì…˜ ì¶”ê°€.

### Ver 2.7 ì£¼ìš” ë³€ê²½ ì‚¬í•­

1.  **ì •í•©ì„± ê¸°ì¤€ ê³ ì •**: `FULL_SPECIFICATION` ë° í”„ë¡ íŠ¸/ë°±ì—”ë“œ ê°œë°œ ê³„íšì„œ(2.7)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ API/ì‹¤ì‹œê°„/ì¸ì¦ ì¸í„°í˜ì´ìŠ¤ë¥¼ ê³ ì •í•˜ê³ , êµ¬í˜„ì„ ê·¸ ê¸°ì¤€ì— ë§ì¶° ì§„í–‰.
2.  **í”„ë¡ íŠ¸ ì—°ë™ ìš°ì„ ìˆœìœ„ ë°˜ì˜**: (1) Hybrid Auth Callback/í† í° ì €ì¥ â†’ (2) `lib/api` ëª¨ë“ˆí™” ë° 401 Refresh/Retry â†’ (3) í˜ì´ì§€ ì‹¤ë°ì´í„° ì¹˜í™˜ â†’ (4) STOMP/SSE ì‹¤ì‹œê°„ ìˆœìœ¼ë¡œ ì—°ë™.
3.  **í–¥í›„ ì‹¤í–‰ ê³„íš ì¶”ê°€**: `FRONTEND_DEVELOPMENT_PLAN`, `FULL_SPECIFICATION`ì„ ê¸°ì¤€ìœ¼ë¡œ ë°±ì—”ë“œ êµ¬í˜„ ìˆœì„œ/ì‚°ì¶œë¬¼ì„ ë¬¸ì„œ í•˜ë‹¨ì— ëª…ì‹œ.

### Ver 2.7.1 ì£¼ìš” ë³€ê²½ ì‚¬í•­

1.  **ì‘ë‹µ DTO ìŠ¤í‚¤ë§ˆ ê³ ì •**: í”„ë¡ íŠ¸ ì—°ë™ì„ ìœ„í•´ Market/Portfolio/Inventory/Rankingì˜ â€œìµœì†Œ í•„ë“œâ€ë¥¼ `docs/FULL_SPECIFICATION.md`ì˜ **5.0 ê³µí†µ ì‘ë‹µ ê·œì•½**ìœ¼ë¡œ ê³ ì •.
2.  **STOMP ì—”ë“œí¬ì¸íŠ¸ ê³ ì •**: ë¬¸ì„œ/ì½”ë“œ ì •í•©ì„± ê¸°ì¤€ìœ¼ë¡œ `/ws-stomp`ë¥¼ ê³ ì •í•˜ê³ , ë³´ì•ˆ ì˜ˆì™¸ë„ ë™ì¼í•˜ê²Œ ì •ë ¬.

### Ver 2.7.2 ì£¼ìš” ë³€ê²½ ì‚¬í•­

1.  **í…ŒìŠ¤íŠ¸ ê²½ë¡œ ì •ê·œí™”(ì •ì„)**: í…ŒìŠ¤íŠ¸ ì†ŒìŠ¤ë¥¼ `src/test/java` í‘œì¤€ ê²½ë¡œë¡œ í†µì¼í•˜ì—¬ Gradle/CIì—ì„œ í…ŒìŠ¤íŠ¸ íƒì§€ê°€ ì•ˆì •ì ìœ¼ë¡œ ë™ì‘í•˜ë„ë¡ ì •ë¦¬.
2.  **CI/CD í›„ì† ì‘ì—… ëª…ì‹œ**: í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ â€œí•­ìƒ í†µê³¼â€ì‹œí‚¤ê¸° ìœ„í•œ ì „ëµ(ì„œë¹„ìŠ¤ ì»¨í…Œì´ë„ˆ vs í…ŒìŠ¤íŠ¸ í”„ë¡œíŒŒì¼)ì„ ë¬¸ì„œí™”í•˜ê³  Phaseë¡œ ë¶„ë¦¬.

### Ver 2.7.3 ì£¼ìš” ë³€ê²½ ì‚¬í•­

1.  **`items.category` ë ˆê±°ì‹œ ì •í•©í™” ì •ì±… ê³ ì •**: Flyway V3ì—ì„œì˜ ë ˆê±°ì‹œâ†’ëª©í‘œ ë§¤í•‘ í‘œë¥¼ ëª…ì‹œí•˜ê³ , Unknown ê°’ ë°œê²¬ ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ ì‹¤íŒ¨(raise)ì‹œí‚¤ëŠ” Fail Fast ì •ì±…ì„ ê³ ì •.

### Ver 2.7.4 ì£¼ìš” ë³€ê²½ ì‚¬í•­

1.  **ì •ë°€ ì‚¬ì£¼ ê³„ì‚° í™•ì¥**: Phase 2ì—ì„œ ì„±ë³„(`gender`), ì–‘ë ¥/ìŒë ¥ êµ¬ë¶„(`calendar_type`), ìƒë…„ì›”ì¼ì‹œ(`birth_time`)ê¹Œì§€ í¬í•¨í•œ ì •ë°€ ì‚¬ì£¼ ê³„ì‚°ìœ¼ë¡œ í™•ì¥. Flyway V4ë¡œ `users` í…Œì´ë¸”ì— `birth_time`(TIME), `gender`(VARCHAR), `calendar_type`(VARCHAR) ì»¬ëŸ¼ ì¶”ê°€.
2.  **íƒ€ì¸ í”„ë¡œí•„ ê³µê°œ API DTO ë¶„ë¦¬**: `UserMeResponse`(ë‚´ ì •ë³´, email í¬í•¨)ì™€ `UserPublicResponse`(íƒ€ì¸ ì •ë³´, email ì œì™¸)ë¥¼ ë¶„ë¦¬í•˜ì—¬ ë³´ì•ˆ ê°•í™”.
3.  **SajuCalculator ì •ë°€ ê³„ì‚° í™•ì¥**: `calculatePrecise()` ë©”ì„œë“œ ì¶”ê°€ë¡œ ì—°ì£¼/ì›”ì£¼/ì¼ì£¼/ì‹œì£¼ê¹Œì§€ í¬í•¨í•œ ì •ë°€ ì‚¬ì£¼ ê³„ì‚° ì§€ì›.

### Ver 2.7.5 ì£¼ìš” ë³€ê²½ ì‚¬í•­

1.  **ì›”ì£¼/ì‹œì£¼ ê³„ì‚° ì™„ì „ êµ¬í˜„**: ì—°ì£¼/ì›”ì£¼/ì¼ì£¼/ì‹œì£¼ 4ì£¼(å››æŸ±) ëª¨ë‘ ê³„ì‚°í•˜ì—¬ ì •ë°€ ì‚¬ì£¼ ì‚°ì¶œ. ìµœì¢… ì˜¤í–‰ì€ ì¼ì£¼(æ—¥æŸ±)ì˜ ì²œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ë„ì¶œ.
2.  **í•œêµ­ì²œë¬¸ì—°êµ¬ì› API ì—°ë™**: ê³µê³µë°ì´í„°í¬í„¸ì˜ "í•œêµ­ì²œë¬¸ì—°êµ¬ì›\_ìŒì–‘ë ¥ ì •ë³´" APIë¥¼ í†µí•©í•˜ì—¬ ì–‘ë ¥â†”ìŒë ¥ ì •í™•í•œ ë³€í™˜ ì§€ì›. `LunarCalendarClient` êµ¬í˜„.
3.  **ë ˆê±°ì‹œ í˜¸í™˜ ì œê±°**: ì„œë¹„ìŠ¤ ì‹œì‘ ì „ ë‹¨ê³„ì´ë¯€ë¡œ ë ˆê±°ì‹œ ë°ì´í„°ê°€ ì—†ì–´ ê¸°ì¡´ `calculate(LocalDate)` ë©”ì„œë“œ ì œê±°. ëª¨ë“  ê³„ì‚°ì€ `calculatePrecise()`ë¡œ í†µì¼.
4.  **ì‹œê°„ ê¸°ë³¸ê°’ ë³€ê²½**: ìƒë…„ì›”ì¼ì‹œ ëª¨ë¥¼ ê²½ìš° ê¸°ë³¸ê°’ì„ `12:00:00`ì—ì„œ `00:00:00`ìœ¼ë¡œ ë³€ê²½.

### Ver 2.7.6 ì£¼ìš” ë³€ê²½ ì‚¬í•­

1.  **ë°ì´í„° ì „ëµ ìˆ˜ë¦½**: `docs/DATA_STRATEGY_PLAN.md` ê¸°ë°˜ìœ¼ë¡œ ë¬´ë£Œ API ì œí•œ(Finnhub Premium, EODHD ì¼ì¼ 20íšŒ) ê·¹ë³µ ì „ëµ ìˆ˜ë¦½.
2.  **EODHD + DB ìºì‹± ì „ëµ**: Historical Candles ë°ì´í„°ë¥¼ DBì— ì €ì¥í•˜ê³  API ì‘ë‹µì€ í•­ìƒ DBì—ì„œ ì œê³µ. Quota ê´€ë¦¬ ë¡œì§ ì¶”ê°€.
3.  **WebSocket êµ¬ë… ê´€ë¦¬ì**: Finnhub 50 Symbols ì œí•œ ëŒ€ì‘ì„ ìœ„í•œ Dynamic Subscription Manager (LRU ê¸°ë°˜) êµ¬í˜„ ê³„íš ì¶”ê°€.
4.  **Market Movers ìºì‹±**: Redis ê¸°ë°˜ 1ë¶„~5ë¶„ ìºì‹± ì „ëµ ëª…ì‹œ.
5.  **ì—ëŸ¬ ì²˜ë¦¬**: Quota ì´ˆê³¼ ì‹œ Case A(ê¸°ì¡´ ë°ì´í„° ë°˜í™˜ + Stale í‘œì‹œ) ë˜ëŠ” Case B(429 ì—ëŸ¬) ë¶„ê¸° ì²˜ë¦¬ ëª…ì‹œ.

---

## âœ… í˜„ì¬ê¹Œì§€ ì™„ë£Œëœ êµ¬í˜„/ì—°ë™ ìš”ì•½ (Snapshot)

> ëª©ì : â€œì§€ê¸ˆ ë‹¹ì¥ ëŒì•„ê°€ëŠ” ê²ƒ(ì™„ë£Œ)â€ê³¼ â€œë°±ì—”ë“œê°€ ìœ ì§€í•´ì•¼ í•  ê³„ì•½(í•„ìˆ˜)â€ì„ í•œ ëˆˆì— ê³ ì •í•©ë‹ˆë‹¤.  
> ìƒì„¸ í”„ë¡ íŠ¸ ê´€ì  ì—°ê²° ìƒíƒœëŠ” `docs/FRONTEND_API_WIRING.md`ë¥¼ ë‹¨ì¼ ì§„ì‹¤ë¡œ í•¨ê»˜ ì°¸ê³ í•©ë‹ˆë‹¤.

### 1) ì¸ì¦/Auth (Hybrid)

- **ì™„ë£Œ**
  - `POST /api/v1/auth/signup|login|refresh`, `GET /api/v1/auth/me`
  - Frontend-Driven: `POST /api/v1/auth/oauth/kakao|google`
  - Backend-Driven: `/oauth2/authorization/{provider}` â†’ `/oauth/callback` ë¦¬ë‹¤ì´ë ‰íŠ¸
- **ê³„ì•½(ì¤‘ìš”)**
  - `GET /api/v1/auth/me`ëŠ” í”„ë¡ íŠ¸ `hasCompletedOnboarding(user)` íŒë‹¨ì„ ìœ„í•´ `birthDate`, `sajuElement`(ë˜ëŠ” `saju.element`)ë¥¼ **í•­ìƒ** í¬í•¨
  - Kakao ìŠ¤ì½”í”„ëŠ” `profile_nickname`ë§Œ í•„ìˆ˜, ì´ë©”ì¼ ë¯¸ì œê³µ ì‹œ ë°±ì—”ë“œê°€ ì„ì˜ ì´ë©”ì¼ í”„ë¡œë¹„ì €ë‹

### 2) ì˜¨ë³´ë”©/User

- **ì™„ë£Œ**
  - `POST /api/v1/user/onboarding`ëŠ” **ìµœì´ˆ ì˜¨ë³´ë”© + ì¬ì˜¨ë³´ë”©(ë§ˆì´í˜ì´ì§€ ì‚¬ì£¼ ì¬ê³„ì‚°)**ì„ ëª¨ë‘ ì²˜ë¦¬í•˜ëŠ” **idempotent** ì—”ë“œí¬ì¸íŠ¸
  - `GET/PUT /api/v1/user/me`, `GET /api/v1/user/wallet`, Watchlist CRUD
- **ê³„ì•½(ì¤‘ìš”)**
  - ì˜¨ë³´ë”© ì „ìš© ì—ëŸ¬ ì½”ë“œ: `ONBOARDING_001~003`ë¥¼ `ErrorResponse.error`ë¡œ ë‚´ë ¤ì£¼ê³ (ê°€ëŠ¥í•˜ë©´ `fieldErrors` í¬í•¨) í”„ë¡ íŠ¸ê°€ ì½”ë“œ ê¸°ë°˜ UXë¥¼ ìœ ì§€í•  ìˆ˜ ìˆê²Œ í•¨

### 3) Market/Stock (ìºì‹± í¬í•¨)

- **ì™„ë£Œ**
  - Market: `GET /api/v1/market/indices|news|movers` (ETF: SPY/QQQ/DIA)
  - Stock: search/quote/candles/orderbook ë“± í”„ë¡ íŠ¸ê°€ ìš”êµ¬í•˜ëŠ” REST ê³„ì•½ ê¸°ë°˜ ì—°ë™
- **ê³„ì•½(ì¤‘ìš”)**
  - `/api/v1/market/**`ëŠ” `X-Cache-Status`, `X-Cache-Age`, `X-Data-Freshness` í—¤ë”ë¥¼ ì¼ê´€ë˜ê²Œ í¬í•¨(í”„ë¡ íŠ¸ëŠ” í—¤ë”ë¥¼ UI ë°°ì§€ë¡œ ë…¸ì¶œ)
  - CandlesëŠ” EODHD ë¬´ë£Œ ì œí•œ(ìµœê·¼ 1ë…„) + Quota ì •ì±…ì— ë”°ë¥¸ `stale`/ì—ëŸ¬ ë¶„ê¸° ìœ ì§€

### 4) Trade/Portfolio Engine

- **ì™„ë£Œ**
  - `GET /api/v1/trade/available-balance|portfolio|history`, `POST /api/v1/trade/order`
  - ë¹„ê´€ì  ë½/íŠ¸ëœì­ì…˜ ì „ëµ ë° í…ŒìŠ¤íŠ¸ ë¬¸ì„œí™”

### 5) Game/Shop/Inventory/Ranking

- **ì™„ë£Œ**
  - `GET /api/v1/game/items|inventory|ranking`, `POST /api/v1/game/gacha`, `PUT /api/v1/game/equip/{itemId}`
  - ì¹´í…Œê³ ë¦¬ ê·œì•½ `NAMEPLATE|AVATAR|THEME`, ê°€ì±  ì—ëŸ¬ ì½”ë“œ `GAME_001~003`

### 6) Calc/FX (1ì°¨ ë²„ì „)

- **ì™„ë£Œ(1ì°¨)**
  - Calc: `GET /api/v1/calc/dividend`, `GET /api/v1/calc/tax` (USD ê¸°ì¤€ ê³„ì‚°, `currency=null`)
  - FX: `exchange_rates` í…Œì´ë¸” ë° `/api/v1/exchange-rates`, `/api/v1/exchange-rates/latest` (ì„¤ê³„/êµ¬í˜„ í˜„í™© ë°˜ì˜)

### 7) ë¯¸ì™„ë£Œ/í›„ì†

- **AI(SSE) ì—°ë™**: `POST /api/v1/chat/ask`ì˜ SSE í”„ë¡ì‹œ/ì €ì¥/ìŠ¤íŠ¸ë¦¬ë° UXëŠ” ê³„íš ëŒ€ë¹„ ë¯¸ì™„(í”„ë¡ íŠ¸ëŠ” HTTP í˜¸ì¶œ ê¸°ë°˜, SSEëŠ” í›„ì†)
- **ê´€ë¦¬ì ê¸°ëŠ¥/í™•ì¥ ì „ëµ**: Market Movers ê´€ë¦¬ì/ë‹¤ì¤‘ Historical Provider ë“±ì€ Phase 8~9ë¡œ ìœ ì§€

---

## ğŸ“‹ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ê°œìš”](#1-ì‹œìŠ¤í…œ-ê°œìš”)
2. [ì•„í‚¤í…ì²˜ ì„¤ê³„](#2-ì•„í‚¤í…ì²˜-ì„¤ê³„)
3. [ê¸°ìˆ  ìŠ¤íƒ](#3-ê¸°ìˆ -ìŠ¤íƒ)
4. [í”„ë¡œì íŠ¸ êµ¬ì¡°](#4-í”„ë¡œì íŠ¸-êµ¬ì¡°)
5. [ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„](#5-ë°ì´í„°ë² ì´ìŠ¤-ì„¤ê³„)
6. [API ìƒì„¸ ì„¤ê³„](#6-api-ìƒì„¸-ì„¤ê³„)
7. [ì¸ì¦ ë° ë³´ì•ˆ](#7-ì¸ì¦-ë°-ë³´ì•ˆ)
8. [ì‹¤ì‹œê°„ í†µì‹ ](#8-ì‹¤ì‹œê°„-í†µì‹ )
9. [ì™¸ë¶€ API ì—°ë™](#9-ì™¸ë¶€-api-ì—°ë™)
10. [ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§](#10-ë¹„ì¦ˆë‹ˆìŠ¤-ë¡œì§)
11. [êµ¬í˜„ í˜„í™© (Status)](#11-êµ¬í˜„-í˜„í™©-status)
12. [í–¥í›„ ì‹¤í–‰ ê³„íš (Next Plan)](#12-í–¥í›„-ì‹¤í–‰-ê³„íš-next-plan)

---

## 1. ì‹œìŠ¤í…œ ê°œìš”

### 1.1 ë°±ì—”ë“œ ì—­í• 

MadCamp02 ë°±ì—”ë“œëŠ” ë‹¤ìŒ í•µì‹¬ ê¸°ëŠ¥ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤:

1. **ì‚¬ìš©ì ê´€ë¦¬**: OAuth2 ì¸ì¦(Hybrid), JWT í† í° ë°œê¸‰, í”„ë¡œí•„ ë° ì‚¬ì£¼ ë°ì´í„° ê´€ë¦¬
2. **ëª¨ì˜íˆ¬ì ì—”ì§„**: ì‹¤ì‹œê°„ í˜¸ê°€/ì²´ê²° ì²˜ë¦¬, í¬íŠ¸í´ë¦¬ì˜¤ í‰ê°€, ë§¤ìˆ˜/ë§¤ë„ íŠ¸ëœì­ì…˜ ê´€ë¦¬
3. **ì‹¤ì‹œê°„ ë°ì´í„°**: Finnhub WebSocket â†’ Redis â†’ í´ë¼ì´ì–¸íŠ¸ ì¤‘ê³„ (ì£¼ê°€, í˜¸ê°€)
4. **ê²Œì´ë¯¸í”¼ì¼€ì´ì…˜**: ê°€ì± (í™•ë¥ í˜• ì•„ì´í…œ), ì•„ì´í…œ ì¸ë²¤í† ë¦¬, ë­í‚¹ ì‚°ì •
5. **AI ìƒë‹´**: ì‚¬ì£¼ ê¸°ë°˜ íˆ¬ì ì¡°ì–¸ (FastAPI ì—°ë™)

---

## 2. ì•„í‚¤í…ì²˜ ì„¤ê³„

### 2.1 ë ˆì´ì–´ë“œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PRESENTATION LAYER                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Controllers (REST API)                                     â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ AuthController, UserController, MarketController       â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ TradeController, StockController, GameController       â”‚ â”‚
â”‚  â”‚  â””â”€â”€ ChatController, NotificationController, CalcController â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  WebSocket Handlers (STOMP)                                 â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€ StockPriceHandler (ì£¼ê°€/í˜¸ê°€)                          â”‚ â”‚
â”‚  â”‚  â””â”€â”€ TradeNotificationHandler (ì²´ê²° ì•Œë¦¼)                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SERVICE LAYER                               â”‚
â”‚  â”œâ”€â”€ AuthService, UserService, MarketService                     â”‚
â”‚  â”œâ”€â”€ TradeService, StockService, PortfolioService                â”‚
â”‚  â”œâ”€â”€ GachaService, InventoryService, RankingService              â”‚
â”‚  â””â”€â”€ ChatService, SajuService, DividendService                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ê¸°ìˆ  ìŠ¤íƒ

### 3.1 Core Server (Spring Boot)

| ê¸°ìˆ               | ë²„ì „   | ìš©ë„                      |
| ----------------- | ------ | ------------------------- |
| Java              | 21 LTS | ì–¸ì–´                      |
| Spring Boot       | 3.4.x  | í”„ë ˆì„ì›Œí¬                |
| Spring Security   | 6.x    | ì¸ì¦/ì¸ê°€ (OAuth2 Client) |
| Spring Data JPA   | 3.x    | ORM                       |
| Spring WebSocket  | 6.x    | ì‹¤ì‹œê°„ í†µì‹  (STOMP)       |
| SpringDoc OpenAPI | 2.8.x  | Swagger/OpenAPI ë¬¸ì„œ      |

### 3.2 AI Server (FastAPI)

| ê¸°ìˆ     | ë²„ì „   | ìš©ë„                               |
| ------- | ------ | ---------------------------------- |
| Python  | 3.11+  | ì–¸ì–´                               |
| FastAPI | 0.100+ | API í”„ë ˆì„ì›Œí¬                     |
| SSE     | -      | ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ (Server-Sent Events) |

---

## 4. í”„ë¡œì íŠ¸ êµ¬ì¡° (íŒ¨í‚¤ì§€)

```
ğŸ“¦ src/main/java/com/madcamp02
 â”£ ğŸ“‚ config            # Security, Swagger, WebSocket, Redis ì„¤ì •
 â”£ ğŸ“‚ controller        # REST API ì»¨íŠ¸ë¡¤ëŸ¬
 â”£ ğŸ“‚ domain            # Entity ë° Repository
 â”ƒ â”£ ğŸ“‚ user
 â”ƒ â”£ ğŸ“‚ stock
 â”ƒ â”£ ğŸ“‚ trade
 â”ƒ â”£ ğŸ“‚ item
 â”ƒ â”— ğŸ“‚ chat
 â”£ ğŸ“‚ dto               # Request/Response DTO
 â”£ ğŸ“‚ service           # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
 â”£ ğŸ“‚ security          # JWT, OAuth2 í•¸ë“¤ëŸ¬
 â”£ ğŸ“‚ exception         # Global Exception Handler
 â”— ğŸ“‚ external          # Finnhub, AI Server ì—°ë™ í´ë¼ì´ì–¸íŠ¸
```

---

## 5. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### 5.1 ERD

```mermaid
erDiagram
    Users ||--|| Wallet : has
    Users ||--o{ Portfolio : owns
    Users ||--o{ TradeLogs : executes
    Users ||--o{ Inventory : has
    Users ||--o{ ChatHistory : chats
    Inventory }|--|| Items : contains

    Users {
        Long user_id PK
        String email
        String nickname
        String provider
        Date birth_date
        String saju_element
        Boolean is_public "ğŸ†• í”„ë¡œí•„ ê³µê°œ ì—¬ë¶€"
        Boolean is_ranking_joined "ğŸ†• ë­í‚¹ ì°¸ì—¬ ì—¬ë¶€"
    }

    Items {
        Long item_id PK
        String name
        String category "NAMEPLATE, AVATAR, THEME"
        String rarity
        Double probability
    }
```

### 5.2 ì£¼ìš” í…Œì´ë¸” ë³€ê²½ì‚¬í•­

1.  **Users í…Œì´ë¸”**
    - `is_public` (BOOLEAN, Default TRUE): ë§ˆì´í˜ì´ì§€ ì„¤ì • ë°˜ì˜
    - `is_ranking_joined` (BOOLEAN, Default TRUE): ë­í‚¹ ì°¸ì—¬ ì—¬ë¶€

2.  **Items í…Œì´ë¸”**
    - `category` ì»¬ëŸ¼ ENUM: `NAMEPLATE` (ì´ë¦„í‘œ/í…Œë‘ë¦¬), `AVATAR` (ì•„ë°”íƒ€ ì¥ì‹), `THEME` (ì•± í…Œë§ˆ)
    - í”„ë¡ íŠ¸ì—”ë“œ `Shop` í˜ì´ì§€ íƒ­ êµ¬ì„±ê³¼ ì •í™•íˆ ì¼ì¹˜

3.  **ExchangeRates í…Œì´ë¸” (í™˜ìœ¨) ğŸ†•**
    - í…Œì´ë¸”ëª…: `exchange_rates`
    - ìš©ë„: í•œêµ­ìˆ˜ì¶œì…ì€í–‰ Open API(AP01 - í˜„ì¬ í™˜ìœ¨)ì—ì„œ ìˆ˜ì§‘í•œ í™˜ìœ¨ ì •ë³´ë¥¼ ì¼ë³„ë¡œ ì €ì¥
    - ì£¼ìš” ì»¬ëŸ¼:
        - `as_of_date` (DATE): í™˜ìœ¨ ê¸°ì¤€ì¼ (ì˜ˆ: `2026-01-21`)
        - `cur_unit` (VARCHAR(20)): í†µí™” ì½”ë“œ (ì˜ˆ: `USD`, `JPY(100)`)
        - `cur_nm` (VARCHAR(100)): êµ­ê°€/í†µí™”ëª… (ì˜ˆ: `ë¯¸êµ­ ë‹¬ëŸ¬`)
        - `deal_bas_r` (NUMERIC(18,6)): ë§¤ë§¤ ê¸°ì¤€ìœ¨
        - `ttb`, `tts`, `bkpr`, `kftc_deal_bas_r`, `kftc_bkpr` (ì„ íƒ): ìˆ˜ì¶œì…ì€í–‰ ì›ë³¸ í•„ë“œ
        - `created_at`, `updated_at` (TIMESTAMP)
    - ì œì•½:
        - `(as_of_date, cur_unit)` ìœ ë‹ˆí¬ ì¸ë±ìŠ¤(`ux_exchange_rates_asof_curunit`)ë¡œ Upsert ê¸°ì¤€ í‚¤ë¥¼ ê³ ì •
    - ë³€í™˜ ê·œì¹™:
        - Open APIì˜ ìˆ«ì ë¬¸ìì—´(`deal_bas_r` ë“±)ì€ ì½¤ë§ˆ ì œê±° í›„ `BigDecimal`ë¡œ íŒŒì‹±í•´ì„œ ì €ì¥

---

## 6. API ìƒì„¸ ì„¤ê³„

### 6.1 Market API (ì‹ ê·œ)

í”„ë¡ íŠ¸ì—”ë“œ `/market` í˜ì´ì§€ ì§€ì›

| ë©”ì„œë“œ | ê²½ë¡œ                     | ì„¤ëª…                              |
| ------ | ------------------------ | --------------------------------- |
| GET    | `/api/v1/market/indices` | ì£¼ìš” ì§€ìˆ˜ ì¡°íšŒ (ETF ì‚¬ìš©: SPY, QQQ, DIA) |
| GET    | `/api/v1/market/news`    | ìµœì‹  ì‹œì¥ ë‰´ìŠ¤ ì¡°íšŒ               |
| GET    | `/api/v1/market/movers`  | ê¸‰ë“±/ê¸‰ë½/ê±°ë˜ëŸ‰ ìƒìœ„ ì¢…ëª© ì¡°íšŒ   |

### 6.2 Game/Shop API (í™•ì¥)

í”„ë¡ íŠ¸ì—”ë“œ `/shop`, `/mypage` í˜ì´ì§€ ì§€ì›

| ë©”ì„œë“œ | ê²½ë¡œ                          | ì„¤ëª…                                            |
| ------ | ----------------------------- | ----------------------------------------------- |
| GET    | `/api/v1/game/items`          | ì•„ì´í…œ ëª©ë¡ ì¡°íšŒ (Query Param: `category` ì§€ì›) |
| POST   | `/api/v1/game/gacha`          | ê°€ì±  ë½‘ê¸° (ì½”ì¸ ì°¨ê° ë° ì¸ë²¤í† ë¦¬ ì§€ê¸‰)          |
| GET    | `/api/v1/game/inventory`      | ë‚´ ì¸ë²¤í† ë¦¬ ì¡°íšŒ                                |
| PUT    | `/api/v1/game/equip/{itemId}` | ì•„ì´í…œ ì¥ì°©/í•´ì œ                                |

### 6.3 Trade API (í™•ì¥)

í”„ë¡ íŠ¸ì—”ë“œ `/trade` ë° `/portfolio` í˜ì´ì§€ ì§€ì›

| ë©”ì„œë“œ | ê²½ë¡œ                               | ì„¤ëª…                            |
| ------ | ---------------------------------- | ------------------------------- |
| GET    | `/api/v1/stock/orderbook/{ticker}` | í˜¸ê°€(Orderbook) ë°ì´í„° ì¡°íšŒ     |
| GET    | `/api/v1/trade/available-balance`  | í˜„ì¬ ë§¤ìˆ˜ ê°€ëŠ¥ ê¸ˆì•¡ ì¡°íšŒ        |
| GET    | `/api/v1/trade/portfolio`          | ìƒì„¸ í¬íŠ¸í´ë¦¬ì˜¤ (í‰ê°€ì†ìµ í¬í•¨) |

### 6.4 Calculation API (ì‹ ê·œ) ğŸ†•

í”„ë¡ íŠ¸ì—”ë“œ `/calculator` í˜ì´ì§€ ì§€ì›

| ë©”ì„œë“œ | ê²½ë¡œ                    | ì„¤ëª…                                    |
| ------ | ----------------------- | --------------------------------------- |
| GET    | `/api/v1/calc/dividend` | ë³´ìœ  ì¢…ëª© ê¸°ë°˜ ì˜ˆìƒ ë°°ë‹¹ê¸ˆ ë° ì„¸ê¸ˆ ê³„ì‚° |
| GET    | `/api/v1/calc/tax`      | ì‹¤í˜„ ìˆ˜ìµ ê¸°ë°˜ ì˜ˆìƒ ì–‘ë„ì†Œë“ì„¸ ê³„ì‚°     |

#### 6.4.1 ë°°ë‹¹/ì„¸ê¸ˆ ê³„ì‚° ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° (1ì°¨ ë²„ì „)

- **ê³µí†µ ì „ì œ**
    - Calc ë‚´ë¶€ ê³„ì‚°ì€ **USD ê¸°ì¤€**ìœ¼ë¡œ ìˆ˜í–‰í•œë‹¤.
    - í†µí™” ë³€í™˜(`currency` íŒŒë¼ë¯¸í„°, `fxAsOf`, `fxRateUsed`)ì€ í–¥í›„ `exchange_rates` í…Œì´ë¸”ì„ ì‚¬ìš©í•´ í™•ì¥í•  ê³„íšì´ë©°, í˜„ì¬ ë²„ì „ì—ì„œëŠ” ì‘ë‹µì˜ `currency`ë¥¼ `null`ë¡œ ìœ ì§€í•œë‹¤.

- **GET `/api/v1/calc/dividend`**
    - **Query**
        - `assumedDividendYield?: number` â€” ë°°ë‹¹ ìˆ˜ìµë¥  (ì˜ˆ: `0.03` = 3%)
        - `dividendPerShare?: number` â€” ì£¼ë‹¹ ë°°ë‹¹ì•¡ (í˜„ì¬ ë²„ì „ì—ì„œëŠ” ë¯¸ì‚¬ìš©, í–¥í›„ ì¢…ëª©ë³„ í¬ì§€ì…˜ ê¸°ë°˜ ê³„ì‚°ì—ì„œ í™œìš© ì˜ˆì •)
        - `taxRate?: number` â€” ë°°ë‹¹ì†Œë“ì„¸ ì„¸ìœ¨ (ì˜ˆ: `0.154` = 15.4%)
    - **ì²˜ë¦¬**
        - ê¸°ì¤€ ê¸ˆì•¡: ì§€ê°‘ì˜ `wallet.totalAssets` (USD ê¸°ì¤€)
        - `totalDividend = totalAssets Ã— assumedDividendYield` (assumedDividendYieldê°€ ì—†ìœ¼ë©´ 0)
        - `withholdingTax = totalDividend Ã— taxRate` (taxRateê°€ ì—†ìœ¼ë©´ 0)
        - `netDividend = totalDividend - withholdingTax`

- **GET `/api/v1/calc/tax`**
    - **Query**
        - `taxRate?: number` â€” ì–‘ë„ì†Œë“ì„¸ ì„¸ìœ¨ (ì˜ˆ: `0.22` = 22%)
    - **ì²˜ë¦¬**
        - ê¸°ì¤€ ê¸ˆì•¡: ì§€ê°‘ì˜ `wallet.realizedProfit` (USD ê¸°ì¤€)
        - `taxBase = max(realizedProfit, 0)`
        - `estimatedTax = taxBase Ã— taxRate` (taxRateê°€ ì—†ìœ¼ë©´ 0)

> ë‹¤í†µí™”(calc `currency` íŒŒë¼ë¯¸í„°, í™˜ìœ¨ ê¸°ë°˜ ë³€í™˜)ëŠ” `docs/FRONTEND_API_WIRING.md` ë° `plans/fx-batch-and-multi-currency-calc`ì— Future workë¡œ ëª…ì‹œë˜ì–´ ìˆìœ¼ë©°, í–¥í›„ `exchange_rates` í…Œì´ë¸”ê³¼ `/api/v1/exchange-rates` APIë¥¼ ê¸°ë°˜ìœ¼ë¡œ í™•ì¥ëœë‹¤.

### 6.5 Exchange Rate API (ì‹ ê·œ) ğŸ†•

í”„ë¡ íŠ¸ì—”ë“œ `/calculator` í˜ì´ì§€ì™€ í†µí™” ì„ íƒ UI, í–¥í›„ ë‹¤í†µí™” Calc ì§€ì›ì„ ìœ„í•œ í™˜ìœ¨ ì¡°íšŒ API.

| ë©”ì„œë“œ | ê²½ë¡œ                             | ì„¤ëª…                                       |
| ------ | -------------------------------- | ------------------------------------------ |
| GET    | `/api/v1/exchange-rates`        | íŠ¹ì • ì¼ìì˜ í™˜ìœ¨ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ (`date` ì¿¼ë¦¬) |
| GET    | `/api/v1/exchange-rates/latest` | ê°€ì¥ ìµœê·¼ ê¸°ì¤€ì¼(`as_of_date`) í™˜ìœ¨ ì¡°íšŒ    |

- **GET `/api/v1/exchange-rates`**
    - Query:
        - `date?: string(yyyy-MM-dd)` â€” ì§€ì •í•˜ì§€ ì•Šìœ¼ë©´ ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€(ì£¼ë§ ë³´ì • í¬í•¨)
    - Response (ìš”ì•½):
        - `asOf: string(yyyy-MM-dd)` â€” í™˜ìœ¨ ê¸°ì¤€ì¼
        - `items: { curUnit, curNm, dealBasR, ttb, tts }[]`

- **GET `/api/v1/exchange-rates/latest`**
    - Query ì—†ìŒ
    - `exchange_rates`ì—ì„œ `as_of_date`ê°€ ê°€ì¥ í° ë ˆì½”ë“œ ê¸°ì¤€ìœ¼ë¡œ ë™ì¼ í˜•ì‹ ì‘ë‹µ

### 6.6 Auth API (ê¸°ì¡´ ìœ ì§€)

| ë©”ì„œë“œ | ê²½ë¡œ                  | ì„¤ëª…                              |
| ------ | --------------------- | --------------------------------- |
| POST   | `/api/v1/auth/signup` | ì¼ë°˜ íšŒì›ê°€ì…                     |
| POST   | `/api/v1/auth/login`  | ì¼ë°˜ ë¡œê·¸ì¸                       |
| GET    | `/api/v1/auth/me`     | í˜„ì¬ ì‚¬ìš©ì ì •ë³´ (ì‚¬ì£¼ ì •ë³´ í¬í•¨) |

---

## 7. ì¸ì¦ ë° ë³´ì•ˆ

### 7.1 Hybrid OAuth2 Architecture

MadCamp02ëŠ” ë‹¤ì–‘í•œ í´ë¼ì´ì–¸íŠ¸ í™˜ê²½(Web, Mobile, External)ì„ ì§€ì›í•˜ê¸° ìœ„í•´ **ë‘ ê°€ì§€ ì¸ì¦ ë°©ì‹ì„ ëª¨ë‘ ì§€ì›**í•©ë‹ˆë‹¤.

#### A. Backend-Driven (í‘œì¤€ ì›¹ ë°©ì‹)

- **íë¦„**: `GET /oauth2/authorization/kakao` â†’ Provider Login â†’ Redirect to Backend â†’ Redirect to Frontend with Token.
- **ì¥ì **: ë³´ì•ˆì„±ì´ ë†’ìŒ, í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„ ê°„ë‹¨.
- **êµ¬í˜„**: `SecurityConfig`ì˜ `oauth2Login()` ì„¤ì • ë° `OAuth2SuccessHandler`.

#### B. Frontend-Driven (ëª¨ë°”ì¼/SPA ì¹œí™”ì )

- **íë¦„**: Frontendì—ì„œ Provider SDKë¡œ í† í° íšë“ â†’ `POST /api/v1/auth/oauth/kakao` (Body: accessToken) â†’ Backend ê²€ì¦ ë° JWT ë°œê¸‰.
- **ì¥ì **: ëª¨ë°”ì¼ ë„¤ì´í‹°ë¸Œ SDK í™œìš© ìš©ì´, ìœ ì—°í•œ UI ì œì–´.
- **êµ¬í˜„**: `AuthController`ì˜ `kakaoLogin`, `googleLogin` ì—”ë“œí¬ì¸íŠ¸.

#### C. Kakao ìŠ¤ì½”í”„Â·í”„ë¡œë¹„ì €ë‹ ê·œì¹™ (2026-01-20)

- **ë™ì˜ ìŠ¤ì½”í”„**: `profile_nickname` **ë‹¨ì¼ í•„ìˆ˜**. `account_email` ìš”ì²­ ì—†ìŒ.
- **ì´ë©”ì¼ ì²˜ë¦¬**: Kakao ì‘ë‹µì— ì´ë©”ì¼ì´ ì—†ìœ¼ë©´ ë°±ì—”ë“œê°€ `kakao-{timestamp}-{random}@auth.madcamp02.local` í˜•íƒœë¡œ ìƒì„±í•˜ê³ , ì¤‘ë³µ ì‹œ ì¬ìƒì„±í•˜ì—¬ ì €ì¥.
- **ë‹‰ë„¤ì„ ì²˜ë¦¬**: ë‹‰ë„¤ì„ì´ ë¹„ì–´ ìˆìœ¼ë©´ `kakao-user-{random}` ì„ì˜ ë‹‰ë„¤ì„ ë¶€ì—¬.
- **ê°€ì…/ë¡œê·¸ì¸ ë¶„ê¸°**: ì´ë©”ì¼(ì„ì˜ í¬í•¨)ë¡œ ì‚¬ìš©ì ì¡°íšŒ â†’ ì—†ìœ¼ë©´ íšŒì›ê°€ì…+ì§€ê°‘/ê¸°ë³¸ ê´€ì‹¬ì¢…ëª© ìƒì„±, ìˆìœ¼ë©´ ë¡œê·¸ì¸. ì‘ë‹µ `isNewUser`ë¡œ í”„ë¡ íŠ¸ê°€ ì˜¨ë³´ë”©(`/onboarding`) ë¦¬ë‹¤ì´ë ‰íŠ¸ ì—¬ë¶€ ê²°ì •.

---

## 8. ì‹¤ì‹œê°„ í†µì‹  (WebSocket)

### 8.1 í† í”½ ì„¤ê³„

- **Endpoint**: `/ws-stomp` _(ë¬¸ì„œ ì •í•©ì„± ê¸°ì¤€, í”„ë¡ íŠ¸ ì—°ë™ ì‹œ ë™ì¼ ì—”ë“œí¬ì¸íŠ¸ ì‚¬ìš©)_
- `/topic/stock.indices`: ì‹œì¥ ì§€ìˆ˜ ì—…ë°ì´íŠ¸ (10ì´ˆ ì£¼ê¸°)
- `/topic/stock.ticker.{ticker}`: ê°œë³„ ì¢…ëª© ì²´ê²°ê°€/í˜¸ê°€ (ì‹¤ì‹œê°„)
- `/user/queue/trade`: ì‚¬ìš©ì ê°œì¸ ì£¼ë¬¸ ì²´ê²° ì•Œë¦¼

### 8.2 êµ¬ë… ê´€ë¦¬ ì „ëµ (Dynamic Subscription Manager)

**ë¬¸ì œì **: Finnhub WebSocketì€ ë™ì‹œì— ìµœëŒ€ 50ê°œ ì‹¬ë³¼ë§Œ êµ¬ë… ê°€ëŠ¥.

**í•´ê²° ì „ëµ**:
1. **Active Sessions ì¶”ì **: í˜„ì¬ ì ‘ì†í•œ ì‚¬ìš©ìê°€ ë³´ê³  ìˆëŠ” ì¢…ëª©(`currentTicker`)ì„ Mapìœ¼ë¡œ ê´€ë¦¬.
2. **LRU (Least Recently Used) ê¸°ë°˜ í•´ì œ**: 
   - ì‚¬ìš©ìê°€ ì¢…ëª© ìƒì„¸ í˜ì´ì§€ ì§„ì… ì‹œ êµ¬ë… ì¶”ê°€.
   - êµ¬ë… í’€ì´ 50ê°œ ì´ˆê³¼ ì‹œ, í˜„ì¬ ì•„ë¬´ë„ ë³´ê³  ìˆì§€ ì•Šì€ ì¢…ëª© ì¤‘ ê°€ì¥ ì˜¤ë˜ëœ ê²ƒì„ ìë™ í•´ì œ.
3. **êµ¬í˜„ ìœ„ì¹˜**: `StockSubscriptionManager` (Thread-safe)
4. **ì´ë²¤íŠ¸ í›…**: STOMP Subscribe/Unsubscribe ì´ë²¤íŠ¸(`@EventListener`)ì—ì„œ Manager í˜¸ì¶œ.

---

## 9. ì™¸ë¶€ API ì—°ë™

### 9.1 Finnhub (ì£¼ì‹ ë°ì´í„°)

- **WebSocket**: ì‹¤ì‹œê°„ ë¯¸êµ­ ì£¼ì‹ ë°ì´í„° ìˆ˜ì‹ 
  - **ì œí•œ**: 50 Symbols ë™ì‹œ êµ¬ë… ì œí•œ
  - **ì „ëµ**: Dynamic Subscription Manager (LRU ê¸°ë°˜)ë¡œ êµ¬ë… ê´€ë¦¬
- **REST API**: Quote, News ë“±
  - **Quote API ì œí•œ**: US stocksë§Œ ì§€ì›, ì§€ìˆ˜ ì‹¬ë³¼(`^DJI`, `^GSPC`, `^IXIC`)ì€ ì§€ì›í•˜ì§€ ì•ŠìŒ
  - **ì§€ìˆ˜ ë°ì´í„° ëŒ€ì•ˆ**: í•´ë‹¹ ì§€ìˆ˜ë¥¼ ì¶”ì í•˜ëŠ” ETF ì‚¬ìš© (SPY=S&P 500, QQQ=NASDAQ-100, DIA=Dow Jones)
- **Redis ìºì‹±**: ìµœì‹ ê°€ ìºì‹± (`stock:price:{ticker}`)

### 9.2 EODHD (Historical Data)

- **ìš©ë„**: Historical Candles (OHLCV) ë°ì´í„° ì œê³µ (Finnhub Premium ëŒ€ì²´)
- **ì œí•œ**: 
  - **ì¼ì¼ í˜¸ì¶œ ì œí•œ**: 20íšŒ/ì¼ (ë§¤ìš° ì—„ê²©)
  - **âš ï¸ ë¬´ë£Œ êµ¬ë… ì œí•œ**: **ìµœê·¼ 1ë…„ ë°ì´í„°ë§Œ ì œê³µ** (ë¬´ë£Œ í”Œëœ)
    - 1ë…„ ì´ì „ ë°ì´í„° ìš”ì²­ ì‹œ `{"warning":"Data is limited by one year as you have free subscription"}` ê²½ê³  ë©”ì‹œì§€ ë°˜í™˜
    - ì‹¤ì œ ìº”ë“¤ ë°ì´í„° ì—†ì´ ê²½ê³ ë§Œ ë°˜í™˜ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì‘ë‹µì—ì„œ `warning` í•„ë“œ ì²´í¬ ë° í•„í„°ë§ í•„ìš”
- **ì „ëµ**: 
  - **DB ìºì‹±**: `stock_candles` í…Œì´ë¸”ì— ë°ì´í„° ì €ì¥, API ì‘ë‹µì€ í•­ìƒ DBì—ì„œ ì œê³µ
  - **Quota ê´€ë¦¬**: `api_usage_logs` í…Œì´ë¸”ë¡œ ì¼ì¼ í˜¸ì¶œ íšŸìˆ˜ ì¶”ì 
  - **ì—ëŸ¬ ì²˜ë¦¬**: Quota ì´ˆê³¼ ì‹œ ê¸°ì¡´ ë°ì´í„°(Stale) ë°˜í™˜ ë˜ëŠ” 429 ì—ëŸ¬ ì‘ë‹µ
  - **ê²½ê³  ë©”ì‹œì§€ ì²˜ë¦¬**: `warning` í•„ë“œê°€ ìˆëŠ” ì‘ë‹µì€ í•„í„°ë§í•˜ì—¬ ìœ íš¨í•œ ìº”ë“¤ ë°ì´í„°ë§Œ ì €ì¥
- **Base URL**: `https://eodhd.com/api`
- **ì—”ë“œí¬ì¸íŠ¸**: `/eod/{ticker}?fmt=json`
- **í‹°ì»¤ í˜•ì‹**: `{SYMBOL}.{EXCHANGE_ID}` í˜•ì‹ ê¶Œì¥ (ì˜ˆ: `AAPL.US`). ê±°ë˜ì†Œ ì½”ë“œê°€ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ `.US` ì¶”ê°€

### 9.3 FastAPI (AI ì„œë²„)

- **ì—­í•  ìš”ì•½**
  - FastAPI ê¸°ë°˜ AI GatewayëŠ” `/api/v1/ai/**` ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ LLM Backend(vLLM/llama.cpp)ë¥¼ í˜¸ì¶œí•˜ëŠ” ì „ìš© ì„œë²„ì´ë‹¤.
  - Spring ë°±ì—”ë“œëŠ” `AiClient`ë¥¼ í†µí•´ ì´ Gatewayë¥¼ í˜¸ì¶œí•˜ê³ , `ChatController`ì˜ `POST /api/v1/chat/ask` ì—”ë“œí¬ì¸íŠ¸ì—ì„œ SSEë¡œ í”„ë¡ íŠ¸(`/oracle`)ì— ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µì„ ì¤‘ê³„í•œë‹¤.
- **ìƒì„¸ ìŠ¤í™**
  - ëª¨ë¸ ì „ëµ(8B/20B/CPU Fallback), í”„ë¡¬í”„íŠ¸/í˜ë¥´ì†Œë‚˜, AI ì„œë²„ API(`/api/v1/ai/chat|oracle/advice|portfolio/explain|onboarding/summary`),  
    Spring SSE í”„ë¡ì‹œ ë° í”„ë¡ íŠ¸ `/oracle` í´ë¼ì´ì–¸íŠ¸ê¹Œì§€ì˜ ì „ì²´ íë¦„ì€  
    **`docs/AI_SERVER_SPEC.md` v1.1.0**ì˜ 2~7ì¥ê³¼ 9ì¥ì„ ë‹¨ì¼ ì§„ì‹¤ë¡œ ì‚¬ìš©í•œë‹¤.

---

## 10. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (í•µì‹¬)

### 10.1 ê°€ì± (Gacha) ë¡œì§

1.  ì‚¬ìš©ì ì§€ê°‘ì—ì„œ ì½”ì¸ ì°¨ê° (`WalletService`)
2.  í™•ë¥  í…Œì´ë¸”(`Items`ì˜ `probability`)ì— ë”°ë¼ ì•„ì´í…œ ì¶”ì²¨ (`RandomUtils`)
3.  ì¸ë²¤í† ë¦¬ì— ì•„ì´í…œ ì¶”ê°€ (ì¤‘ë³µ ì‹œ ëŒ€ì²´ ë³´ìƒ ë˜ëŠ” ë ˆë²¨ì—… ê³ ë ¤)
4.  ê²°ê³¼ DTO ë°˜í™˜

### 10.2 ì‚¬ì£¼ ë¶„ì„ ë¡œì§ (`SajuCalculator`)

1.  ì •ë°€ ì‚¬ì£¼ ê³„ì‚° (4ì£¼ ì™„ì „ êµ¬í˜„):
    - ì…ë ¥: ìƒë…„ì›”ì¼(ì–‘ë ¥/ìŒë ¥), ìƒë…„ì›”ì¼ì‹œ, ì„±ë³„
    - ì—°ì£¼(å¹´æŸ±): ì—°ë„ ê¸°ì¤€ ì²œê°„/ì§€ì§€ (ë ëŠ” ì—°ì£¼ ì§€ì§€ ê¸°ì¤€)
    - ì›”ì£¼(æœˆæŸ±): ì›” ê¸°ì¤€ ì²œê°„/ì§€ì§€ (ì—°ì£¼ ì²œê°„ê³¼ ì›” ì§€ì§€ ì˜¤í”„ì…‹ ì¡°í•©)
    - ì¼ì£¼(æ—¥æŸ±): ì¼ ê¸°ì¤€ ì²œê°„/ì§€ì§€ (1900-01-01 ê¸°ì¤€ ì¼ìˆ˜ ì°¨ì´ ê³„ì‚°, **ì˜¤í–‰ì€ ì¼ì£¼ ì²œê°„ ê¸°ì¤€**)
    - ì‹œì£¼(æ™‚æŸ±): ì‹œê°„ ê¸°ì¤€ ì²œê°„/ì§€ì§€ (ì¼ì£¼ ì²œê°„ê³¼ ì‹œê°„ ì§€ì§€ ì˜¤í”„ì…‹ ì¡°í•©)
2.  ì˜¤í–‰(Wood, Fire, Earth, Metal, Water) ë„ì¶œ: ì¼ì£¼(æ—¥æŸ±)ì˜ ì²œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ì‚°ì¶œ
3.  ì˜¤í–‰ë³„ íˆ¬ì ì„±í–¥ ë§¤í•‘ (DB ë˜ëŠ” Enum ê´€ë¦¬)
4.  ìŒë ¥ ë³€í™˜: í•œêµ­ì²œë¬¸ì—°êµ¬ì› API(`LunarCalendarClient`)ë¥¼ í†µí•œ ì •í™•í•œ ì–‘ë ¥â†”ìŒë ¥ ë³€í™˜

---

## 11. êµ¬í˜„ í˜„í™© (Status)

**Current Date:** 2026-01-19

| ëª¨ë“ˆ       | ì§„í–‰ë¥  | ìƒíƒœ           | ë¹„ê³                                                                                                                       |
| ---------- | ------ | -------------- | ------------------------------------------------------------------------------------------------------------------------- |
| **Auth**   | 100%   | âœ… Complete    | Hybrid ì¸ì¦ ì¸í„°í˜ì´ìŠ¤(Backend/Frontend Driven) í™•ì •. í”„ë¡ íŠ¸ `/oauth/callback` ë° í† í° ì €ì¥/ê°±ì‹  ì—°ë™ì€ Phase 1ì—ì„œ ì§„í–‰. |
| **User**   | 80%    | âš ï¸ Update Req  | ê¸°ë³¸ ì—”í‹°í‹° ì¡´ì¬í•˜ë‚˜ `is_public` ë“± ì‹ ê·œ í•„ë“œ ëˆ„ë½ë¨.                                                                     |
| **Market** | 100%   | âœ… Complete    | Phase 3.4~3.6 êµ¬í˜„ ì™„ë£Œ: Indices/News/Movers REST + Redis ìºì‹±, ETF ì§€ìˆ˜ ê·œì•½ ë°˜ì˜.                                      |
| **Trade**  | 100%   | âœ… Complete    | Phase 4: Trade/Portfolio Engine ì™„ì „ êµ¬í˜„(íŠ¸ëœì­ì…˜/ë¹„ê´€ì  ë½, ë™ì‹œì„± í…ŒìŠ¤íŠ¸ í¬í•¨).                                         |
| **Game**   | 100%   | âœ… Complete    | Phase 5 êµ¬í˜„ ì™„ë£Œ(Shop/Gacha/Inventory/Ranking). í”„ë¡ íŠ¸ëŠ” í˜„ì¬ ëª¨ì˜ë°ì´í„° ìƒíƒœì´ë¯€ë¡œ Phase 5.5ì—ì„œ ì‹¤ë°ì´í„° ì—°ë™ í•„ìš”.    |
| **Realtime**| 100%  | âœ… Complete    | Phase 6 ì™„ë£Œ: Finnhub Trades WebSocket + `/topic/stock.indices` + `/user/queue/trade` ë¸Œë¡œë“œìºìŠ¤íŠ¸ êµ¬í˜„ ì™„ë£Œ. Watchlist API êµ¬í˜„ ì™„ë£Œ. |
| **AI**     | 0%     | â¬œ Pending     | FastAPI ì—°ë™ ë¯¸êµ¬í˜„.                                                                                                      |

---

## 12. í–¥í›„ ì‹¤í–‰ ê³„íš (Next Plan)

**ì •í•©ì„± ê¸°ì¤€(Single Source of Truth)**  
`docs/FULL_SPECIFICATION.md` + `docs/FRONTEND_DEVELOPMENT_PLAN.md` (ë‘˜ ë‹¤ v2.7.6) ê¸°ì¤€ìœ¼ë¡œ, ë°±ì—”ë“œ êµ¬í˜„ì„ ì•„ë˜ ìˆœì„œë¡œ ì§„í–‰í•©ë‹ˆë‹¤.

### 12.1 Phase 0: ì¸í„°í˜ì´ìŠ¤ ê³ ì •(í”„ë¡ íŠ¸ ì—°ë™ ì„ í–‰)

- **Auth ì—°ë™ ê³ ì •**: `POST /api/v1/auth/*` + `GET /oauth2/authorization/{provider}` + `/oauth/callback` ë¦¬ë‹¤ì´ë ‰íŠ¸ íŒŒë¼ë¯¸í„° ê·œì•½ ìœ ì§€
- **ì‹¤ì‹œê°„(STOMP) ì—”ë“œí¬ì¸íŠ¸ ì •í•©ì„±**: í”„ë¡ íŠ¸ ë¬¸ì„œ ê¸°ì¤€ `Endpoint: /ws-stomp`ë¡œ ê³ ì •í•˜ê³ , ë°±ì—”ë“œ ë³´ì•ˆ ì˜ˆì™¸/ì„¤ì •ë„ ë™ì¼í•˜ê²Œ ë§ì¶¤
- **ì‘ë‹µ DTO í™•ì •**: í”„ë¡ íŠ¸ í˜ì´ì§€ê°€ í•„ìš”í•œ ìµœì†Œ í•„ë“œ(ì§€ìˆ˜/ë‰´ìŠ¤/ë¬´ë²„/í¬íŠ¸í´ë¦¬ì˜¤/ì¸ë²¤í† ë¦¬/ë­í‚¹)ë¥¼ ë¨¼ì € í™•ì •í•œ ë’¤ êµ¬í˜„
  - **ë‹¨ì¼ ì§„ì‹¤(Single Source of Truth)**: `docs/FULL_SPECIFICATION.md`ì˜ `5.0 ê³µí†µ ì‘ë‹µ ê·œì•½ (Phase 0: Interface Freeze)` ì„¹ì…˜ì„ ê¸°ì¤€ìœ¼ë¡œ Response ìŠ¤í‚¤ë§ˆë¥¼ ê³ ì •

### 12.2 Phase 1: DB/ë„ë©”ì¸ 2.7(2.6 ëª©í‘œ í¬í•¨) ì •í•©ì„± (Blocking)

- **Flyway V2**: `users.is_public`, `users.is_ranking_joined` ì»¬ëŸ¼ ì¶”ê°€(+ ê¸°ë³¸ê°’ TRUE)
- **Flyway V3**: `items.category`ë¥¼ `NAMEPLATE/AVATAR/THEME` ì²´ê³„ë¡œ ì „í™˜/ë§¤í•‘(ê¸°ì¡´ ë°ì´í„° ëŒ€ì‘ í¬í•¨)
- **Entity ì •í•©í™”**:
  - `User`ì— ê³µê°œ/ë­í‚¹ì°¸ì—¬ í•„ë“œ ë° ì—…ë°ì´íŠ¸ ë©”ì„œë“œ ì¶”ê°€
  - `Item.Category` Enumì„ ëª©í‘œ ì²´ê³„ë¡œ ë³€ê²½(ë ˆê±°ì‹œ ë§¤í•‘ ì „ëµ ë¬¸ì„œí™”)

#### 12.2.1 `items.category` ë ˆê±°ì‹œâ†’ëª©í‘œ ë§¤í•‘ ì •ì±… (Single Source of Truth)

ì•„ë˜ ë§¤í•‘ì€ **Flyway V3(ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜)** ë° **ë°±ì—”ë“œ ë„ë©”ì¸ Enum**ì˜ ë‹¨ì¼ ì§„ì‹¤ì…ë‹ˆë‹¤.

| Legacy Category (V1) | Target Category (Phase 1+) | ë¹„ê³                          |
| -------------------- | -------------------------- | ---------------------------- |
| `COSTUME`            | `AVATAR`                   | ì•„ë°”íƒ€ ê¾¸ë¯¸ê¸° ì•„ì´í…œ(ë ˆê±°ì‹œ) |
| `ACCESSORY`          | `AVATAR`                   | ì•„ë°”íƒ€ ê¾¸ë¯¸ê¸° ì•„ì´í…œ(ë ˆê±°ì‹œ) |
| `AURA`               | `AVATAR`                   | ì•„ë°”íƒ€ ê¾¸ë¯¸ê¸° ì•„ì´í…œ(ë ˆê±°ì‹œ) |
| `BACKGROUND`         | `THEME`                    | í™”ë©´/ë°°ê²½ ê³„ì—´(ë ˆê±°ì‹œ)       |

> `NAMEPLATE`ëŠ” ë ˆê±°ì‹œì— ì§ì ‘ ëŒ€ì‘ ê°’ì´ ì—†ìœ¼ë¯€ë¡œ, ì‹ ê·œ ë°ì´í„°ë¶€í„° `NAMEPLATE`ë¡œ ìƒì„±/ì €ì¥í•©ë‹ˆë‹¤.

#### 12.2.2 Unknown ì²˜ë¦¬ ì •ì±… (Fail Fast)

- **Flyway V3ëŠ” â€œì¡°ìš©í•œ í†µê³¼â€ë¥¼ ê¸ˆì§€**í•©ë‹ˆë‹¤.
- ë§ˆì´ê·¸ë ˆì´ì…˜ ìˆ˜í–‰ í›„ `items.category`ì— `NAMEPLATE | AVATAR | THEME` ì™¸ ê°’ì´ í•˜ë‚˜ë¼ë„ ë‚¨ì•„ìˆìœ¼ë©´ **ì¦‰ì‹œ ì‹¤íŒ¨(raise)**í•˜ì—¬ ë°°í¬ë¥¼ ì°¨ë‹¨í•©ë‹ˆë‹¤.
- (ê¶Œì¥) ë§ˆì´ê·¸ë ˆì´ì…˜ì—ì„œ `CHECK (category IN ('NAMEPLATE','AVATAR','THEME'))` ì œì•½ì„ ì¶”ê°€í•´ **ì¬ë°œì„ ì›ì²œ ì°¨ë‹¨**í•©ë‹ˆë‹¤.

### 12.3 Phase 2: User/Onboarding API (í”„ë¡ íŠ¸ Phase 1~2 ì—°ë™ í•µì‹¬)

- **êµ¬í˜„ ëŒ€ìƒ**: `UserController`, `UserService`, `SajuCalculator`
- **ì—”ë“œí¬ì¸íŠ¸**:
  - `GET /api/v1/user/me` (`UserMeResponse`, email í¬í•¨)
  - `PUT /api/v1/user/me` (nickname, is_public, is_ranking_joined ë“±)
  - `POST /api/v1/user/onboarding` (ì •ë°€ ì‚¬ì£¼ ê³„ì‚°: ì„±ë³„/ì–‘ë ¥ìŒë ¥/ì‹œê°„ í¬í•¨).  
    â†’ ì´ ì—”ë“œí¬ì¸íŠ¸ëŠ” **ìµœì´ˆ ì˜¨ë³´ë”©ê³¼ ë§ˆì´í˜ì´ì§€ì—ì„œì˜ ì‚¬ì£¼ ì •ë³´ ì¬ê³„ì‚°(ì¬ì˜¨ë³´ë”©)**ì„ ëª¨ë‘ ì²˜ë¦¬í•˜ëŠ” **ë‹¨ì¼ idempotent ì§„ì…ì **ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤. ë™ì¼ ì‚¬ìš©ìì— ëŒ€í•´ ë°˜ë³µ í˜¸ì¶œ ì‹œ `users.birth_date/birth_time/gender/calendar_type/saju_element/zodiac_sign` ì»¬ëŸ¼ì„ ìƒˆ ì…ë ¥ê°’ ê¸°ì¤€ìœ¼ë¡œ í•­ìƒ ë®ì–´ì“´ë‹¤.
  - `GET /api/v1/user/wallet`
- **ì˜¨ë³´ë”© ì™„ë£Œ í•´ì„ ê·œì¹™ ë° ì†Œì…œ í”Œë˜ê·¸ ì—­í• **
  - ì˜¨ë³´ë”© ì™„ë£Œ ì—¬ë¶€ëŠ” ë³„ë„ì˜ boolean ì»¬ëŸ¼ ì—†ì´, `users.birth_date IS NOT NULL` ì´ê³  `users.saju_element IS NOT NULL`ì¸ ê²½ìš°ë¡œ í•´ì„í•œë‹¤.
  - í”„ë¡ íŠ¸ì—”ë“œëŠ” `/api/v1/auth/me` ë˜ëŠ” `/api/v1/user/me` ì‘ë‹µì„ ê¸°ë°˜ìœ¼ë¡œ ë™ì¼í•œ ê·œì¹™ì„ ì‚¬ìš©í•´ `hasCompletedOnboarding(user)`ë¥¼ ê³„ì‚°í•˜ë©°, ë©”ì¸ ê¸°ëŠ¥ ì ‘ê·¼ ì „ ì˜¨ë³´ë”©ì„ ê°•ì œí•œë‹¤.
  - ì†Œì…œ ë¡œê·¸ì¸ ì‘ë‹µ DTOì˜ `isNewUser` í”Œë˜ê·¸ëŠ” **ë¼ìš°íŒ… íŒíŠ¸**ë¡œë§Œ ì‚¬ìš©ë˜ë©°, ê¶Œí•œ/ë³´ì•ˆ íŒë‹¨ì€ í•­ìƒ JWT ë° DB ìƒíƒœ(`birth_date/saju_element`)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•œë‹¤.
- **DB ìŠ¤í‚¤ë§ˆ í™•ì¥ (Flyway V4)**:
  - `users.birth_time` (TIME): ìƒë…„ì›”ì¼ì‹œ (ê¸°ë³¸ê°’ 00:00:00)
  - `users.gender` (VARCHAR): ì„±ë³„ (MALE/FEMALE/OTHER)
  - `users.calendar_type` (VARCHAR): ì–‘ë ¥/ìŒë ¥ êµ¬ë¶„ (SOLAR/LUNAR/LUNAR_LEAP)
- **ì •ë°€ ì‚¬ì£¼ ê³„ì‚° (4ì£¼ ì™„ì „ êµ¬í˜„)**:
  - `SajuCalculator.calculatePrecise()`: ì—°ì£¼/ì›”ì£¼/ì¼ì£¼/ì‹œì£¼ 4ì£¼ ëª¨ë‘ ê³„ì‚°
  - ìµœì¢… ì˜¤í–‰ì€ ì¼ì£¼(æ—¥æŸ±)ì˜ ì²œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ì‚°ì¶œ
- **í•œêµ­ì²œë¬¸ì—°êµ¬ì› API ì—°ë™**:
  - `LunarCalendarClient`: ê³µê³µë°ì´í„°í¬í„¸ APIë¥¼ í†µí•œ ì–‘ë ¥â†”ìŒë ¥ ì •í™•í•œ ë³€í™˜
  - í™˜ê²½ë³€ìˆ˜ `KASI_SERVICE_KEY` í•„ìš” (ê³µê³µë°ì´í„°í¬í„¸ì—ì„œ ë°œê¸‰)
- **íƒ€ì¸ í”„ë¡œí•„ ê³µê°œ API (í–¥í›„)**:
  - `GET /api/v1/user/{userId}` (`UserPublicResponse`, email ì œì™¸)

### 12.4 Phase 3: Market/Stock API (í”„ë¡ íŠ¸ `/market`, `/trade` ì‹¤ë°ì´í„° ì¹˜í™˜)

- **êµ¬í˜„ ëŒ€ìƒ**: `MarketController/Service`, `StockController/Service` (+ Finnhub REST ì—°ë™)
- **ì—”ë“œí¬ì¸íŠ¸**:
  - `GET /api/v1/market/indices` (ETF ì‚¬ìš©: SPY=S&P 500, QQQ=NASDAQ-100, DIA=Dow Jones)
  - `GET /api/v1/market/news`
  - `GET /api/v1/market/movers`
  - `GET /api/v1/stock/search`
  - `GET /api/v1/stock/quote/{ticker}`
  - `GET /api/v1/stock/candles/{ticker}` (EODHD + DB ìºì‹±)
- **ìºì‹œ ì „ëµ(ê¶Œì¥)**: indices/news/moversëŠ” Redis TTL ê¸°ë°˜ ìºì‹œë¡œ ë¹„ìš©/ì§€ì—° ìµœì†Œí™”
- **ì§€ìˆ˜ ì¡°íšŒ ì£¼ì˜ì‚¬í•­**: Finnhub Quote APIëŠ” ì§€ìˆ˜ ì‹¬ë³¼(`^DJI`, `^GSPC`, `^IXIC`)ì„ ì§€ì›í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, í•´ë‹¹ ì§€ìˆ˜ë¥¼ ì¶”ì í•˜ëŠ” ETFë¥¼ ì‚¬ìš©

### 12.4.1 Phase 3.5: ë°ì´í„° ì „ëµ êµ¬í˜„ (DATA_STRATEGY_PLAN ê¸°ë°˜)

**êµ¬í˜„ ì™„ë£Œ**: Market Movers Redis ìºì‹± (1-5ë¶„ TTL)

### 12.4.2 Phase 3.6: ë°±ì—”ë“œ Redis ìºì‹± í™•ì¥ (Market Indices/News/Movers) ğŸ†•

**ëª©í‘œ**: í”„ë¡ íŠ¸ì—”ë“œ localStorage ìºì‹±ê³¼ ì—°ê³„í•˜ì—¬ ì´ì¤‘ ìºì‹± ì „ëµìœ¼ë¡œ API ì‹¤íŒ¨ ì‹œì—ë„ ì•ˆì •ì ì¸ ë°ì´í„° ì œê³µ

**êµ¬í˜„ ëŒ€ìƒ**: `MarketService`ì˜ `getIndices()`, `getNews()`, `getMovers()` ë©”ì„œë“œ

**Redis ìºì‹± ì „ëµ**:

1. **ìºì‹œ í‚¤ íŒ¨í„´**:
   - `market:indices` - ì‹œì¥ ì§€ìˆ˜ ë°ì´í„°
   - `market:news` - ì‹œì¥ ë‰´ìŠ¤ ë°ì´í„°
   - `market:movers` - ì‹œì¥ ë™í–¥ ë°ì´í„° (ì´ë¯¸ êµ¬í˜„ë¨)

2. **TTL ì„¤ì •**:
   - **Market Indices**: 1ë¶„ (60ì´ˆ) - ì‹¤ì‹œê°„ì„±ì´ ì¤‘ìš”í•˜ì§€ë§Œ ì™¸ë¶€ API í˜¸ì¶œ ë¹„ìš© ì ˆê°
   - **Market News**: 5ë¶„ (300ì´ˆ) - ë‰´ìŠ¤ëŠ” ìƒëŒ€ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ ë¹ˆë„ê°€ ë‚®ìŒ
   - **Market Movers**: 1-5ë¶„ (ê¸°ì¡´ êµ¬í˜„ ìœ ì§€) - ì‹œì¥ ë³€ë™ì„±ì´ ë†’ì„ ë•ŒëŠ” ì§§ê²Œ, ë‚®ì„ ë•ŒëŠ” ê¸¸ê²Œ

3. **ìºì‹œ ë™ì‘ íë¦„**:
   ```mermaid
   flowchart TD
       A[GET /api/v1/market/indices] --> B[Redis ìºì‹œ í™•ì¸]
       B -->|Hit| C[ìºì‹œëœ ë°ì´í„° ë°˜í™˜ + X-Cache-Status: HIT]
       B -->|Miss| D[Finnhub API í˜¸ì¶œ]
       D -->|Success| E[Redisì— ì €ì¥ TTL: 1ë¶„]
       D -->|Failure| F{ì´ì „ ìºì‹œ ìˆìŒ?}
       F -->|Yes| G[Stale ìºì‹œ ë°˜í™˜ + X-Cache-Status: STALE]
       F -->|No| H[ì—ëŸ¬ ì‘ë‹µ]
       E --> I[ë°ì´í„° ë°˜í™˜ + X-Cache-Status: MISS]
       G --> I
   ```

4. **ì‘ë‹µ í—¤ë” ì¶”ê°€**:
   - `X-Cache-Status`: `HIT` (ìºì‹œì—ì„œ ì¡°íšŒ), `MISS` (API í˜¸ì¶œ), `STALE` (ë§Œë£Œë˜ì—ˆì§€ë§Œ ì‚¬ìš©)
   - `X-Cache-Age`: ìºì‹œ ìƒì„± í›„ ê²½ê³¼ ì‹œê°„ (ì´ˆ ë‹¨ìœ„)
   - `X-Data-Freshness`: ë°ì´í„° ì‹ ì„ ë„ (`FRESH`, `STALE`, `EXPIRED`)

5. **Stale ë°ì´í„° ì²˜ë¦¬**:
   - Redis TTL ë§Œë£Œ í›„ì—ë„ ë°ì´í„°ë¥¼ `market:indices:stale` í‚¤ë¡œ ì¶”ê°€ ì €ì¥ (TTL: 1ì‹œê°„)
   - API ì‹¤íŒ¨ ì‹œ Stale ë°ì´í„° ë°˜í™˜í•˜ì—¬ í”„ë¡ íŠ¸ì—”ë“œê°€ ìµœì†Œí•œì˜ ë°ì´í„°ë¼ë„ í‘œì‹œ ê°€ëŠ¥
   - Stale ë°ì´í„° ë°˜í™˜ ì‹œ `X-Cache-Status: STALE` í—¤ë” í¬í•¨

6. **êµ¬í˜„ ìƒì„¸**:
   - `MarketService`ì— `@Cacheable` ì–´ë…¸í…Œì´ì…˜ ë˜ëŠ” ìˆ˜ë™ Redis ìºì‹± ë¡œì§ ì¶”ê°€
   - `RedisTemplate` ë˜ëŠ” `@Cacheable` ì‚¬ìš© (Spring Cache Abstraction)
   - ìºì‹œ í‚¤ëŠ” `CACHE_KEY_PREFIX` ìƒìˆ˜ë¡œ ê´€ë¦¬
   - ì—ëŸ¬ ë°œìƒ ì‹œ Fallbackìœ¼ë¡œ Stale ìºì‹œ ì¡°íšŒ

7. **í”„ë¡ íŠ¸ì—”ë“œ ì—°ê³„**:
   - í”„ë¡ íŠ¸ì—”ë“œëŠ” `X-Cache-Status` í—¤ë”ë¥¼ í™•ì¸í•˜ì—¬ ìºì‹œ ìƒíƒœ í‘œì‹œ
   - `STALE` ìƒíƒœì¼ ë•ŒëŠ” "ìºì‹œëœ ë°ì´í„°" ì•Œë¦¼ í‘œì‹œ
   - í”„ë¡ íŠ¸ì—”ë“œ localStorage ìºì‹œëŠ” ë°±ì—”ë“œ ì‘ë‹µì„ ë°›ìœ¼ë©´ í•­ìƒ ì—…ë°ì´íŠ¸
   - ë°±ì—”ë“œ Redis ìºì‹œê°€ ìˆìœ¼ë©´ í”„ë¡ íŠ¸ì—”ë“œ localStorage ìºì‹œë„ í•¨ê»˜ ê°±ì‹ 

**ì˜ˆìƒ íš¨ê³¼**:
- ì™¸ë¶€ API í˜¸ì¶œ íšŸìˆ˜ ê°ì†Œ (Redis ìºì‹œ Hit ì‹œ)
- API ì‹¤íŒ¨ ì‹œì—ë„ Stale ë°ì´í„°ë¡œ ì„œë¹„ìŠ¤ ì§€ì†ì„± ë³´ì¥
- í”„ë¡ íŠ¸ì—”ë“œì™€ ë°±ì—”ë“œ ì´ì¤‘ ìºì‹±ìœ¼ë¡œ ì•ˆì •ì„± ê·¹ëŒ€í™”
- ë„¤íŠ¸ì›Œí¬ ì§€ì—° ê°ì†Œ (ìºì‹œ Hit ì‹œ)

**êµ¬í˜„ ìš°ì„ ìˆœìœ„**: High (í”„ë¡ íŠ¸ì—”ë“œ ìºì‹±ê³¼ í•¨ê»˜ ì‚¬ìš© ì‹œ íš¨ê³¼ ê·¹ëŒ€í™”)

**ì°¸ê³ **: í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì´ë¯¸ localStorage ê¸°ë°˜ ìºì‹±ì„ êµ¬í˜„í–ˆìœ¼ë¯€ë¡œ, ë°±ì—”ë“œ Redis ìºì‹±ì€ ì¶”ê°€ì ì¸ ì•ˆì •ì„± ë ˆì´ì–´ë¡œ ì‘ë™í•©ë‹ˆë‹¤.

- **DB ìŠ¤í‚¤ë§ˆ (Flyway V5, V8)**:
  - `stock_candles` í…Œì´ë¸”: `symbol`, `date`, `period` (ë³µí•© PK), `open/high/low/close`, `volume`, `last_updated`
    - `period` í•„ë“œ: `d` (daily), `w` (weekly), `m` (monthly) - V8 ë§ˆì´ê·¸ë ˆì´ì…˜ìœ¼ë¡œ ì¶”ê°€
  - `api_usage_logs` í…Œì´ë¸”: `provider`('EODHD'), `call_date`, `count`
- **EODHD Client êµ¬í˜„**:
  - `EodhdClient`: RestTemplate ê¸°ë°˜, `getHistoricalData(ticker, fromDate, toDate, period, order)` ë©”ì„œë“œ
  - `warning` í•„ë“œ ì²˜ë¦¬: ë¬´ë£Œ êµ¬ë… ì œí•œ(ìµœê·¼ 1ë…„) ê²½ê³  ë©”ì‹œì§€ í•„í„°ë§
  - `QuotaManager`: ì¼ì¼ í˜¸ì¶œ íšŸìˆ˜ ì²´í¬ ë° DB ê¸°ë¡ ë¡œì§ (ì¼ì¼ 20íšŒ ì œí•œ)
- **StockService.getCandles() êµ¬í˜„ ì™„ë£Œ**:
  
  **ì—”ë“œí¬ì¸íŠ¸**: `GET /api/v1/stock/candles/{ticker}`
  
  **Request íŒŒë¼ë¯¸í„°**:
  - `ticker` (path): ì¢…ëª© ì‹¬ë³¼ (ì˜ˆ: "AAPL")
  - `resolution` (query): ì‹œê°„ ê°„ê²© (`d`=daily, `w`=weekly, `m`=monthly)
  - `from` (query): ì‹œì‘ ì‹œê°„ (ISO-8601 í˜•ì‹, ì˜ˆ: "2024-01-19T00:00:00Z")
  - `to` (query): ì¢…ë£Œ ì‹œê°„ (ISO-8601 í˜•ì‹, ì˜ˆ: "2026-01-19T23:59:59Z")
  
  **Response DTO**: `StockCandlesResponse`
  - `ticker`: ì¢…ëª© ì‹¬ë³¼
  - `resolution`: ìš”ì²­í•œ ì‹œê°„ ê°„ê²©
  - `items`: ìº”ë“¤ ë°ì´í„° ë¦¬ìŠ¤íŠ¸ (`timestamp`, `open`, `high`, `low`, `close`, `volume`)
  - `stale`: ë°ì´í„°ê°€ êµ¬ì‹ì¸ì§€ ì—¬ë¶€ (Quota ì´ˆê³¼ ì‹œ ê¸°ì¡´ ë°ì´í„° ë°˜í™˜ í‘œì‹œ)
  
  **êµ¬í˜„ ìƒì„¸**:
  - âœ… Step 1: ë‚ ì§œ ë²”ìœ„ í•„í„°ë§ (from/to íŒŒë¼ë¯¸í„°ë¥¼ LocalDateë¡œ ë³€í™˜í•˜ì—¬ DB ì¡°íšŒ)
  - âœ… Step 2: DB ì¡°íšŒ ì‹œ ë‚ ì§œ ë²”ìœ„ í•„í„°ë§ (`findAllBySymbolAndPeriodAndDateBetweenOrderByDateAsc`)
  - âœ… Step 3: ë°°ì¹˜ ë¡œë“œ ì „ëµ
    - ì „ì²´ ë°°ì¹˜ ë¡œë“œ: d ë°ì´í„°ê°€ ì—†ì„ ë•Œ d, w, m ëª¨ë‘ í•œë²ˆì— ê°€ì ¸ì˜¤ê¸° (Quota 1íšŒë§Œ ì¹´ìš´íŠ¸)
    - ë¶€ë¶„ ë°°ì¹˜ ë¡œë“œ: dëŠ” ìˆì§€ë§Œ w, m ì¤‘ ì¼ë¶€ê°€ ì—†ì„ ë•Œ ëˆ„ë½ëœ ê²ƒë§Œ ê°€ì ¸ì˜¤ê¸° (Quota 1íšŒë§Œ ì¹´ìš´íŠ¸)
    - ê°œë³„ ë³´ì™„: ìš”ì²­ëœ resolutionë§Œ ê°œë³„ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°
  - âœ… Step 4: EODHD API í˜¸ì¶œ ì‹œ ë‚ ì§œ ë²”ìœ„ ì „ë‹¬ (`getHistoricalData(ticker, fromDate, toDate, period, order)`)
  - âœ… Step 5: DB ì €ì¥ ì‹œ ë‚ ì§œ ë²”ìœ„ ë°ì´í„°ë§Œ ì €ì¥ (UPSERT ì „ëµ, `period` í•„ë“œ í¬í•¨)
  - âœ… Step 6: ì‘ë‹µ ë°ì´í„° í•„í„°ë§ (ìš”ì²­í•œ ë‚ ì§œ ë²”ìœ„ì˜ ë°ì´í„°ë§Œ ë°˜í™˜)
  - âœ… Step 7: ë°ì´í„° ìµœì‹ ì„± ì²´í¬ (ì˜¤ëŠ˜ ì¥ ì¢…ë£Œ í›„ ì˜¤ëŠ˜ ë°ì´í„° ì¡´ì¬ ì—¬ë¶€)
  - âœ… Step 8: Quota ì²´í¬ â†’ EODHD í˜¸ì¶œ ë˜ëŠ” ê¸°ì¡´ ë°ì´í„° ë°˜í™˜
  - âœ… Step 9: Quota ì´ˆê³¼ ì‹œ Case A(ê¸°ì¡´ ë°ì´í„° ë°˜í™˜ + `stale=true` í‘œì‹œ) ë˜ëŠ” Case B(429 ì—ëŸ¬)
  
  **âš ï¸ ì£¼ì˜ì‚¬í•­**:
  - **EODHD ë¬´ë£Œ êµ¬ë… ì œí•œ**: ìµœê·¼ 1ë…„ ë°ì´í„°ë§Œ ì œê³µ. 1ë…„ ì´ì „ ë‚ ì§œ ë²”ìœ„ ìš”ì²­ ì‹œ `warning` í•„ë“œê°€ í¬í•¨ë  ìˆ˜ ìˆìŒ
  - **ê²½ê³  ë©”ì‹œì§€ ì²˜ë¦¬**: EODHD API ì‘ë‹µì˜ `warning` í•„ë“œëŠ” í•„í„°ë§í•˜ì—¬ ìœ íš¨í•œ ìº”ë“¤ ë°ì´í„°ë§Œ ì €ì¥
  - **í‹°ì»¤ í˜•ì‹**: EODHD APIëŠ” `{SYMBOL}.{EXCHANGE_ID}` í˜•ì‹ ê¶Œì¥ (ì˜ˆ: `AAPL.US`). ê±°ë˜ì†Œ ì½”ë“œê°€ ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ `.US` ì¶”ê°€
- **ì´ˆê¸° êµ¬ì¶• ì „ëµ (Seed Data)**:
  - ì„œë²„ ì‹œì‘ ì‹œì ì´ ì•„ë‹ˆë¼, **"ìµœì´ˆ ìš”ì²­ ì‹œ"** ë˜ëŠ” **"ê´€ë¦¬ì íŠ¸ë¦¬ê±°"**ë¡œ ì¸ê¸° ì¢…ëª©(Top 10)ë§Œ ìš°ì„  ì ì¬
  - ë¹„ì¸ê¸° ì¢…ëª©ì€ ìš”ì²­ì´ ë“¤ì–´ì˜¬ ë•Œ ì¿¼í„°ê°€ ë‚¨ìœ¼ë©´ ì ì¬
- **Market Movers ìºì‹±** (êµ¬í˜„ ì™„ë£Œ):
  - Redisì— 1ë¶„~5ë¶„ê°„ ìºì‹± (`MarketService.getMovers()` ê²°ê³¼)
  - **DB ê´€ë¦¬**: `market_cap_stocks` í…Œì´ë¸”ë¡œ Top 20 Market Cap ì¢…ëª© ê´€ë¦¬ (Flyway V6)
    - Entity: `MarketCapStock` (`symbol`, `company_name`, `market_cap_rank`, `is_active`)
    - Repository: `MarketCapStockRepository.findByIsActiveTrueOrderByMarketCapRankAsc()`
    - ì´ˆê¸° ë°ì´í„°: 20ê°œ ì¢…ëª© ì‹œë“œ (2026-01-19 ê¸°ì¤€)
      - ìƒìœ„ 20ê°œ: `AAPL`, `MSFT`, `GOOGL`, `AMZN`, `NVDA`, `META`, `TSLA`, `BRK.B`, `V`, `UNH`, `JNJ`, `WMT`, `JPM`, `MA`, `PG`, `HD`, `DIS`, `AVGO`, `PEP`, `COST`
    - Fallback: DBì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ í•˜ë“œì½”ë”© ë¦¬ìŠ¤íŠ¸(10ê°œ ì¢…ëª©) ì‚¬ìš©
    - ì¢…ëª©ëª… ì¡°íšŒ: DBì˜ `company_name` ìš°ì„  ì‚¬ìš©, ì—†ìœ¼ë©´ Search APIë¡œ ì¡°íšŒ
  - **ë°ì´í„° íë¦„**:
    ```mermaid
    flowchart TD
        A[GET /api/v1/market/movers] --> B[MarketService.getMovers]
        B --> C{DBì— ë°ì´í„° ìˆìŒ?}
        C -->|Yes| D[MarketCapStockRepository ì¡°íšŒ]
        C -->|No| E[Fallback: í•˜ë“œì½”ë”© ë¦¬ìŠ¤íŠ¸]
        D --> F[í™œì„±í™”ëœ ì¢…ëª© 20ê°œ ì¡°íšŒ]
        E --> G[ê¸°ì¡´ 10ê°œ ì¢…ëª©]
        F --> H[ê° ì¢…ëª© Quote API í˜¸ì¶œ]
        G --> H
        H --> I[changePercent ê¸°ì¤€ ì •ë ¬]
        I --> J[ìƒìœ„ 5ê°œ ë°˜í™˜]
        J --> K[MarketMoversResponse]
    ```
  - **í–¥í›„ í™•ì¥ ê°€ëŠ¥ì„±** (Phase 9 ê³„íš):
    1. **ê´€ë¦¬ì API**: ì¢…ëª© ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì—”ë“œí¬ì¸íŠ¸ (Phase 9.1)
    2. **ìë™ ê°±ì‹ **: ìŠ¤ì¼€ì¤„ëŸ¬ë¡œ ì‹œê°€ì´ì•¡ ìˆœìœ„ ìë™ ì—…ë°ì´íŠ¸ (Phase 9.2)
    3. **ë‹¤ë¥¸ ì‹œì¥**: í•œêµ­/ì¼ë³¸ ë“± ë‹¤ë¥¸ ì‹œì¥ì˜ Top 20 ì¶”ê°€ (Phase 9.3)

### 12.5 Phase 4: Trade/Portfolio Engine (í”„ë¡ íŠ¸ `/trade`, `/portfolio` ì™„ì„±)

- **êµ¬í˜„ ëŒ€ìƒ**: `TradeController/Service`, `PortfolioService`, `WalletService`
- **ì—”ë“œí¬ì¸íŠ¸**:
  - `GET /api/v1/trade/available-balance`
  - `POST /api/v1/trade/order`
  - `GET /api/v1/trade/portfolio`
  - `GET /api/v1/trade/history`
- **ë¬´ê²°ì„±**: ë™ì‹œ ìš”ì²­ ëŒ€ë¹„ íŠ¸ëœì­ì…˜/ë½ ì „ëµì„ ëª…í™•íˆ í•˜ê³ (ëª…ì„¸ì„œì˜ íë¦„ ê·¸ëŒ€ë¡œ) í…ŒìŠ¤íŠ¸ë¡œ ê³ ì •

#### 12.5.1 Phase 4 ìƒì„¸ ì„¤ê³„

**íŠ¸ëœì­ì…˜ ë° ë½ ì „ëµ**:

- **ë¹„ê´€ì  ë½ (Pessimistic Lock) ì‚¬ìš©**
  - `WalletRepository.findByUserIdWithLock()`: Wallet ì¡°íšŒ ì‹œ ë½ íšë“
  - `PortfolioRepository.findByUserIdAndTickerWithLock()`: Portfolio ì¡°íšŒ ì‹œ ë½ íšë“
  - ë½ ë²”ìœ„: íŠ¸ëœì­ì…˜ ì‹œì‘ ì‹œì ë¶€í„° ì»¤ë°‹ê¹Œì§€ ìœ ì§€

- **íŠ¸ëœì­ì…˜ ê²©ë¦¬ ìˆ˜ì¤€**
  - ê¸°ë³¸ê°’: `READ_COMMITTED` (PostgreSQL ê¸°ë³¸ê°’)
  - ë½ íƒ€ì„ì•„ì›ƒ: 5ì´ˆ (ê¸°ë³¸ê°’, í•„ìš” ì‹œ ì¡°ì •)

- **íŠ¸ëœì­ì…˜ ë²”ìœ„**
  - `@Transactional` ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì „ì²´ ê±°ë˜ë¥¼ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì²˜ë¦¬
  - âœ… **ì™¸ë¶€ API í˜¸ì¶œ(`StockService.getQuote()`)ì€ íŠ¸ëœì­ì…˜ ì™¸ë¶€ì—ì„œ í˜¸ì¶œë¨**
    - `executeOrder()`: ì™¸ë¶€ API í˜¸ì¶œ (íŠ¸ëœì­ì…˜ ì—†ìŒ)
    - `executeOrderInTransaction()`: ì‹¤ì œ ê±°ë˜ ë¡œì§ (íŠ¸ëœì­ì…˜ ë‚´ë¶€)
    - ì™¸ë¶€ API ì§€ì—° ì‹œì—ë„ íŠ¸ëœì­ì…˜ ìœ ì§€ ì‹œê°„ì„ ìµœì†Œí™”í•˜ì—¬ ì„±ëŠ¥ ê°œì„ 
  - âœ… **Self-invocation ë¬¸ì œ í•´ê²°**: Spring AOP í”„ë¡ì‹œ ë™ì‘ì„ ìœ„í•´ ìê¸° ì£¼ì…(Self-injection) íŒ¨í„´ ì‚¬ìš©
    - `TradeService`ì— `@Autowired @Lazy private TradeService self` ì£¼ì…
    - `executeOrder()`ì—ì„œ `self.executeOrderInTransaction()` í˜¸ì¶œë¡œ í”„ë¡ì‹œë¥¼ ê²½ìœ í•˜ì—¬ íŠ¸ëœì­ì…˜ ì ìš©
    - `executeOrderInTransaction()`ì€ `public`ìœ¼ë¡œ ë³€ê²½ (í”„ë¡ì‹œ í˜¸ì¶œ ê°€ëŠ¥í•˜ë„ë¡)
    - ë³´ì•ˆ: Controllerì— ë§¤í•‘ë˜ì§€ ì•Šì•„ ì™¸ë¶€ HTTP ìš”ì²­ìœ¼ë¡œëŠ” ì ‘ê·¼ ë¶ˆê°€ëŠ¥

**ê±°ë˜ ì‹¤í–‰ íë¦„ ë‹¤ì´ì–´ê·¸ë¨**:

ë§¤ìˆ˜ ì£¼ë¬¸ íë¦„:

```mermaid
sequenceDiagram
    participant C as Controller
    participant TS as TradeService
    participant WR as WalletRepository
    participant PR as PortfolioRepository
    participant SSR as StockService
    participant TLR as TradeLogRepository
    
    C->>TS: executeOrder(userId, request)
    activate TS
    
    TS->>SSR: getQuote(ticker)
    Note over TS,SSR: íŠ¸ëœì­ì…˜ ì™¸ë¶€ì—ì„œ í˜¸ì¶œ
    SSR-->>TS: currentPrice
    
    TS->>TS: executeOrderInTransaction()
    Note over TS: @Transactional ì‹œì‘
    
    TS->>WR: findByUserIdWithLock(userId)
    WR-->>TS: Wallet (ë½ íšë“)
    
    TS->>TS: ì”ê³  í™•ì¸
    alt ì”ê³  ë¶€ì¡±
        TS-->>C: TradeException(INSUFFICIENT_BALANCE)
    end
    
    TS->>PR: findByUserIdAndTickerWithLock(userId, ticker)
    PR-->>TS: Portfolio or Empty (ë½ íšë“)
    
    TS->>TS: Wallet.deductCash()
    TS->>TS: Portfolio.addQuantity() or ìƒì„±
    
    TS->>TLR: save(TradeLog)
    TS->>WR: save(Wallet)
    TS->>PR: save(Portfolio)
    
    Note over TS: íŠ¸ëœì­ì…˜ ì»¤ë°‹ (ë½ í•´ì œ)
    TS-->>C: TradeResponse
    deactivate TS
```

ë§¤ë„ ì£¼ë¬¸ íë¦„:

```mermaid
sequenceDiagram
    participant C as Controller
    participant TS as TradeService
    participant WR as WalletRepository
    participant PR as PortfolioRepository
    participant SSR as StockService
    participant TLR as TradeLogRepository
    
    C->>TS: executeOrder(userId, request)
    activate TS
    
    TS->>SSR: getQuote(ticker)
    Note over TS,SSR: íŠ¸ëœì­ì…˜ ì™¸ë¶€ì—ì„œ í˜¸ì¶œ
    SSR-->>TS: currentPrice
    
    TS->>TS: executeOrderInTransaction()
    Note over TS: @Transactional ì‹œì‘
    
    TS->>WR: findByUserIdWithLock(userId)
    WR-->>TS: Wallet (ë½ íšë“)
    
    TS->>TS: executeSellOrder í˜¸ì¶œ
    
    TS->>PR: findByUserIdAndTickerWithLock(userId, ticker)
    PR-->>TS: Portfolio (ë½ íšë“)
    
    alt ë³´ìœ  ìˆ˜ëŸ‰ ì—†ìŒ
        TS-->>C: TradeException(INSUFFICIENT_QUANTITY)
    end
    
    TS->>TS: ë³´ìœ  ìˆ˜ëŸ‰ í™•ì¸
    alt ìˆ˜ëŸ‰ ë¶€ì¡±
        TS-->>C: TradeException(INSUFFICIENT_QUANTITY)
    end
    
    TS->>TS: ì‹¤í˜„ ì†ìµ ê³„ì‚°
    TS->>TS: Portfolio.subtractQuantity()
    
    TS->>TS: Wallet.addCash()
    TS->>TS: Wallet.addRealizedProfit()
    
    alt Portfolio.isEmpty()
        TS->>PR: delete(Portfolio)
    end
    
    TS->>TLR: save(TradeLog with realizedPnl)
    TS->>WR: save(Wallet)
    TS->>PR: save(Portfolio) or delete
    
    Note over TS: íŠ¸ëœì­ì…˜ ì»¤ë°‹ (ë½ í•´ì œ)
    TS-->>C: TradeResponse
    deactivate TS
```

**ë™ì‹œì„± ë¬¸ì œ í•´ê²° ë°©ì•ˆ**:

1. **ë™ì‹œ ë§¤ìˆ˜ ì£¼ë¬¸**: ë¹„ê´€ì  ë½ìœ¼ë¡œ Wallet ì¡°íšŒ ì‹œ ë½ íšë“, í•œ ë²ˆì— í•˜ë‚˜ì˜ ê±°ë˜ë§Œ ì‹¤í–‰
2. **ë™ì‹œ ë§¤ë„ ì£¼ë¬¸**: ë¹„ê´€ì  ë½ìœ¼ë¡œ Portfolio ì¡°íšŒ ì‹œ ë½ íšë“, í•œ ë²ˆì— í•˜ë‚˜ì˜ ê±°ë˜ë§Œ ì‹¤í–‰
3. **ë§¤ìˆ˜/ë§¤ë„ ë™ì‹œ ì‹¤í–‰**: ë¹„ê´€ì  ë½ìœ¼ë¡œ Portfolioì™€ Wallet ëª¨ë‘ ë½ íšë“, ìˆœì°¨ ì‹¤í–‰

**Service êµ¬í˜„ ìƒì„¸**:

- **TradeService**
  - `executeOrder()`: ê±°ë˜ ì£¼ë¬¸ ì‹¤í–‰ (ì™¸ë¶€ API í˜¸ì¶œ, íŠ¸ëœì­ì…˜ ì™¸ë¶€)
  - `executeOrderInTransaction()`: íŠ¸ëœì­ì…˜ ë‚´ë¶€ì—ì„œ ê±°ë˜ ì‹¤í–‰ (ë¹„ê´€ì  ë½ í¬í•¨)
  - `executeBuyOrder()`: ë§¤ìˆ˜ ì£¼ë¬¸ ì‹¤í–‰ (ì”ê³  í™•ì¸, Portfolio ìƒì„±/ì—…ë°ì´íŠ¸, í‰ë‹¨ê°€ ì¬ê³„ì‚°)
  - `executeSellOrder()`: ë§¤ë„ ì£¼ë¬¸ ì‹¤í–‰ (ìˆ˜ëŸ‰ í™•ì¸, ì‹¤í˜„ ì†ìµ ê³„ì‚°, Portfolio ì‚­ì œ)
  - `getTradeHistory()`: ê±°ë˜ ë‚´ì—­ ì¡°íšŒ (í˜ì´ì§•, ê¸°ê°„ í•„í„°ë§ ì§€ì›)

- **PortfolioService**
  - `getPortfolio()`: í¬íŠ¸í´ë¦¬ì˜¤ ì¡°íšŒ ë° í‰ê°€ (í˜„ì¬ê°€ ì¡°íšŒ, ì†ìµë¥  ê³„ì‚°, í˜„ì¬ê°€ ì¡°íšŒ ì‹¤íŒ¨ ì‹œ ì²˜ë¦¬)

- **WalletService**
  - `getAvailableBalance()`: ë§¤ìˆ˜ ê°€ëŠ¥ ê¸ˆì•¡ ì¡°íšŒ

**í…ŒìŠ¤íŠ¸ ì „ëµ**:

- **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**: ì”ê³  ë¶€ì¡±, ìˆ˜ëŸ‰ ë¶€ì¡± ì‹œë‚˜ë¦¬ì˜¤
- **í†µí•© í…ŒìŠ¤íŠ¸**: ì „ì²´ ê±°ë˜ íë¦„ ê²€ì¦
- **ë™ì‹œì„± í…ŒìŠ¤íŠ¸**: ë™ì‹œ ë§¤ìˆ˜/ë§¤ë„ ì£¼ë¬¸ ì‹œë‚˜ë¦¬ì˜¤ (ë½ ë™ì‘ í™•ì¸)
- **íŠ¸ëœì­ì…˜ ê²€ì¦ í…ŒìŠ¤íŠ¸**: 
  - íŠ¸ëœì­ì…˜ ë¡¤ë°± í™•ì¸ (`TradeServiceTransactionTest.testTransactionRollbackOnException`)
  - íŠ¸ëœì­ì…˜ ì»¤ë°‹ í™•ì¸ (`TradeServiceTransactionTest.testTransactionCommitOnSuccess`)
  - ì™¸ë¶€ API í˜¸ì¶œì´ íŠ¸ëœì­ì…˜ ì™¸ë¶€ì—ì„œ ìˆ˜í–‰ë˜ëŠ”ì§€ í™•ì¸
  - ë¹„ê´€ì  ë½ ë™ì‘ í™•ì¸ (`TradeServiceTransactionTest.testPessimisticLockSequentialProcessing`)
  - í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ ë ˆë²¨ `@Transactional` ì œê±° (ë™ì‹œì„± í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´)
  - ìŠ¤ë ˆë“œ ì•ˆì „í•œ ë¦¬ìŠ¤íŠ¸ ì‚¬ìš© (`Collections.synchronizedList()`)
  - `StockService` ëª¨í‚¹ (`@MockBean`)ìœ¼ë¡œ ì™¸ë¶€ API í˜¸ì¶œ ë³€ìˆ˜ ì œê±°

### 12.6 Phase 5: Shop/Game/Ranking (í”„ë¡ íŠ¸ `/shop`, `/mypage`, `/ranking`)

- **êµ¬í˜„ ëŒ€ìƒ**: `GameController`, `GachaService`, `InventoryService`, `RankingService`
- **ì—”ë“œí¬ì¸íŠ¸**:
  - `GET /api/v1/game/items` (Query: `category`)
  - `POST /api/v1/game/gacha`
  - `GET /api/v1/game/inventory`
  - `PUT /api/v1/game/equip/{itemId}`
  - `GET /api/v1/game/ranking` (ë­í‚¹ ì°¸ì—¬ í† ê¸€ ë°˜ì˜)

### 12.6.1 Phase 5.5: í”„ë¡ íŠ¸ ì—°ë™Â·DB ë³´ê°• (Shop/Gacha/Inventory/Ranking)

- **ëª©í‘œ**: Phase 5ì—ì„œ êµ¬í˜„ëœ Game/Shop/Ranking APIë¥¼ í”„ë¡ íŠ¸ 2.7.11 ì‹¤ì œ í™”ë©´ì— ì—°ê²°í•˜ê³ , DB/ì‘ë‹µ ì œì•½ì„ ë‹¨ë‹¨íˆ ê³ ì •
- **ì—°ë™ ì²´í¬ë¦¬ìŠ¤íŠ¸ (í”„ë¡ íŠ¸ ìƒíƒœ: ì „ë©´ Mock â†’ ì‹¤ë°ì´í„° ì „í™˜)**:
  - `/api/v1/game/items` â†’ ìƒì  ëª©ë¡/í™•ë¥  ì¹´ë“œ (ì¹´í…Œê³ ë¦¬ `NAMEPLATE|AVATAR|THEME` ê³ ì •, `{ items: [...] }` íŒ¨í„´)
  - `/api/v1/game/gacha` â†’ ê°€ì±  ê²°ê³¼/ì½”ì¸ ì°¨ê° UI (ì¤‘ë³µ ì‹œ ì¬ì¶”ì²¨ ì‹¤íŒ¨ ì½”ë“œ `GAME_002` ëŒ€ì‘)
  - `/api/v1/game/inventory` + `/api/v1/game/equip/{itemId}` â†’ ì¸ë²¤í† ë¦¬/ì¥ì°© ë‹¨ì¼ì„± ë³´ì¥ UI
  - `/api/v1/game/ranking` â†’ ë­í‚¹/ì°¸ì—¬ í† ê¸€ ì—°ë™ (`is_ranking_joined` ë°˜ì˜)
- **DB/ì œì•½ ë³´ê°•**:
  - `items.category`ëŠ” Flyway V3ì—ì„œ ë ˆê±°ì‹œ ë§¤í•‘ + `CHECK (category IN ('NAMEPLATE','AVATAR','THEME'))` ì œì•½ê¹Œì§€ ì´ë¯¸ ì ìš©ë˜ì–´ ìˆìœ¼ë©°, Unknown ê°’ ì¡´ì¬ ì‹œ ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì‹¤íŒ¨í•˜ë„ë¡ ê³ ì •ë¨
  - ì‘ë‹µ DTOëŠ” `FULL_SPECIFICATION` 5.0/5.5 ê¸°ì¤€ì˜ `items` ë˜í¼ì™€(í•„ìš” ì‹œ) `asOf` í•„ë“œë¥¼ ìœ ì§€í•´ í”„ë¡ íŠ¸ ì—°ë™ ì‹œ í˜¸í™˜ì„± ë³´ì¥
- **ì‹¤ì‹œê°„/ì§€í‘œ ì •í•©ì„±**:
  - STOMP ì—”ë“œí¬ì¸íŠ¸ `/ws-stomp` ì¬í™•ì¸(í”„ë¡ íŠ¸ ë¬¸ì„œì™€ ë™ì¼)
  - ì§€ìˆ˜ ë°ì´í„°ëŠ” ETF(SPY/QQQ/DIA) ì‚¬ìš© ë¬¸êµ¬ë¥¼ í”„ë¡ íŠ¸/ìŠ¤í™ê³¼ ì¼ì¹˜ì‹œì¼œ í†µì‹ /ìºì‹± ì •ì±… í˜¼ì„  ì œê±°

### 12.6.2 Phase 5.6: WebSocket êµ¬ë… ê´€ë¦¬ì êµ¬í˜„ (DATA_STRATEGY_PLAN ê¸°ë°˜)

- **êµ¬í˜„ ëŒ€ìƒ**: `StockSubscriptionManager` (Thread-safe)
- **ê¸°ëŠ¥**:
  - Active Sessions Map: ì‚¬ìš©ìë³„ í˜„ì¬ ë³´ê³  ìˆëŠ” ì¢…ëª© ì¶”ì 
  - Subscription Pool: Finnhub WebSocket êµ¬ë… ì¤‘ì¸ ì‹¬ë³¼ ë¦¬ìŠ¤íŠ¸ (Max 50)
  - LRU ê¸°ë°˜ ìë™ í•´ì œ: 50ê°œ ì´ˆê³¼ ì‹œ ê°€ì¥ ì˜¤ë˜ëœ ë¹„í™œì„± ì¢…ëª© í•´ì œ
- **ì´ë²¤íŠ¸ í›…**: STOMP Subscribe/Unsubscribe ì´ë²¤íŠ¸(`@EventListener`)ì—ì„œ Manager í˜¸ì¶œ

### 12.7 Phase 6: ì‹¤ì‹œê°„(STOMP) + Finnhub WebSocket ì—°ë™ (êµ¬í˜„ ì™„ë£Œ)

**êµ¬í˜„ ì¼ì**: 2026-01-19

**êµ¬í˜„ ë‚´ìš©**:
- âœ… `FinnhubTradesWebSocketClient`: Finnhub Trades WebSocket ì‹±ê¸€í†¤ í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„
  - API í‚¤ë‹¹ 1ê°œ ì—°ê²° ë³´ì¥
  - ì§€ìˆ˜ ë°±ì˜¤í”„ ì¬ì—°ê²° ì „ëµ
  - êµ¬ë… ë²„í¼ë§ ë° ì¬êµ¬ë… ì§€ì› (active/pending êµ¬ë… ì„¸íŠ¸ ê´€ë¦¬)
- âœ… `TradePriceBroadcastService`: Trade ë©”ì‹œì§€ ì •ê·œí™” ë° ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì„œë¹„ìŠ¤
  - Redis ìºì‹œ ì—…ë°ì´íŠ¸ (`stock:price:{ticker}`, TTL 24ì‹œê°„)
  - STOMP ë¸Œë¡œë“œìºìŠ¤íŠ¸ (`/topic/stock.ticker.{ticker}`)
  - Payload ìŠ¤í‚¤ë§ˆ: `ticker`, `price`, `ts`, `volume`, `source="FINNHUB"`, `rawType="trade"`, `conditions[]` (volume=0ì¸ price updateë„ í—ˆìš©)
- âœ… `FinnhubClient.subscribe/unsubscribe`: ì‹¤ì œ WebSocket ë©”ì‹œì§€ ì „ì†¡ìœ¼ë¡œ ì—°ê²°
- âœ… `StompDestinationUtils`: STOMP destination ìƒì„±/íŒŒì‹± ìœ í‹¸ë¦¬í‹° (`/topic/stock.ticker.{ticker}` ìƒì„±, ê³µë°±/ì½œë¡  í¬í•¨ ticker ì§€ì›)
- âœ… ë©”ì‹œì§€ íŒŒì‹±: ë‹¤ê±´ trade, `v=0` ì—…ë°ì´íŠ¸, ì˜ˆì™¸ ì²˜ë¦¬
- âœ… í…ŒìŠ¤íŠ¸: ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ë° í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±

**í† í”½(í”„ë¡ íŠ¸ ë¬¸ì„œ ê¸°ì¤€)**:
- `/topic/stock.indices` (êµ¬í˜„ ì™„ë£Œ)
- `/topic/stock.ticker.{ticker}` (êµ¬í˜„ ì™„ë£Œ)
- `/user/queue/trade` (êµ¬í˜„ ì™„ë£Œ)

**ì¶”ê°€ êµ¬í˜„ ë‚´ìš© (2026-01-19)**:
- âœ… `WatchlistService`: ê´€ì‹¬ì¢…ëª© ì¡°íšŒ/ì¶”ê°€/ì‚­ì œ ì„œë¹„ìŠ¤ êµ¬í˜„
- âœ… `UserController`: `/api/v1/user/watchlist` ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€ (GET/POST/DELETE)
- âœ… `MarketIndicesBroadcastService`: 10ì´ˆ ì£¼ê¸°ë¡œ `/topic/stock.indices` ë¸Œë¡œë“œìºìŠ¤íŠ¸
- âœ… `TradeService`: ê±°ë˜ ì²´ê²° ì‹œ `/user/queue/trade` ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì¶”ê°€
- âœ… `TradeNotificationDto`: ì²´ê²° ì•Œë¦¼ DTO ì¶”ê°€
- âœ… `@EnableScheduling`: AppConfigì— ìŠ¤ì¼€ì¤„ëŸ¬ í™œì„±í™” ì¶”ê°€

### 12.8 Phase 7: CI/CD + í…ŒìŠ¤íŠ¸ ì „ëµ (í›„ì†, í’ˆì§ˆ ê²Œì´íŠ¸ ê³ ì •)

í˜„ì¬ CIì˜ `Build Test`ëŠ” `./gradlew clean build`ë¥¼ ìˆ˜í–‰í•˜ë¯€ë¡œ, **í…ŒìŠ¤íŠ¸ê°€ ì‹¤ì œë¡œ ì‹¤í–‰**ë©ë‹ˆë‹¤.  
ë‹¤ë§Œ `@SpringBootTest` ê¸°ë°˜ í†µí•© í…ŒìŠ¤íŠ¸ëŠ” Postgres/Redis/Flyway ë“± ì™¸ë¶€ ì¸í”„ë¼ ì˜ì¡´ì´ ìˆì–´, CIì—ì„œ â€œí•­ìƒ í†µê³¼â€ì‹œí‚¤ë ¤ë©´ ì•„ë˜ ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•´ ê³ ì •í•´ì•¼ í•©ë‹ˆë‹¤.

- **Option A (Service ë¶™ì´ê¸° / CI ì¹œí™”)**: GitHub Actions ì›Œí¬í”Œë¡œìš°ì— Postgres/Redis ì„œë¹„ìŠ¤ë¥¼ ì¶”ê°€í•˜ê³ , í…ŒìŠ¤íŠ¸ì—ì„œ í•´ë‹¹ ì„œë¹„ìŠ¤ë¡œ ì—°ê²°
  - ì¥ì : ìš´ì˜ê³¼ ê°€ì¥ ìœ ì‚¬í•œ í™˜ê²½ì—ì„œ ê²€ì¦
  - ë‹¨ì : CI ì‹œê°„ ì¦ê°€, ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™”/í—¬ìŠ¤ì²´í¬ ê´€ë¦¬ í•„ìš”
- **Option B (í…ŒìŠ¤íŠ¸ í”„ë¡œíŒŒì¼/ë‚´ì¥ ëŒ€ì²´ / ë¹ ë¥¸ í”¼ë“œë°±)**: `application-test.yml`ë¡œ H2/embedded ë˜ëŠ” Testcontainers ê¸°ë°˜ í”„ë¡œíŒŒì¼ì„ ë„ì…í•´ ì™¸ë¶€ ì˜ì¡´ ì—†ì´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
  - ì¥ì : ë¹ ë¥´ê³  ì•ˆì •ì , ë¡œì»¬/CI ì¼ê´€ì„± ë†’ìŒ
  - ë‹¨ì : ìš´ì˜(Postgres/Redis)ê³¼ ì°¨ì´ê°€ ìƒê¸¸ ìˆ˜ ìˆì–´ ì¼ë¶€ í†µí•© ë²„ê·¸ë¥¼ ë†“ì¹  ìˆ˜ ìˆìŒ

> ìœ„ 2ê°€ì§€ëŠ” â€œCI/CD êµ¬ì„± ë‹¨ê³„â€ì—ì„œ ì„ íƒ/ê³ ì •í•˜ê³ , ì„ íƒ ê²°ê³¼ë¥¼ `docs`ì— ë°˜ì˜í•˜ì—¬ íŒ€ í•©ì˜(ë‹¨ì¼ ì§„ì‹¤)ë¡œ ìœ ì§€í•©ë‹ˆë‹¤.

---

### 12.9 Phase 8: ì™¸ë¶€ API í™•ì¥ ì „ëµ (í–¥í›„ ê°œì„ )

í˜„ì¬ EODHD APIëŠ” ë¬´ë£Œ êµ¬ë… ì œí•œ(ìµœê·¼ 1ë…„ ë°ì´í„°ë§Œ ì œê³µ)ê³¼ ì¼ì¼ í˜¸ì¶œ ì œí•œ(20íšŒ)ì´ ìˆì–´, ì¥ê¸°ì ì¸ ë°ì´í„° ì œê³µì— í•œê³„ê°€ ìˆìŠµë‹ˆë‹¤.

**í™•ì¥ ë°©í–¥**:
1. **ë‹¤ì¤‘ API Provider ì „ëµ**:
   - EODHD ì™¸ì— ë‹¤ë¥¸ ë¬´ë£Œ/ìœ ë£Œ Historical Data APIë¥¼ ì¶”ê°€ë¡œ ì—°ë™
   - ì˜ˆ: Alpha Vantage, Yahoo Finance (ë¹„ê³µì‹), Polygon.io ë“±
   - Providerë³„ Quotaë¥¼ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê³ , ìš°ì„ ìˆœìœ„ì— ë”°ë¼ ìë™ ì „í™˜

2. **API Provider ì¶”ìƒí™”**:
   - `HistoricalDataProvider` ì¸í„°í˜ì´ìŠ¤ ë„ì…
   - `EodhdProvider`, `AlphaVantageProvider` ë“± êµ¬í˜„ì²´ë¡œ ë¶„ë¦¬
   - `ProviderManager`ì—ì„œ Quota ìƒíƒœì— ë”°ë¼ ìë™ìœ¼ë¡œ Provider ì„ íƒ

3. **ë°ì´í„° ë³‘í•© ì „ëµ**:
   - ì—¬ëŸ¬ Providerì—ì„œ ë°›ì€ ë°ì´í„°ë¥¼ `stock_candles` í…Œì´ë¸”ì— ë³‘í•©
   - ì¤‘ë³µ ë°ì´í„°ëŠ” `last_updated`ê°€ ìµœì‹ ì¸ ê²ƒì„ ìš°ì„ 
   - Providerë³„ ì‹ ë¢°ë„ ì ìˆ˜ ê¸°ë°˜ ê°€ì¤‘ì¹˜ ì ìš© ê°€ëŠ¥

4. **Fallback ë©”ì»¤ë‹ˆì¦˜**:
   - Primary Provider (EODHD) Quota ì´ˆê³¼ ì‹œ â†’ Secondary Providerë¡œ ìë™ ì „í™˜
   - ëª¨ë“  Provider Quota ì´ˆê³¼ ì‹œ â†’ DBì— ì €ì¥ëœ ê¸°ì¡´ ë°ì´í„° ë°˜í™˜ (Stale í‘œì‹œ)

5. **ë°ì´í„° ìˆ˜ì§‘ ìµœì í™”**:
   - ì¸ê¸° ì¢…ëª©ì€ ì—¬ëŸ¬ Providerì—ì„œ ìˆ˜ì§‘í•˜ì—¬ ë°ì´í„° ì™„ì„±ë„ í–¥ìƒ
   - ë¹„ì¸ê¸° ì¢…ëª©ì€ Primary Providerë§Œ ì‚¬ìš©í•˜ì—¬ Quota ì ˆì•½

**êµ¬í˜„ ìš°ì„ ìˆœìœ„**:
- Phase 8.1: `HistoricalDataProvider` ì¸í„°í˜ì´ìŠ¤ ì„¤ê³„ ë° EODHDë¥¼ Providerë¡œ ë¦¬íŒ©í† ë§
- Phase 8.2: Alpha Vantage ë˜ëŠ” ë‹¤ë¥¸ ë¬´ë£Œ API Provider ì¶”ê°€ êµ¬í˜„
- Phase 8.3: `ProviderManager` êµ¬í˜„ ë° ìë™ ì „í™˜ ë¡œì§
- Phase 8.4: ë°ì´í„° ë³‘í•© ë° Fallback ë©”ì»¤ë‹ˆì¦˜ êµ¬í˜„

### 12.10 Phase 9: Market Movers ê´€ë¦¬ ê¸°ëŠ¥ (í–¥í›„ ê°œì„ )

í˜„ì¬ `market_cap_stocks` í…Œì´ë¸”ì˜ ì¢…ëª© ë¦¬ìŠ¤íŠ¸ëŠ” ì´ˆê¸° ë°ì´í„°ë¡œë§Œ ê´€ë¦¬ë˜ê³  ìˆìœ¼ë©°, ì‹œê°€ì´ì•¡ ìˆœìœ„ëŠ” ë³€ë™ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**êµ¬í˜„ ë°©í–¥**:
1. **ê´€ë¦¬ì API**: ì¢…ëª© ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ì—”ë“œí¬ì¸íŠ¸
   - `POST /api/v1/admin/market-cap-stocks`: ì¢…ëª© ë¦¬ìŠ¤íŠ¸ ì¼ê´„ ì—…ë°ì´íŠ¸
   - `PUT /api/v1/admin/market-cap-stocks/{id}`: ê°œë³„ ì¢…ëª© ìˆ˜ì • (ìˆœìœ„, í™œì„±í™” ì—¬ë¶€ ë“±)
   - `DELETE /api/v1/admin/market-cap-stocks/{id}`: ì¢…ëª© ì‚­ì œ (ë¹„í™œì„±í™”)
   - ì¸ì¦: ê´€ë¦¬ì ê¶Œí•œ í•„ìš” (ROLE_ADMIN)
   
2. **ìë™ ê°±ì‹ **: ìŠ¤ì¼€ì¤„ëŸ¬ë¡œ ì‹œê°€ì´ì•¡ ìˆœìœ„ ìë™ ì—…ë°ì´íŠ¸
   - Spring `@Scheduled` ë˜ëŠ” Quartz ìŠ¤ì¼€ì¤„ëŸ¬ ì‚¬ìš©
   - ì£¼ê¸°: ì¼ì¼ 1íšŒ (ì¥ ë§ˆê° í›„, ì˜ˆ: ì˜¤í›„ 6ì‹œ)
   - ì™¸ë¶€ API í™œìš©: Finnhub ë˜ëŠ” ë‹¤ë¥¸ APIë¡œ ì‹œê°€ì´ì•¡ ìˆœìœ„ ì¡°íšŒ
   - ì—…ë°ì´íŠ¸ ì „ëµ: ê¸°ì¡´ ì¢…ëª© ìˆœìœ„ ê°±ì‹  + ì‹ ê·œ ì¢…ëª© ì¶”ê°€ (ìƒìœ„ 20ê°œ ìœ ì§€)
   - ì—ëŸ¬ ì²˜ë¦¬: API ì‹¤íŒ¨ ì‹œ ê¸°ì¡´ ë°ì´í„° ìœ ì§€, ë¡œê·¸ ê¸°ë¡

**êµ¬í˜„ ìš°ì„ ìˆœìœ„**:
- Phase 9.1: ê´€ë¦¬ì API êµ¬í˜„ (ì¸ì¦/ì¸ê°€ í¬í•¨)
- Phase 9.2: ìŠ¤ì¼€ì¤„ëŸ¬ êµ¬í˜„ ë° ì™¸ë¶€ API ì—°ë™
- Phase 9.3: ìë™ ê°±ì‹  ë¡œì§ ë° ì—ëŸ¬ ì²˜ë¦¬

### 12.11 Phase 10: AI(SSE) ì—°ë™ (í”„ë¡ íŠ¸ `/oracle`)

- **ëª©í‘œ**: í”„ë¡ íŠ¸ `/oracle` í˜ì´ì§€ê°€ Spring ë°±ì—”ë“œì˜ `POST /api/v1/chat/ask` ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ FastAPI AI Gatewayì™€ SSEë¡œ ì•ˆì „í•˜ê²Œ ì—°ë™ë˜ë„ë¡ í•œë‹¤.
- **êµ¬í˜„ ê°œìš”**:
  - `AiClient`: FastAPI AI Gatewayì˜ `/api/v1/ai/chat` ë“±ì„ í˜¸ì¶œí•˜ëŠ” ì „ìš© HTTP í´ë¼ì´ì–¸íŠ¸.
  - `ChatController`: `POST /api/v1/chat/ask`ì—ì„œ SSE(`text/event-stream`)ë¡œ í”„ë¡ íŠ¸ì— ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µì„ ì „ë‹¬.
  - `ChatService`/`ChatHistory`: ì§ˆë¬¸Â·ì‘ë‹µÂ·ì‚¬ìš© ëª¨ë¸ì„ ìš”ì•½ í˜•íƒœë¡œ ì €ì¥í•´ ë¡œê·¸/ë¶„ì„ì— í™œìš©.
- **ìƒì„¸ ìŠ¤í™**:
  - SSE í¬ë§·, ì´ë²¤íŠ¸ íƒ€ì…(`message/done/error`), ì—ëŸ¬ ì½”ë“œ ë§¤í•‘, ëª¨ë¸ ë¼ìš°íŒ…/í”„ë¡¬í”„íŠ¸ êµ¬ì„± ë“±ì€  
    **`docs/AI_SERVER_SPEC.md` v1.1.0ì˜ 3, 4, 6, 7, 9ì¥ì„ ë‹¨ì¼ ì§„ì‹¤ë¡œ ë”°ë¥¸ë‹¤.**

---

---

## 13. êµ¬í˜„ ì™„ë£Œ í˜„í™© (Phase 3.5: Market Movers DB ê´€ë¦¬)

### 13.1 Market Movers Top 20 Market Cap DB ê´€ë¦¬ (êµ¬í˜„ ì™„ë£Œ)

**êµ¬í˜„ ì¼ì**: 2026-01-19

**êµ¬í˜„ ë‚´ìš©**:
- âœ… Flyway V6 ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„± (`V6__create_market_cap_stocks.sql`)
- âœ… `MarketCapStock` Entity ìƒì„±
- âœ… `MarketCapStockRepository` ìƒì„±
- âœ… `MarketService.getMovers()` ìˆ˜ì • (DB ì¡°íšŒ ë¡œì§ + Fallback)
- âœ… ì´ˆê¸° ë°ì´í„° ì‹œë“œ (20ê°œ ì¢…ëª©)
- âœ… ë¬¸ì„œ ì—…ë°ì´íŠ¸ ì™„ë£Œ

**ê²€ì¦ ì™„ë£Œ**:
- âœ… DB ìŠ¤í‚¤ë§ˆ: `market_cap_stocks` í…Œì´ë¸” ìƒì„± ë° ì¸ë±ìŠ¤ ì„¤ì •
- âœ… Entity: ëª¨ë“  í•„ë“œ ì •ìƒ ë§¤í•‘ (`symbol`, `company_name`, `market_cap_rank`, `is_active`)
- âœ… Repository: `findByIsActiveTrueOrderByMarketCapRankAsc()` ë©”ì„œë“œ êµ¬í˜„
- âœ… Service: DB ì¡°íšŒ ë¡œì§ ë° Fallback ë¡œì§ êµ¬í˜„
- âœ… ì¢…ëª©ëª… ì¡°íšŒ: DBì˜ `company_name` ìš°ì„  ì‚¬ìš©, ì—†ìœ¼ë©´ Search API ì‚¬ìš©
- âœ… API ì‘ë‹µ í˜•ì‹: ê¸°ì¡´ê³¼ ë™ì¼ (`MarketMoversResponse`)

**ì°¸ê³ ì‚¬í•­**:
- API ì‘ë‹µ í˜•ì‹ì€ ê¸°ì¡´ê³¼ ë™ì¼í•˜ë¯€ë¡œ í”„ë¡ íŠ¸ì—”ë“œ ë³€ê²½ ë¶ˆí•„ìš”
- í•˜ìœ„ í˜¸í™˜ì„±: DBì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ í•˜ë“œì½”ë”© ë¦¬ìŠ¤íŠ¸ ì‚¬ìš©
- ì´ˆê¸° ë°ì´í„°ëŠ” ë¯¸êµ­ ì£¼ì‹ ì‹œì¥ ê¸°ì¤€ (ë¬¸ì„œì™€ ì¼ì¹˜)

---

## 13.2 Phase 4 êµ¬í˜„ ì™„ë£Œ í˜„í™© (Trade/Portfolio Engine)

**êµ¬í˜„ ì¼ì**: 2026-01-19

**êµ¬í˜„ ë‚´ìš©**:
- âœ… DTO ìƒì„±: TradeOrderRequest, AvailableBalanceResponse, TradeResponse, TradeHistoryResponse
- âœ… WalletService êµ¬í˜„: getAvailableBalance ë©”ì„œë“œ
- âœ… PortfolioService êµ¬í˜„: getPortfolio ë©”ì„œë“œ (í˜„ì¬ê°€ ì¡°íšŒ ë° í‰ê°€ ë¡œì§ í¬í•¨)
- âœ… TradeService êµ¬í˜„: executeOrder, executeBuyOrder, executeSellOrder, getTradeHistory ë©”ì„œë“œ
- âœ… TradeController êµ¬í˜„: 4ê°œ ì—”ë“œí¬ì¸íŠ¸ (available-balance, order, portfolio, history)
- âœ… íŠ¸ëœì­ì…˜ ë° ë¹„ê´€ì  ë½ ì „ëµ êµ¬í˜„
- âœ… ë™ì‹œì„± í…ŒìŠ¤íŠ¸ ë° í†µí•© í…ŒìŠ¤íŠ¸ ì‘ì„±

**ê²€ì¦ ì™„ë£Œ**:
- âœ… ë¹„ê´€ì  ë½ ë™ì‘ í™•ì¸: WalletRepository.findByUserIdWithLock(), PortfolioRepository.findByUserIdAndTickerWithLock()
- âœ… íŠ¸ëœì­ì…˜ ë²”ìœ„ í™•ì¸: @Transactional ì–´ë…¸í…Œì´ì…˜ ì ìš©
- âœ… ë™ì‹œì„± ì œì–´ í™•ì¸: ë™ì‹œ ë§¤ìˆ˜/ë§¤ë„ ì£¼ë¬¸ ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸
- âœ… ì‹¤í˜„ ì†ìµ ê³„ì‚°: ë§¤ë„ ì‹œ í‰ë‹¨ê°€ ê¸°ì¤€ ì‹¤í˜„ ì†ìµ ìë™ ê³„ì‚°
- âœ… í¬íŠ¸í´ë¦¬ì˜¤ í‰ê°€: í˜„ì¬ê°€ ì¡°íšŒ ë° ì†ìµë¥  ê³„ì‚°
- âœ… ì˜ˆì™¸ ì²˜ë¦¬: TradeException ë° ErrorCode ë§¤í•‘

**ì°¸ê³ ì‚¬í•­**:
- âœ… ì™¸ë¶€ API í˜¸ì¶œ(`StockService.getQuote()`)ì€ íŠ¸ëœì­ì…˜ ì™¸ë¶€ì—ì„œ í˜¸ì¶œë¨ (ì„±ëŠ¥ ê°œì„  ì™„ë£Œ)
- í¬íŠ¸í´ë¦¬ì˜¤ ì¡°íšŒ ì‹œ í˜„ì¬ê°€ ì¡°íšŒ ì‹¤íŒ¨ ì‹œì—ë„ ê¸°ë³¸ ì •ë³´ëŠ” í¬í•¨í•˜ì—¬ ë°˜í™˜

**íŠ¸ëœì­ì…˜ ë™ì‘ ê²€ì¦**:

êµ¬í˜„ëœ ì½”ë“œê°€ ê³„íšì„œì˜ íŠ¸ëœì­ì…˜/ë½ ì „ëµì„ ì •í™•íˆ ë”°ë¥´ëŠ”ì§€ í™•ì¸:

1. âœ… **@Transactional ì ìš©**: `executeOrderInTransaction()` ë©”ì„œë“œì— `@Transactional` ì–´ë…¸í…Œì´ì…˜ ì ìš©
   - `executeOrder()`: ì™¸ë¶€ API í˜¸ì¶œë§Œ ìˆ˜í–‰ (íŠ¸ëœì­ì…˜ ì—†ìŒ)
   - `executeOrderInTransaction()`: ì‹¤ì œ ê±°ë˜ ë¡œì§ ìˆ˜í–‰ (íŠ¸ëœì­ì…˜ ë‚´ë¶€)
2. âœ… **ë¹„ê´€ì  ë½ ì‚¬ìš©**: 
   - `WalletRepository.findByUserIdWithLock()` ì‚¬ìš© (PESSIMISTIC_WRITE)
   - `PortfolioRepository.findByUserIdAndTickerWithLock()` ì‚¬ìš© (PESSIMISTIC_WRITE)
3. âœ… **ë½ íšë“ ìˆœì„œ**:
   - **ì™¸ë¶€ API í˜¸ì¶œ** (íŠ¸ëœì­ì…˜ ì™¸ë¶€): í˜„ì¬ê°€ ì¡°íšŒ (`StockService.getQuote()`)
   - **íŠ¸ëœì­ì…˜ ì‹œì‘**: `executeOrderInTransaction()` í˜¸ì¶œ
   - **ë§¤ìˆ˜ ì£¼ë¬¸**: Wallet ë½ â†’ Portfolio ë½ (ë˜ëŠ” ìƒì„±)
   - **ë§¤ë„ ì£¼ë¬¸**: Wallet ë½ â†’ Portfolio ë½
   - ì‹¤ì œ êµ¬í˜„ì€ ì™¸ë¶€ API í˜¸ì¶œì„ ë¨¼ì € ìˆ˜í–‰í•˜ì—¬ íŠ¸ëœì­ì…˜ ìœ ì§€ ì‹œê°„ì„ ìµœì†Œí™”
4. âœ… **íŠ¸ëœì­ì…˜ ë²”ìœ„**: ì „ì²´ ê±°ë˜ ë¡œì§ì´ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì²˜ë¦¬
5. âœ… **ì™¸ë¶€ API í˜¸ì¶œ**: `StockService.getQuote()`ê°€ íŠ¸ëœì­ì…˜ ì™¸ë¶€ì—ì„œ í˜¸ì¶œë¨
   - `executeOrder()`: ì™¸ë¶€ API í˜¸ì¶œ (íŠ¸ëœì­ì…˜ ì—†ìŒ)
   - `executeOrderInTransaction()`: ì‹¤ì œ ê±°ë˜ ë¡œì§ (íŠ¸ëœì­ì…˜ ë‚´ë¶€)
   - ì™¸ë¶€ API ì§€ì—° ì‹œì—ë„ íŠ¸ëœì­ì…˜ ìœ ì§€ ì‹œê°„ì„ ìµœì†Œí™”í•˜ì—¬ ì„±ëŠ¥ ê°œì„  ì™„ë£Œ
6. âœ… **ë‹¤ì´ì–´ê·¸ë¨ ì¼ì¹˜**: ë¬¸ì„œ ë‹¤ì´ì–´ê·¸ë¨ì´ ì‹¤ì œ êµ¬í˜„ ìˆœì„œì™€ ì¼ì¹˜í•˜ë„ë¡ ì—…ë°ì´íŠ¸ ì™„ë£Œ

**ë™ì‹œì„± í…ŒìŠ¤íŠ¸ ê²°ê³¼**:

- ë™ì‹œ ë§¤ìˆ˜ ì£¼ë¬¸: ë¹„ê´€ì  ë½ìœ¼ë¡œ ì¸í•´ í•œ ë²ˆì— í•˜ë‚˜ì˜ ê±°ë˜ë§Œ ì‹¤í–‰ë¨ (ì”ê³  ì´ˆê³¼ ë°©ì§€)
- ë™ì‹œ ë§¤ë„ ì£¼ë¬¸: ë¹„ê´€ì  ë½ìœ¼ë¡œ ì¸í•´ í•œ ë²ˆì— í•˜ë‚˜ì˜ ê±°ë˜ë§Œ ì‹¤í–‰ë¨ (ìˆ˜ëŸ‰ ì´ˆê³¼ ë°©ì§€)
- ë§¤ìˆ˜/ë§¤ë„ ë™ì‹œ ì‹¤í–‰: Portfolioì™€ Wallet ëª¨ë‘ ë½ íšë“ìœ¼ë¡œ ìˆœì°¨ ì‹¤í–‰ ë³´ì¥

**íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ë° í•´ê²°**:

- âœ… **Self-invocation ë¬¸ì œ í•´ê²°**: `this.executeOrderInTransaction()` í˜¸ì¶œ ì‹œ íŠ¸ëœì­ì…˜ì´ ì ìš©ë˜ì§€ ì•ŠëŠ” ë¬¸ì œë¥¼ ìê¸° ì£¼ì… íŒ¨í„´ìœ¼ë¡œ í•´ê²°
- âœ… **í…ŒìŠ¤íŠ¸ ì½”ë“œ ë¦¬íŒ©í† ë§**: 
  - í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ ë ˆë²¨ `@Transactional` ì œê±° (ë™ì‹œì„± í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´)
  - `@AfterEach`ì—ì„œ ìˆ˜ë™ ë°ì´í„° ì •ë¦¬ë¡œ ë°ì´í„° ê²©ë¦¬ ë³´ì¥
  - ìŠ¤ë ˆë“œ ì•ˆì „í•œ ë¦¬ìŠ¤íŠ¸ ì‚¬ìš© (`Collections.synchronizedList()`)
  - `StockService` ëª¨í‚¹ìœ¼ë¡œ ì™¸ë¶€ API í˜¸ì¶œ ë³€ìˆ˜ ì œê±°
- âœ… **íŠ¸ëœì­ì…˜ ê²©ë¦¬ ë¬¸ì œ í•´ê²°**: ë³„ë„ ìŠ¤ë ˆë“œì—ì„œ í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ë³¼ ìˆ˜ ì—†ëŠ” ë¬¸ì œë¥¼ íŠ¸ëœì­ì…˜ ì œê±° ë° ìˆ˜ë™ ë°ì´í„° ì •ë¦¬ë¡œ í•´ê²°

---

**ë¬¸ì„œ ë²„ì „:** 2.7.20 (ì˜¨ë³´ë”© ì™„ë£Œ í•´ì„ ê·œì¹™ + `/auth/me`Â·`hasCompletedOnboarding` êµ¬í˜„ ì •í•©ì„± ë° í…ŒìŠ¤íŠ¸ ê³„ì • ë¹„ë°€ë²ˆí˜¸ ì •ì±… ë°˜ì˜)  
**ìµœì¢… ìˆ˜ì •ì¼:** 2026-01-21

---

## 13.3 Phase 5 êµ¬í˜„ ì™„ë£Œ í˜„í™© (Game/Shop/Ranking)

**êµ¬í˜„ ì¼ì**: 2026-01-19

**êµ¬í˜„ ë‚´ìš©**:
- âœ… `GameController` ì‹ ê·œ ì¶”ê°€: `/items`, `/gacha`, `/inventory`, `/equip/{itemId}`, `/ranking`
- âœ… `ItemsResponse`, `GachaResponse` DTO ì¶”ê°€ (`items` íŒ¨í„´, asOf í¬í•¨)
- âœ… `InventoryResponse`, `RankingResponse` DTOë¥¼ `FULL_SPECIFICATION` 5.5 ìŠ¤í‚¤ë§ˆì™€ ì •í•©í•˜ê²Œ ì •ë¦¬(asOf/ items / my êµ¬ì¡° ìœ ì§€)
- âœ… `GachaService` êµ¬í˜„: ê²Œì„ ì½”ì¸ 100 ì°¨ê° â†’ í™•ë¥  ê¸°ë°˜ ì¶”ì²¨ â†’ ì¤‘ë³µ ì‹œ ì¬ì¶”ì²¨(ìµœëŒ€ 10íšŒ) â†’ ì¸ë²¤í† ë¦¬ ì§€ê¸‰
- âœ… `InventoryService` êµ¬í˜„: ì¹´í…Œê³ ë¦¬ ë‹¨ì¼ ì¥ì°© ë³´ì¥(ê¸°ì¡´ ì¥ì°© ìë™ í•´ì œ) + ì¸ë²¤í† ë¦¬ ì¡°íšŒ
- âœ… `RankingService` êµ¬í˜„: ë­í‚¹ ì°¸ì—¬ ì‚¬ìš©ìë§Œ ëŒ€ìƒìœ¼ë¡œ ì´ìì‚° ë‚´ë¦¼ì°¨ìˆœ Top 50, ìˆ˜ìµë¥  = (ì´ìì‚°-ì´ˆê¸°ìì‚°)/ì´ˆê¸°ìì‚°*100
- âœ… `WalletRepository.findRankingWallets(Pageable)` ì¶”ê°€ (is_ranking_joined í•„í„°)
- âœ… ë‹¨ìœ„ í…ŒìŠ¤íŠ¸: ì¹´í…Œê³ ë¦¬ ê²€ì¦, ì¥ì°© ë‹¨ì¼ì„±, ë­í‚¹ ìˆ˜ìµë¥  ê³„ì‚° ê²€ì¦

**ì°¸ê³ ì‚¬í•­**:
- ê°€ì±  ë¹„ìš© ê¸°ë³¸ê°’: 100 ê²Œì„ ì½”ì¸ (`GachaService.GACHA_COST`)
- ì¤‘ë³µ ì•„ì´í…œë§Œ ì¡´ì¬í•  ê²½ìš° `GAME_002` ë°œìƒ
- ì‘ë‹µ ìŠ¤í‚¤ë§ˆëŠ” `FULL_SPECIFICATION` 5.5ì™€ ì •í•©

---
