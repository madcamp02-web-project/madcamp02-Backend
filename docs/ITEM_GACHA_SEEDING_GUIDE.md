# 🎯 아이템/가챠 설계·시딩 가이드

## 1) 목적과 범위
- 상점/가챠(Phase 5) 기능이 안정적으로 동작하도록 `items` 마스터를 설계·시딩하는 기준을 제공한다.
- 대상: BE/운영 담당(시드/마이그레이션), FE(카테고리/확률 의미 파악), QA(시나리오 검증).

## 2) 필드 스키마 요구사항 (`items` 테이블)
- **name**: 노출 이름 (필수)
- **description**: 짧은 설명 (선택, 1줄 권장)
- **category**: `NAMEPLATE | AVATAR | THEME` (문서 고정 값)
- **rarity**: `COMMON | RARE | EPIC | LEGENDARY`
- **probability**: 가챠 확률(0~1, float). 전체 합이 1일 필요는 없지만 **비율**로 동작 → **합 1.0 맞추는 것**을 권장
- **image_url**: CDN/S3/정적 경로 (일관된 스키마 사용)
- **created_at**: 생성 시각

## 3) 카테고리/희귀도 구성 원칙
- **카테고리 최소 구색**: 각 카테고리 3~5종 이상 (COMMON~EPIC, AVATAR는 LEGENDARY 1종 권장)
- **희귀도 비율(권장, 합 1.0 가이드)**  
  - COMMON: 0.70  
  - RARE: 0.20  
  - EPIC: 0.09  
  - LEGENDARY: 0.01  
- **체감 조정**: LEGENDARY 체감이 너무 낮으면 0.02까지 상향하고 COMMON/RARE를 비례 감축.

## 4) 시드 전략 (권장)
- **우선순위**: Flyway 시드(`V7__seed_items.sql` 등) → 재현성/이식성 확보.
- **대안**: `CommandLineRunner`로 “비어 있으면 채우기” (로컬/개발용). 운영은 Flyway를 권장.
- **배포 파이프라인**: 시드 후 Smoke 테스트(가챠 10회 샘플) 자동화 고려.

## 5) 예시 시드 (확률 합 1.0)
- NAMEPLATE  
  - COMMON 0.20: `Basic Plate`  
  - RARE 0.12: `Silver Edge`  
  - EPIC 0.06: `Aurora Frame`
- AVATAR  
  - COMMON 0.25: `Casual Hoodie`  
  - RARE 0.08: `Neon Runner`  
  - EPIC 0.03: `Cyber Fox Mask`  
  - LEGENDARY 0.01: `Dragon Aura`
- THEME  
  - COMMON 0.15: `Night Sky`  
  - RARE 0.07: `Grid Neon`  
  - EPIC 0.03: `Aurora Field`

## 6) 가챠 동작과 예외
- 비용: **100 게임 코인**(코드 상수) → 지갑에서 차감, 부족 시 `GAME_001`.
- 풀에 아이템이 0개이거나 확률 합 0이면 `GAME_003`.
- 중복 방지 재추첨: 최대 10회, 모두 중복이면 `GAME_002`.
- 카테고리 값 검증 실패 시 `GAME_ITEM_NOT_FOUND`로 처리.

## 7) 운영 체크리스트
- [ ] 카테고리 값이 `NAMEPLATE/AVATAR/THEME`만 존재하는가? (레거시 값 금지)
- [ ] 확률 합이 0보다 크고, 가급적 1.0에 근접하는가?
- [ ] 각 카테고리에 최소 3종 이상, LEGENDARY는 전체에서 최소 1종 존재하는가?
- [ ] 이미지 경로가 유효하고 일관된가?
- [ ] 가챠 비용(100) 대비 코인 수급 설계가 맞는가? (이벤트 시 비용 상수 조정 필요 여부)

## 8) QA 시나리오
- 가챠 10회 샘플 → LEGENDARY 미출현이 정상(저확률), COMMON/RARE 출현 분포 확인.
- 코인 부족 시 `GAME_001` 응답 확인.
- 풀 아이템 삭제/확률 0 설정 시 `GAME_003` 발생 확인.
- 동일 카테고리 장착 토글 시 단일 장착 유지 여부 확인.

## 9) 향후 확장 아이디어
- **카테고리별 가챠 풀 분리**(예: 테마 전용 뽑기) → 확률/비용 별도 설정.
- **배너 시즌제**: 기간 한정 아이템을 별도 테이블로 관리 후 합산 확률 구성.
- **피티(Pity) 시스템**: 일정 횟수 무전설 시 LEGENDARY 보장 카운터 추가(추가 컬럼/테이블 필요).

---
**요약**: `items`는 마스터 데이터이므로 **Flyway 시드로 고정값을 넣고**, 카테고리 3종/희귀도 비율을 명확히 설계해 확률 총합을 관리하라. 가챠 예외(`GAME_001~003`)가 정상 동작하도록 빈 풀/중복만 존재하는 상황을 피하고, 배포 전 최소 가챠 샘플 테스트를 수행한다.
