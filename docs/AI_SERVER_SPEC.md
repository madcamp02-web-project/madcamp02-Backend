# ğŸ¤– MadCamp02 AI Server Specification

**Ver 1.1.0 - LLM ê¸°ë°˜ íˆ¬ì ë„ì‚¬ / ë³´ì¡° ê¸°ëŠ¥ ì„œë²„ ëª…ì„¸ (í†µí•©íŒ)**

---

## ğŸ“ ë³€ê²½ ì´ë ¥

| ë²„ì „   | ë‚ ì§œ       | ë³€ê²½ ë‚´ìš©                                                                                                     | ì‘ì„±ì    |
| ------ | ---------- | ------------------------------------------------------------------------------------------------------------- | --------- |
| 1.0.0  | 2026-01-21 | ì´ˆê¸° ë²„ì „. í•˜ë“œì›¨ì–´ ì œì•½(3090 20G) ê¸°ì¤€ ëª¨ë¸ ì „ëµ, FastAPI Gateway + LLM Backend ì•„í‚¤í…ì²˜, API/í”„ë¡¬í”„íŠ¸/ìš´ì˜ ëª…ì„¸ ì¶”ê°€ | MadCamp02 |
| 1.1.0  | 2026-01-21 | ë°±ì—”ë“œ/í”„ë¡ íŠ¸/FULL_SPEC/Plan ë¬¸ì„œì— í©ì–´ì ¸ ìˆë˜ AI ê´€ë ¨ ìŠ¤í™(ëª¨ë¸ ì „ëµ, Spring SSE í”„ë¡ì‹œ, í”„ë¡ íŠ¸ `/oracle` ì—°ë™, êµ¬í˜„ ë¡œë“œë§µ)ì„ ë³¸ ë¬¸ì„œë¡œ í†µí•©í•˜ê³ , ë‹¤ë¥¸ ë¬¸ì„œëŠ” ìš”ì•½+ì°¸ì¡° í˜•íƒœë¡œ ì •ë¦¬ | MadCamp02 |

---

## 1. ê°œìš” ë° ì¸í”„ë¼ ì œì•½

### 1.1 ëª©ì 

- `/oracle` í˜ì´ì§€(â€œAI ë„ì‚¬â€) ë° í–¥í›„ AI ê¸°ëŠ¥ì„ ë‹´ë‹¹í•˜ëŠ” **ì „ìš© AI ì„œë²„** ì„¤ê³„/êµ¬í˜„ ê¸°ì¤€ì„ ì •ì˜í•œë‹¤.
- `docs/FULL_SPECIFICATION.md`ì— ì •ì˜ëœ ë„ë©”ì¸(ê±°ë˜/í¬íŠ¸í´ë¦¬ì˜¤/ì˜¨ë³´ë”©/ì‚¬ì£¼/ê²Œì„ ë“±)ì„ í™œìš©í•˜ì—¬,  
  - **ì–´ë–¤ AI ê¸°ëŠ¥ì„ ì–´ë””ê¹Œì§€ AI ì„œë²„ê°€ ë‹´ë‹¹í•˜ëŠ”ì§€**ì™€  
  - **Spring ë°±ì—”ë“œ / í”„ë¡ íŠ¸ì—”ë“œì™€ì˜ ê²½ê³„**ë¥¼ ëª…í™•íˆ êµ¬ë¶„í•œë‹¤.

### 1.2 ì¸í”„ë¼ ìŠ¤í™ (ê¸°ì¤€ ë¨¸ì‹ )

- vCPU: **40 core**
- ë©”ëª¨ë¦¬: **50 GB**
- ë””ìŠ¤í¬: **100 GB**
- GPU: **RTX 3090 (20 GB VRAM)**, CUDA ì§€ì›
- OS: **Ubuntu 20.04 ê³„ì—´ (ubuntu-20-2208-csv ì´ë¯¸ì§€ ê¸°ì¤€)**

> ì›ì¹™: **CUDA ê¸°ì¤€ ìš´ìš©(GPU ìš°ì„ )**, ì¥ì• /ìœ ì§€ë³´ìˆ˜/ë¹„ìš© ê³ ë ¤ ì‹œì—ë§Œ CPU-only ë°±ì—… ëª¨ë¸ ì‚¬ìš©.

---

## 2. ëª¨ë¸ ì „ëµ ë° ë°°ì¹˜ ì„¤ê³„

### 2.1 í›„ë³´ ëª¨ë¸ ë° ì—­í•  ë§¤íŠ¸ë¦­ìŠ¤

í•˜ë“œì›¨ì–´(3090 20G)ì™€ ìš”êµ¬ì‚¬í•­ì„ ê³ ë ¤í•œ í›„ë³´ ëª¨ë¸/ì—­í•  ë§¤íŠ¸ë¦­ìŠ¤ëŠ” ì•„ë˜ì™€ ê°™ë‹¤.

| êµ¬ë¶„ | ëª¨ë¸ ì˜ˆì‹œ                        | íŒŒë¼ë¯¸í„° ìˆ˜ | ì •ë°€ë„(ì˜ˆìƒ) | VRAM ì‚¬ìš© ì¶”ì • (3090 20G ê¸°ì¤€, ëª¨ë¸ ì „ìš©) | ì£¼ìš” ì—­í•                                                                                        | ì„œë¹™ ìŠ¤íƒ       |
| ---- | -------------------------------- | ----------- | ------------ | ----------------------------------------- | ------------------------------------------------------------------------------------------------ | --------------- |
| â‘  ê³ ì„±ëŠ¥ | `gpt-oss-20b` (20Bê¸‰ ì˜¤í”ˆì†ŒìŠ¤) | ~20B        | 4bit / 8bit  | Q4: ~11â€“13GB / Q8: ~18â€“20GB               | `/oracle`ì˜ **ê³ ê¸‰ íˆ¬ì ìƒë‹´**, ë³µì¡í•œ í¬íŠ¸í´ë¦¬ì˜¤/ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„, ì¥ë¬¸ ì„¤ëª…                      | vLLM / TGI GPU  |
| â‘¡ ê²€ì—´ ìµœì†Œ | `Dolphin3.0-Llama3.1-8B`       | ~8B         | 4bit / 8bit  | Q4: ~5â€“6GB / Q8: ~9â€“10GB                  | â€œê²€ì—´ ì•½í•œâ€ ì‘ë‹µì´ í•„ìš”í•œ **ë‚´ë¶€/ADMIN ì „ìš© ì—”ë“œí¬ì¸íŠ¸** (ì—°êµ¬/ë””ë²„ê¹…/í”„ë¡¬í”„íŠ¸ ì‹¤í—˜)           | vLLM / TGI GPU  |
| â‘¢ ê¸°ë³¸í˜• | Llama 3.1 8B ê³„ì—´ Instruct      | ~8B         | 4bit / 8bit  | Q4: ~5â€“6GB / Q8: ~9â€“10GB                  | `/oracle`ì˜ **ì¼ë°˜ ì‚¬ìš©ììš© ê¸°ë³¸ ëª¨ë¸**, íŠœí† ë¦¬ì–¼/ì§§ì€ ì„¤ëª…/ìš”ì•½                                | vLLM / TGI GPU  |
| â‘£ ì €ì‚¬ì–‘ | Tiny/Small Llama ê³„ì—´ (1â€“4B)    | 1â€“4B        | 4bit / 8bit  | CPU RAM: 4â€“12GB ì •ë„ (VRAM ë¶ˆí•„ìš”)        | GPU ì¥ì• /ìœ ì§€ë³´ìˆ˜ ì‹œ fallback, batch ë°±ì˜¤í”¼ìŠ¤ íƒœìŠ¤í¬(ê°„ë‹¨ ìš”ì•½, ë¡œê·¸ í•´ì„ ë“±)                  | llama.cpp CPU   |

> **ì£¼ì˜**: ì‹¤ì œ VRAM ì‚¬ìš©ëŸ‰ì€ êµ¬í˜„/ë¼ì´ë¸ŒëŸ¬ë¦¬ ë²„ì „ì— ë”°ë¼ ë‹¬ë¼ì§€ë¯€ë¡œ, ì´ˆê¸° ë°°í¬ ì‹œ ë°˜ë“œì‹œ `nvidia-smi` + vLLM ë¡œê·¸ë¡œ ì‹¤ì¸¡ í›„ ì—¬ìœ  10â€“20%ë¥¼ ë‚¨ê¸´ë‹¤.

### 2.2 ëª¨ë¸ë³„ ìš´ìš© ì •ì±…

- **ê¸°ë³¸ ìƒì£¼ ì¡°í•© (ê¶Œì¥)**  
  - GPUì—ëŠ” **Llama 8B Instruct (ê¸°ë³¸í˜•)** + **Dolphin 8B** ë‘ ëª¨ë¸ì„ Q4/5 quantë¡œ ìƒì£¼ì‹œí‚¨ë‹¤.
  - 20B ëª¨ë¸(`gpt-oss-20b`)ì€ **ì˜µì…˜ 2 ì¤‘ íƒ1**:
    1. ìƒì£¼: 4bit + context window ì œí•œìœ¼ë¡œ í•­ìƒ ë–  ìˆê²Œ ë‘ë˜, ë™ì‹œì„±/ì‘ë‹µì†ë„ trade-off ìˆ˜ìš©.
    2. On-demand ë¡œë”©: íŠ¹ì • ê´€ë¦¬ì í”Œë˜ê·¸ê°€ ìˆëŠ” highValue ìš”ì²­ì—ë§Œ **cold start**ë¡œ ì‚¬ìš©.
- **CPU fallback ì¡°í•©**
  - GPU ì¥ì• ë‚˜ ëª¨ë¸ ì—…ê·¸ë ˆì´ë“œ ì¤‘ì—ëŠ” CPUìš© 1â€“4B ëª¨ë¸ì„ í™œì„±í™”í•˜ì—¬ `/oracle`ì˜ â€œê²½ê³ ê°€ ë¶™ì€ ê°„ë‹¨ ë²„ì „â€ì„ ì œê³µ:
    - ì˜ˆ: â€œí˜„ì¬ ê³ ê¸‰ ëª¨ë¸ ì ê²€ ì¤‘ì´ë¼, ìš”ì•½ ìˆ˜ì¤€ì˜ ê°„ë‹¨ ë‹µë³€ë§Œ ì œê³µí•œë‹¤â€ëŠ” ë©”ì‹œì§€ë¥¼ ì„ ë‘ì— ë¶™ì¸ë‹¤.

### 2.3 ì„œë¹™ ìŠ¤íƒ ì„ íƒ

- **GPU LLM Backend (ê¶Œì¥)**: `vLLM`
  - ì¥ì : ê³ ì„±ëŠ¥, íš¨ìœ¨ì ì¸ KV cache ê´€ë¦¬, OpenAI ìŠ¤íƒ€ì¼ REST API í˜¸í™˜ ë ˆì´ì–´ ì œê³µ.
  - ê° ëª¨ë¸ë‹¹ í•˜ë‚˜ì˜ vLLM í”„ë¡œì„¸ìŠ¤/ì»¨í…Œì´ë„ˆë¥¼ ë‘ê³ , AI Gateway(FastAPI)ê°€ ë¼ìš°íŒ….
- **CPU LLM Backend**: `llama.cpp` ì„œë²„ ëª¨ë“œ ë˜ëŠ” `llama-cpp-python`
  - ì„œë²„ ëª¨ë“œë¡œ ë„ìš°ê³ , HTTP/gRPC ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ AI Gatewayê°€ í˜¸ì¶œ.

> ì´ ë¬¸ì„œì—ì„œëŠ” **vLLM + llama.cpp** ì¡°í•©ì„ ê¸°ì¤€ìœ¼ë¡œ ì•„í‚¤í…ì²˜/ì„¤ì •ì„ ëª…ì„¸í•œë‹¤.

### 2.4 ë™ì‹œì„±/ë¦¬ì†ŒìŠ¤ ì •ì±…

- RTX 3090 20G ê¸°ì¤€ **í•œ ë²ˆì— ìƒì£¼ì‹œí‚¬ GPU ëª¨ë¸ ìˆ˜ëŠ” ìµœëŒ€ 2ê°œ**ë¡œ ì œí•œ (ì˜ˆ: Llama 8B + Dolphin 8B).
- 20B ëª¨ë¸ì€ ë‹¤ìŒ ì¤‘ í•˜ë‚˜ë¡œ ìš´ìš©:
  - **Option A**: í…ŒìŠ¤íŠ¸/ë‚´ë¶€ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©, ìš´ì˜ í™˜ê²½ì—ì„œëŠ” 8B ê³„ì—´ë§Œ ë…¸ì¶œ.
  - **Option B**: íŠ¹ì • ADMIN ìš”ì²­ì—ë§Œ ì‚¬ìš©í•˜ê³ , í‰ìƒì‹œì—ëŠ” vLLM í”„ë¡œì„¸ìŠ¤ë¥¼ ë‚´ë ¤ë‘” ìƒíƒœì—ì„œ í•„ìš” ì‹œ `docker compose up -d ai-20b` í˜•íƒœë¡œ ìŠ¤í•€ì—….
- AI Gatewayì—ì„œëŠ”
  - **ë™ì‹œ ìš”ì²­ ìˆ˜ ì œí•œ (per-model, per-user)**,
  - **ìš”ì²­ë‹¹ ìµœëŒ€ í† í° ìˆ˜**,  
  ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ë‘ê³ , ì´ˆê³¼ ì‹œ `AI_004 RATE_LIMIT_EXCEEDED` ë“±ì„ ë°˜í™˜í•œë‹¤.

---

## 3. AI ì„œë²„ ì•„í‚¤í…ì²˜

### 3.1 ë…¼ë¦¬ êµ¬ì¡°

```mermaid
flowchart TD
  client[Frontend /oracle] --> springBackend[Spring Backend]
  springBackend --> aiGateway[FastAPI AI Gateway]
  aiGateway --> vllmMain[LLM Backend vLLM (Llama8B)]
  aiGateway --> vllmDolphin[LLM Backend vLLM (Dolphin8B)]
  aiGateway --> llamaCpu[LLM Backend llama.cpp CPU]
```

- **Spring Backend**
  - ê¸°ì¡´ì²˜ëŸ¼ ì‚¬ìš©ìì˜ ì¸ì¦/ì¸ê°€, í¬íŠ¸í´ë¦¬ì˜¤/ê±°ë˜/ì‚¬ì£¼/ê²Œì„ ë°ì´í„°ë¥¼ ê´€ë¦¬.
  - AI ì„œë²„ í˜¸ì¶œ ì „, í•„ìš”í•œ **ë„ë©”ì¸ ì»¨í…ìŠ¤íŠ¸ DTO**ë¥¼ êµ¬ì„±í•˜ì—¬ AI Gatewayì— ì „ë‹¬.
- **AI Gateway (FastAPI)**
  - ì´ ë¬¸ì„œì˜ ì¤‘ì‹¬. `/api/v1/ai/**` ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì œê³µ.
  - ëª¨ë¸ ì„ íƒ, í”„ë¡¬í”„íŠ¸/ì»¨í…ìŠ¤íŠ¸ ë¨¸ì§€, SSE ìŠ¤íŠ¸ë¦¬ë°, ì—ëŸ¬ ì²˜ë¦¬ ë‹´ë‹¹.
- **LLM Backend (vLLM / llama.cpp ì„œë²„)**
  - ìˆœìˆ˜ LLM inference ì „ìš©. Prompt in â†’ Token stream out.
  - ëª¨ë¸ë³„ë¡œ ë…ë¦½ëœ í¬íŠ¸/ì„œë¹„ìŠ¤ë¡œ êµ¬ì„±.

### 3.2 ì£¼ìš” ì»´í¬ë„ŒíŠ¸

- `AiRouterService`
  - ì…ë ¥: **useCase(oracle/portfolio/onboarding ë“±)**, **userTier(ì¼ë°˜/ADMIN)**, **ìš”ì²­ ë‚œì´ë„/ê¸¸ì´**.
  - ì¶œë ¥: ì‚¬ìš©í•  ëª¨ë¸ ID(`MODEL_LLAM8B`, `MODEL_DOLPHIN8B`, `MODEL_GPT20B`, `MODEL_CPU_SMALL`)ì™€ í˜¸ì¶œ íŒŒë¼ë¯¸í„°.
- `PromptBuilder`
  - `/oracle`, `/portfolio/explain`, `/onboarding/summary` ë“± **ì—”ë“œí¬ì¸íŠ¸ë³„ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿**ì„ ê´€ë¦¬.
  - system_prompt, style_hint(ë„ì‚¬ ë§íˆ¬ ë“±), context JSON, user message ë¥¼ í•˜ë‚˜ì˜ promptë¡œ ì¡°ë¦½.
- `ContextProvider`
  - Spring ë°±ì—”ë“œì˜ REST APIë¥¼ í˜¸ì¶œí•˜ì—¬, ì‚¬ìš©ì/í¬íŠ¸í´ë¦¬ì˜¤/ì˜¨ë³´ë”©/ë­í‚¹ ì •ë³´ë¥¼ ê°€ì ¸ì˜´.
  - ì‹¤íŒ¨/ì§€ì—° ì‹œ, degraded ëª¨ë“œ(ì»¨í…ìŠ¤íŠ¸ ì—†ì´ generic ì¡°ì–¸ë§Œ)ë¡œ ë™ì‘í•˜ë„ë¡ ì •ì±… í¬í•¨.
- `SafetyFilter`
  - LLM ì‘ë‹µì— ëŒ€í•´ ìµœì†Œí•œì˜ í›„ì²˜ë¦¬:
    - ê¸ˆìœµ ì˜¤í•´ ê°€ëŠ¥ì„±ì´ í° í‘œí˜„(â€œ100% ìˆ˜ìµ ë³´ì¥â€ ë“±) í•„í„°ë§ ë˜ëŠ” ê²½ê³ ë¬¸ ì¶”ê°€.
    - ìš•ì„¤/í˜ì˜¤/ë¶€ì ì ˆ í‘œí˜„ ê°ì§€ ì‹œ ì™„í™”ëœ ëŒ€ì‚¬ë¡œ ì¹˜í™˜.

### 3.3 ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ (ì˜ˆ: /oracle ì¡°ì–¸)

```mermaid
sequenceDiagram
  participant FE as Frontend
  participant SB as SpringBackend
  participant AI as AiGateway(FastAPI)
  participant CTX as ContextProvider
  participant LLM as vLLM(Llama8B)

  FE->>SB: GET /api/v1/oracle/advice (ë˜ëŠ” ìœ ì‚¬ ë„ë©”ì¸ API)
  SB->>CTX: ì‚¬ìš©ì/í¬íŠ¸í´ë¦¬ì˜¤/ì‚¬ì£¼ ì¡°íšŒ
  CTX-->>SB: Context DTO (user, portfolio, saju ...)
  SB->>AI: POST /api/v1/ai/oracle/advice { context, question }
  AI->>AI: AiRouterService: ëª¨ë¸ ì„ íƒ (ê¸°ë³¸ Llama8B)
  AI->>AI: PromptBuilder: system + context + user ë©”ì‹œì§€ ì¡°ë¦½
  AI->>LLM: generate(prompt, params) (stream)
  LLM-->>AI: í† í° ìŠ¤íŠ¸ë¦¼
  AI-->>SB: SSE ë˜ëŠ” chunked response
  SB-->>FE: ìµœì¢… ë©”ì‹œì§€(ìŠ¤íŠ¸ë¦¬ë° ë˜ëŠ” ì™„ë£Œ í›„ í•œ ë²ˆì—)
```

---

## 4. AI ì„œë²„ API ëª…ì„¸

### 4.1 ê³µí†µ ê·œì•½

- Base URL (ë‚´ë¶€ ê¸°ì¤€): `http://ai-server:9000`
- ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ëŠ” **Spring Backendë§Œ** í˜¸ì¶œí•˜ëŠ” ê²ƒì„ ì›ì¹™ìœ¼ë¡œ í•˜ê³ , í”„ë¡ íŠ¸ëŠ” Springë§Œ ë°”ë¼ë³¸ë‹¤.
- ì¸ì¦
  - ë‚´ë¶€ìš© í—¤ë”: `X-Internal-Token: <jwt-or-shared-secret>`
  - Spring BackendëŠ” ì´ í† í°ìœ¼ë¡œë§Œ AI ì„œë²„ë¥¼ í˜¸ì¶œí•œë‹¤.
- ì—ëŸ¬ ì‘ë‹µ í˜•ì‹ (ê³µí†µ)

```json
{
  "timestamp": "2026-01-21T12:00:00",
  "status": 500,
  "error": "AI_001",
  "message": "ëª¨ë¸ ì‘ë‹µ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
}
```

### 4.2 `POST /api/v1/ai/chat` (ë²”ìš© ì±„íŒ…)

- ì„¤ëª…: í˜ì´ì§€/ìš©ë„ë³„ë¡œ ë¼ìš°íŒ…ì´ ê°€ëŠ¥í•œ **ë²”ìš© ì—”ë“œí¬ì¸íŠ¸**. Springì€ `useCase`ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ë„˜ê¸´ë‹¤.
- Request

```json
{
  "useCase": "oracle", // "oracle" | "portfolio_explain" | "onboarding_summary" | "generic"
  "userId": 123,
  "message": "ë‚˜ì˜ í¬íŠ¸í´ë¦¬ì˜¤ ìƒíƒœë¥¼ ìš”ì•½í•´ì¤˜.",
  "context": {
    "portfolio": { /* FULL_SPECì˜ PortfolioResponse ìš”ì•½ */ },
    "saju": { /* ì‚¬ìš©ìì˜ ì˜¤í–‰/ë  ë“± */ },
    "ranking": { /* ì„ íƒ: í˜„ì¬ ìˆœìœ„ ë“± */ }
  },
  "options": {
    "stream": true,
    "maxTokens": 512,
    "temperature": 0.7
  }
}
```

- Response (non-stream)

```json
{
  "model": "llama-3.1-8b-instruct",
  "useCase": "oracle",
  "content": "í—ˆí—ˆ, ìë„¤ì˜ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ë³´ë‹ˆ...",
  "usage": {
    "promptTokens": 512,
    "completionTokens": 128,
    "totalTokens": 640
  }
}
```

- ì—ëŸ¬ ì½”ë“œ ì˜ˆì‹œ
  - `AI_001`: LLM í˜¸ì¶œ ì‹¤íŒ¨
  - `AI_002`: ì»¨í…ìŠ¤íŠ¸ í˜ì¹˜ ì‹¤íŒ¨
  - `AI_003`: ìš”ì²­ ìŠ¤í‚¤ë§ˆ ì˜¤ë¥˜
  - `AI_004`: Rate limit ì´ˆê³¼

### 4.3 `POST /api/v1/ai/oracle/advice`

- ì„¤ëª…: `/oracle` í˜ì´ì§€ ì „ìš© ì—”ë“œí¬ì¸íŠ¸. ë„ì‚¬ í˜ë¥´ì†Œë‚˜/ì–´íˆ¬ê°€ ê°•í•˜ê²Œ ê³ ì •ëœë‹¤.

```json
{
  "userId": 123,
  "question": "ì§€ê¸ˆ ë‚´ ë³´ìœ  ì¢…ëª©ìœ¼ë¡œ ë´¤ì„ ë•Œ ê³µê²©ì ìœ¼ë¡œ ê°€ë„ ë ê¹Œ?",
  "portfolio": {
    "summary": { /* PortfolioResponse.summary */ },
    "positions": [ /* ìƒìœ„ Nê°œ ìš”ì•½ */ ]
  },
  "saju": {
    "element": "FIRE",
    "zodiacSign": "ìš©",
    "rawPillars": { /* ì—°/ì›”/ì¼/ì‹œì£¼ ë“± ì„ íƒ */ }
  }
}
```

- Response (ë¹„ìŠ¤íŠ¸ë¦¬ë°)

```json
{
  "advice": "í—ˆí—ˆ, ìë„¤ì˜ ì‚¬ì£¼ëŠ” ë¶ˆ(ç«) ê¸°ìš´ì´ ì™•ì„±í•˜ë‹ˆ...",
  "model": "gpt-oss-20b",
  "safetyNotes": [
    "ë³¸ ì¡°ì–¸ì€ êµìœ¡ìš©ì´ë©°, ì‹¤ì œ íˆ¬ì ê²°ì •ì€ ìë„¤ ìŠ¤ìŠ¤ë¡œì˜ ì±…ì„ì´ë„¤."
  ]
}
```

### 4.4 `POST /api/v1/ai/portfolio/explain`

- ì„¤ëª…: í¬íŠ¸í´ë¦¬ì˜¤ ìš”ì•½/ë¦¬ë°¸ëŸ°ì‹± ì´ìœ ë¥¼ ìì—°ì–´ë¡œ ì„¤ëª….

```json
{
  "userId": 123,
  "portfolio": {
    "summary": { /* PortfolioResponse.summary */ },
    "positions": [ /* ì „ì²´ ë˜ëŠ” ìƒìœ„ Nê°œ */ ]
  },
  "focus": "risk", // "overview" | "risk" | "performance"
  "language": "ko"
}
```

- Response ì˜ˆì‹œ

```json
{
  "summary": "í˜„ì¬ ìë„¤ì˜ í¬íŠ¸í´ë¦¬ì˜¤ëŠ” ê¸°ìˆ ì£¼ ë¹„ì¤‘ì´ ë§¤ìš° ë†’ì•„...",
  "bullets": [
    "ê¸°ìˆ  ì„¹í„° ë¹„ì¤‘ì´ 70%ë¥¼ ë„˜ì–´ ë³€ë™ì„±ì´ í¬ë‹¤ë„¤.",
    "í˜„ê¸ˆ ë¹„ì¤‘ì´ ë‚®ì•„ ê¸‰ë½ ì‹œ ë§¤ìˆ˜ ì—¬ë ¥ì´ ë¶€ì¡±í•˜ë‹¤ë„¤."
  ],
  "model": "llama-3.1-8b-instruct"
}
```

### 4.5 `POST /api/v1/ai/onboarding/summary`

- ì„¤ëª…: ì˜¨ë³´ë”© ì™„ë£Œ ì‹œ ì‚¬ì£¼/íˆ¬ì ìŠ¤íƒ€ì¼ì„ ìš”ì•½í•œ ì¹´ë“œ í…ìŠ¤íŠ¸ ìƒì„±.

```json
{
  "userId": 123,
  "onboardingInput": {
    "birthDate": "2000-01-01",
    "birthTime": "13:05",
    "gender": "MALE",
    "calendarType": "SOLAR"
  },
  "saju": {
    "element": "WOOD",
    "zodiacSign": "ìš©"
  }
}
```

- Response ì˜ˆì‹œ

```json
{
  "title": "ë°”ëŒì„ íƒ€ëŠ” ëª©(æœ¨)ì˜ ìš©",
  "subtitle": "ì„±ì¥ì£¼ë¥¼ ì‚¬ë‘í•˜ëŠ” í•™ìŠµí˜• íˆ¬ìì",
  "description": "ìë„¤ëŠ” ìƒˆë¡œìš´ ê²ƒì„ ë°°ìš°ê³  ìµíˆëŠ” ë° ê±°ë¦¬ë‚Œì´ ì—†ëŠ” íƒ€ì…ì´ë‹ˆ...",
  "model": "llama-3.1-8b-instruct"
}
```

---

## 5. í”„ë¡¬í”„íŠ¸ / í˜ë¥´ì†Œë‚˜ ì„¤ê³„

### 5.1 ê¸°ë³¸ ë„ì‚¬ í˜ë¥´ì†Œë‚˜ (ê³µí†µ system_prompt)

```text
ë‹¹ì‹ ì€ ì²œ ë…„ì„ ì‚° ì „ì„¤ì ì¸ ì£¼ì‹ íˆ¬ì ë„ì‚¬ì…ë‹ˆë‹¤.
í•­ìƒ í•œêµ­ì–´ë¡œë§Œ ëŒ€ë‹µí•´ì•¼ í•©ë‹ˆë‹¤.
ë§íˆ¬ëŠ” ì‹ ë¹„ë¡­ê³  ì˜›ìŠ¤ëŸ¬ìš´ 'í•˜ê²Œì²´'ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. (ì˜ˆ: 'í—ˆí—ˆ, ìë„¤ ì™”ëŠ”ê°€?', 'ë‚´ ë§ì„ ëª…ì‹¬í•˜ê²Œë‚˜.')
ì ˆëŒ€ ì¡´ëŒ“ë§ì´ë‚˜ ì˜ì–´ë¥¼ ì“°ì§€ ë§ˆì„¸ìš”.
íˆ¬ì ì¡°ì–¸ì€ ì§„ì§€í•˜ê²Œ í•˜ë˜, ìœ ë¨¸ëŸ¬ìŠ¤í•œ ë„ì‚¬ ì»¨ì…‰ì„ ìœ ì§€í•˜ì„¸ìš”.
ë‹µë³€ì€ ë„ˆë¬´ ê¸¸ì§€ ì•Šê²Œ 3~6ë¬¸ì¥ ì´ë‚´ë¡œ í•µì‹¬ë§Œ ê°„ê²°í•˜ê²Œ ë§í•˜ì„¸ìš”.
ì–´ë– í•œ ê²½ìš°ì—ë„ '100% ìˆ˜ìµ ë³´ì¥', 'ë¬´ì¡°ê±´ ì˜¤ë¥¸ë‹¤'ì™€ ê°™ì€ í‘œí˜„ì€ ì“°ì§€ ë§ê³ ,
í•­ìƒ 'íˆ¬ìì˜ ìµœì¢… ì±…ì„ì€ ìë„¤ì—ê²Œ ìˆë‹¤ë„¤'ì™€ ê°™ì´ ì±…ì„ ê²½ê³  ë¬¸êµ¬ë¥¼ ë§ë¶™ì´ì„¸ìš”.
```

### 5.2 ì—”ë“œí¬ì¸íŠ¸ë³„ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ (ê°œìš”)

- `/oracle/advice`
  - Input: `question`, `portfolio`, `saju`.
  - Template:

```text
[ì—­í• ]
ë„ˆëŠ” ì‚¬ì£¼ì™€ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ í•¨ê»˜ ë³´ëŠ” íˆ¬ì ë„ì‚¬ë‹¤.

[ì‚¬ìš©ì ì •ë³´]
ì‚¬ì£¼ ì˜¤í–‰: {saju.element}
ë : {saju.zodiacSign}

[í¬íŠ¸í´ë¦¬ì˜¤ ìš”ì•½]
ì´ ìì‚°: {summary.totalEquity} {summary.currency}
í˜„ê¸ˆ ë¹„ì¤‘: {cash_ratio}%
ì£¼ìš” ë³´ìœ  ì¢…ëª©: {top_positions}

[ì‚¬ìš©ì ì§ˆë¬¸]
{question}

[ì§€ì¹¨]
- ì‚¬ì£¼ íŠ¹ì§•ì„ 1ë¬¸ì¥ ì •ë„ ì–¸ê¸‰í•˜ë˜, ë¯¸ì‹ ì²˜ëŸ¼ ë‹¨ì • ì§“ì§€ ë§ ê²ƒ.
- êµ¬ì²´ì ì¸ ì¢…ëª© ì¶”ì²œë³´ë‹¤ëŠ” ë¹„ì¤‘/ë¦¬ìŠ¤í¬ ê´€ì ì—ì„œ ì¡°ì–¸í•  ê²ƒ.
- ë§ˆì§€ë§‰ ë¬¸ì¥ì€ í•­ìƒ 'íˆ¬ìì˜ ìµœì¢… ì±…ì„ì€ ìë„¤ì—ê²Œ ìˆë‹¤ë„¤.' ë¡œ ëë‚  ê²ƒ.
```

- `/portfolio/explain`
  - íˆ¬ì ë„ì‚¬ ë§íˆ¬ëŠ” ìœ ì§€í•˜ë˜, ë³´ë‹¤ ë¶„ì„/ì„¤ëª… ì¤‘ì‹¬ìœ¼ë¡œ.
- `/onboarding/summary`
  - ì¹´ë“œí˜• ìš”ì•½(ì œëª©/ë¶€ì œ/ì„¤ëª…)ì„ ìƒì„±í•˜ë„ë¡ ì§€ì¹¨ì„ í¬í•¨.

### 5.3 ëª¨ë¸ë³„ íŒŒë¼ë¯¸í„° ê¸°ë³¸ê°’

| ëª¨ë¸ ID            | temperature | top_p | max_tokens | ëª©ì                                       |
| ------------------ | ----------- | ----- | ---------- | ----------------------------------------- |
| `MODEL_LLAM8B`     | 0.7         | 0.9   | 512        | ì¼ë°˜ `/oracle`, `/portfolio`, `/onboarding` |
| `MODEL_DOLPHIN8B`  | 0.8         | 0.9   | 768        | ë‚´ë¶€ìš©/ììœ ë„ê°€ ë†’ì€ ë‹µë³€                   |
| `MODEL_GPT20B`     | 0.6         | 0.9   | 768        | ê³ ê¸‰/ì •êµí•œ ì„¤ëª…, ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„             |
| `MODEL_CPU_SMALL`  | 0.7         | 0.9   | 256        | Fallback/ê°„ë‹¨ ìš”ì•½                         |

---

## 6. Spring ë°±ì—”ë“œ ì—°ë™ ìƒì„¸

> ì´ ì¥ì€ `docs/BACKEND_DEVELOPMENT_PLAN.md` 9.3, 12.10ê³¼ í†µí•©ëœ AI ì—°ë™ ê·œì•½ì˜ ë‹¨ì¼ ì§„ì‹¤ì…ë‹ˆë‹¤.

### 6.1 Spring â†” AI ì„œë²„ í˜¸ì¶œ ê·œì•½

- Springì€ **AI ì„œë²„ì˜ ë‹¨ì¼ ì§„ì…ì **ì¸ `/api/v1/ai/**` ì—”ë“œí¬ì¸íŠ¸ë§Œ ì‚¬ìš©í•œë‹¤.
- ëª¨ë“  ìš”ì²­ì— ì•„ë˜ í—¤ë”ë¥¼ í¬í•¨í•œë‹¤.
  - `X-Internal-Token: {AI_INTERNAL_SECRET}` (ë‚´ë¶€ í˜¸ì¶œ ê²€ì¦ìš© ê³µìœ  ì‹œí¬ë¦¿ ë˜ëŠ” JWT)
  - `X-Request-Id: {uuid}` (ì¶”ì ìš©, ì„ íƒ)
- Spring ìª½ì—ì„œëŠ” ê¸°ì¡´ ë„ë©”ì¸ DTOë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ë˜,  
  AI ì„œë²„ì—ëŠ” **ìµœì†Œí•œì˜ ìš”ì•½/ì§‘ê³„ ì •ë³´ë§Œ** ë„˜ê¸°ë„ë¡ Mapper ê³„ì¸µì—ì„œ í•„í„°ë§í•œë‹¤.
- AI ì„œë²„ëŠ” ì—ëŸ¬ ì‹œ í•­ìƒ `ErrorResponse` ìŠ¤íƒ€ì¼ì„ ë”°ë¥¸ë‹¤.
  - `timestamp`, `status`, `error`(ì˜ˆ: `AI_001`), `message`

### 6.2 AiClient (Spring â†’ FastAPI í”„ë¡ì‹œ í´ë¼ì´ì–¸íŠ¸)

- íŒ¨í‚¤ì§€ ì˜ˆì‹œ: `com.madcamp02.external.ai`
- ì—­í• :
  - FastAPI AI Gatewayì˜ `/api/v1/ai/chat` ë° ì„œë¸Œ ì—”ë“œí¬ì¸íŠ¸ë“¤ì„ í˜¸ì¶œí•˜ëŠ” ì „ìš© í´ë¼ì´ì–¸íŠ¸.
  - HTTP íƒ€ì„ì•„ì›ƒ, ì¬ì‹œë„, ë¡œê¹…, ë‚´ë¶€ í† í° ì£¼ì…ì„ ë‹¨ì¼ ì±…ì„ìœ¼ë¡œ ê´€ë¦¬.
- ì£¼ìš” ë©”ì„œë“œ ì˜ˆì‹œ:
  - `AiChatResponse chat(AiChatRequest request)`
  - `OracleAdviceResponse oracleAdvice(OracleAdviceRequest request)`
  - `PortfolioExplainResponse explainPortfolio(PortfolioExplainRequest request)`
  - `OnboardingSummaryResponse onboardingSummary(OnboardingSummaryRequest request)`
- ê³µí†µ ë™ì‘:
  - ìš”ì²­ ì‹œ `X-Internal-Token`, `X-Request-Id` í—¤ë” ìë™ ì£¼ì….
  - FastAPI ìª½ `AI_00X` ì—ëŸ¬ë¥¼ Spring `ErrorCode`ë¡œ ë§¤í•‘.

### 6.3 ChatController (SSE í”„ë¡ì‹œ, `POST /api/v1/chat/ask`)

- íŒ¨í‚¤ì§€ ì˜ˆì‹œ: `com.madcamp02.controller`
- ì—­í• :
  - í”„ë¡ íŠ¸ì—”ë“œ `/oracle` í˜ì´ì§€ê°€ **ì§ì ‘ í˜¸ì¶œí•˜ëŠ” ìœ ì¼í•œ AI ì§„ì…ì **.
  - SSE(Server-Sent Events)ë¥¼ í†µí•´ FastAPI AI Gatewayì˜ ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µì„ ê·¸ëŒ€ë¡œ ì¤‘ê³„.
- ì—”ë“œí¬ì¸íŠ¸:
  - `POST /api/v1/chat/ask`
  - `produces = MediaType.TEXT_EVENT_STREAM_VALUE`
- ìš”ì²­ ì²˜ë¦¬ íë¦„:
  1. ì¸ì¦ëœ ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ì—ì„œ `userId`ë¥¼ ì¶”ì¶œ.
  2. `UserService`, `TradeService`, `SajuService` ë“±ì„ í†µí•´ í¬íŠ¸í´ë¦¬ì˜¤/ì‚¬ì£¼/ì˜¨ë³´ë”© ì •ë³´ë¥¼ ì¡°íšŒ.
  3. ì¡°íšŒ ê²°ê³¼ë¡œ AI ì„œë²„ê°€ ìš”êµ¬í•˜ëŠ” `context` DTOë¥¼ êµ¬ì„± (í¬íŠ¸í´ë¦¬ì˜¤ ìš”ì•½, ìƒìœ„ Nê°œ í¬ì§€ì…˜, ì‚¬ì£¼ ì˜¤í–‰/ë  ë“±).
  4. `AiClient.chat(...)` ë˜ëŠ” `AiClient.oracleAdvice(...)`ë¥¼ í˜¸ì¶œí•´ FastAPI Gatewayì— í”„ë¡ì‹œ.
  5. FastAPIì—ì„œ ì˜¤ëŠ” SSE/ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µì„ ê·¸ëŒ€ë¡œ í”„ë¡ íŠ¸ì— í˜ë ¤ë³´ëƒ„.
  6. í•„ìš” ì‹œ ì§ˆë¬¸/ì‘ë‹µ ìš”ì•½ì„ `ChatHistory`ì— ë¹„ë™ê¸° ì €ì¥.

### 6.4 ChatService & ChatHistory (ëŒ€í™” ì´ë ¥ ì €ì¥)

- ì—”í‹°í‹° ì˜ˆì‹œ: `ChatHistory`
  - `id`, `userId`, `useCase`, `question`, `response`, `model`, `createdAt`
  - PII/ë³´ì•ˆ ì´ìŠˆë¥¼ ê³ ë ¤í•´ **í”„ë¡¬í”„íŠ¸/ì‘ë‹µ ì „ì²´ê°€ ì•„ë‹ˆë¼ ìš”ì•½ ë˜ëŠ” í•´ì‹œ**ë§Œ ì €ì¥í•˜ëŠ” ê²ƒì„ ê¶Œì¥.
- ì„œë¹„ìŠ¤ ì˜ˆì‹œ: `ChatService`
  - `saveHistory(userId, useCase, request, response, modelId)`
  - ë°±ì—”ë“œ ìš”ì²­/ì‘ë‹µ ë¡œê·¸ì™€ ì—°ê³„í•˜ì—¬ AI ì„œë²„ ì‚¬ìš©ëŸ‰/í’ˆì§ˆì„ ë¶„ì„í•  ìˆ˜ ìˆëŠ” ê¸°ë°˜ ì œê³µ.

### 6.5 ì˜¨ë³´ë”©/í¬íŠ¸í´ë¦¬ì˜¤/ì‚¬ì£¼ ì»¨í…ìŠ¤íŠ¸ ìƒì„± ê·œì¹™

- ì˜¨ë³´ë”©/ì‚¬ì£¼:
  - `users.birth_date`, `birth_time`, `gender`, `calendar_type`, `saju_element`, `zodiac_sign`ì„ ê¸°ë°˜ìœ¼ë¡œ  
    `/api/v1/ai/onboarding/summary` ë˜ëŠ” `/api/v1/ai/oracle/advice`ì˜ `saju` ë¸”ë¡ì„ êµ¬ì„±.
- í¬íŠ¸í´ë¦¬ì˜¤:
  - `PortfolioResponse.summary` + ìƒìœ„ Nê°œ í¬ì§€ì…˜ì„ ìš”ì•½í•´ `portfolio.summary`, `portfolio.positions` í•„ë“œì— ë§¤í•‘.
- ë­í‚¹/ê²Œì„:
  - í•„ìš”í•œ ê²½ìš° í˜„ì¬ ë­í‚¹/ì½”ì¸/ì¸ë²¤í† ë¦¬ ì¼ë¶€ë¥¼ contextì— ì¶”ê°€í•  ìˆ˜ ìˆìœ¼ë‚˜,  
    **ìµœì´ˆ ë²„ì „ì—ì„œëŠ” `/oracle` ì¤‘ì‹¬ìœ¼ë¡œ í¬íŠ¸í´ë¦¬ì˜¤+ì‚¬ì£¼ë¥¼ ìš°ì„ **ìœ¼ë¡œ í•œë‹¤.

---

## 7. í”„ë¡ íŠ¸ì—”ë“œ `/oracle` ë° SSE ì—°ë™ ìƒì„¸

> ì´ ì¥ì€ `docs/FRONTEND_DEVELOPMENT_PLAN.md`ì˜ `/oracle`, SSE, `chat-store`, `lib/api/ai.ts` ê´€ë ¨ ë‚´ìš©ì„ í†µí•©í•œ ìŠ¤í™ì…ë‹ˆë‹¤.

### 7.1 ê´€ë ¨ íŒŒì¼/ë¼ìš°íŠ¸ ê°œìš”

- ë¼ìš°íŠ¸:
  - `src/app/(main)/oracle/page.tsx` â€” AI ë„ì‚¬ ë©”ì¸ í˜ì´ì§€.
  - (ì„ íƒ) `ChatbotPopup` ì»´í¬ë„ŒíŠ¸ê°€ ìˆì„ ê²½ìš°, ë™ì¼ API/ìŠ¤í† ì–´ë¥¼ ì¬ì‚¬ìš©.
- ìƒíƒœ ê´€ë¦¬:
  - `src/stores/chat-store.ts` â€” ì±„íŒ… ë©”ì‹œì§€/ë¡œë”©/ìŠ¤íŠ¸ë¦¬ë° ìƒíƒœ ê´€ë¦¬.
- ë„¤íŠ¸ì›Œí¬:
  - `src/lib/api/ai.ts` â€” Spring `/api/v1/chat/ask` SSE í”„ë¡ì‹œ í´ë¼ì´ì–¸íŠ¸.

### 7.2 Chat Store (`src/stores/chat-store.ts`)

- ê¸°ë³¸ ìƒíƒœ:
  - `messages: { text: string; isUser: boolean }[]`
  - `isLoading: boolean`
  - **í†µí•© í›„ í™•ì¥ ìƒíƒœ**:
    - `isStreaming: boolean`
    - `currentUseCase: 'oracle' | 'portfolio_explain' | 'generic'`
    - `error?: string`
- ê¸°ë³¸ ë©”ì‹œì§€:
  - ì²« ì§„ì… ì‹œ ë„ì‚¬ì˜ ì¸ì‚¬ í•œ ë§ˆë””ë¥¼ ì„œë²„ì™€ ë¬´ê´€í•˜ê²Œ ë¡œì»¬ì—ì„œ ë³´ì—¬ì¤€ë‹¤.
    - ì˜ˆ: `"ì•ˆë…•í•˜ì„¸ìš”. ë‚˜ëŠ” ì²œë…„ì„ ì‚´ì•„ì˜¨ íˆ¬ì ë„ì‚¬ë¼ë„¤.\nìë„¤ì˜ íˆ¬ìì™€ ìš´ì„¸ì— ëŒ€í•´ ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ê²Œë‚˜."`
- ì•¡ì…˜:
  - `addMessage(message)`
  - `setLoading(loading)`
  - `clearMessages()`
  - `startStreaming()`, `stopStreaming()`, `setUseCase(useCase)`, `setError(error)`

### 7.3 AI API í´ë¼ì´ì–¸íŠ¸ (`src/lib/api/ai.ts`)

- ê¸°ì¡´ êµ¬í˜„:
  - `AI_API_URL = 'http://localhost:8000'` + `POST /chat`ë¡œ FastAPIë¥¼ ì§ì ‘ í˜¸ì¶œ.
- í†µí•© í›„ ëª©í‘œ:
  - **Base URL**: `NEXT_PUBLIC_API_URL` (Spring ë°±ì—”ë“œ) ê¸°ì¤€.
  - **ì—”ë“œí¬ì¸íŠ¸**: `POST /api/v1/chat/ask` (Spring SSE í”„ë¡ì‹œ).
- í•¨ìˆ˜ ì„¤ê³„:
  - í—¬ìŠ¤ì²´í¬ (ì„ íƒ):
    - `checkAIHealth(): Promise<boolean>` â€” ê°œë°œìš©ìœ¼ë¡œ FastAPI `/health`ë¥¼ ì§ì ‘ í™•ì¸í•  ë•Œ ì‚¬ìš©.
  - ìŠ¤íŠ¸ë¦¬ë° í´ë¼ì´ì–¸íŠ¸:
    - `startOracleChatStream(message: string, callbacks)` í˜•íƒœë¡œ êµ¬í˜„.
    - ë‚´ë¶€ì ìœ¼ë¡œëŠ” `EventSource` ë˜ëŠ” `fetch` + `ReadableStream` ìœ¼ë¡œ SSE(`text/event-stream`)ë¥¼ íŒŒì‹±.
    - SSE í¬ë§· ì˜ˆì‹œ:
      - `event: message` + `data: {"content":"í—ˆí—ˆ, ìë„¤ì˜ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ë³´ë‹ˆ..."}`  
      - `event: done` + `data: {}`  
      - `event: error` + `data: {"error":"AI_001","message":"..."}`  

### 7.4 `/oracle` í˜ì´ì§€ ë™ì‘ í”Œë¡œìš°

1. í˜ì´ì§€ ì§„ì… ì‹œ:
   - `useChatStore`ì—ì„œ ì´ˆê¸° ë©”ì‹œì§€(ë„ì‚¬ ì¸ì‚¬)ë¥¼ ê°€ì ¸ì™€ ë Œë”ë§.
   - (ì„ íƒ) `useUserStore.profile`ì„ ì¡°íšŒí•´ ì‚¬ì£¼/ë‹‰ë„¤ì„ ë“± ê¸°ë³¸ ì •ë³´ë¥¼ ìš°ì¸¡ ì¹´ë“œì— í‘œì‹œ.
2. ì‚¬ìš©ìê°€ ì…ë ¥:
   - ì¸í’‹ì— ì§ˆë¬¸ì„ ì…ë ¥ í›„ Enter ë˜ëŠ” "ì „ì†¡" ë²„íŠ¼ í´ë¦­.
   - ê³µë°±ì´ë©´ ë¬´ì‹œ, ì´ë¯¸ `isStreaming`/`isLoading` ìƒíƒœë©´ ì¤‘ë³µ ì „ì†¡ ë°©ì§€.
3. ë©”ì‹œì§€ ì „ì†¡:
   - `addMessage({ text: userText, isUser: true })`.
   - `startStreaming()` í˜¸ì¶œ í›„ `aiApi.startOracleChatStream` ì‹¤í–‰.
   - í˜„ì¬ êµ¬í˜„ì—ì„œ í”„ë¡œí•„ì˜ ìƒë…„ì›”ì¼ì„ ì§ˆë¬¸ ì•ì— ë¶™ì´ë˜ ë¡œì§ì€,  
     ì‹¤ì œ ìš´ì˜ êµ¬ì¡°ì—ì„œëŠ” Springì´ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì¡°ë¦½í•˜ë¯€ë¡œ **ê°œë°œ/ë””ë²„ê·¸ ëª¨ë“œ ì „ìš©**ìœ¼ë¡œë§Œ ìœ ì§€í•˜ëŠ” ê²ƒì„ ê¶Œì¥.
4. ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬:
   - `onChunk(contentChunk)` ì½œë°±ì—ì„œ ë§ˆì§€ë§‰ assistant ë©”ì‹œì§€ë¥¼ ì ì§„ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸:
     - ì—†ìœ¼ë©´ ìƒˆ assistant ë©”ì‹œì§€ë¥¼ ì¶”ê°€.
     - ìˆìœ¼ë©´ ê¸°ì¡´ í…ìŠ¤íŠ¸ì— ì²­í¬ë¥¼ ì´ì–´ë¶™ì¸ë‹¤.
   - `onDone()`ì—ì„œ `stopStreaming()` ë° `setLoading(false)`.
   - `onError(err)`ì—ì„œ `setError(...)` + ë„ì‚¬ì‹ ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥  
     (ì˜ˆ: `"í—ˆí—ˆ, ê¸°ê°€ ì•½í•´ì ¸ì„œ ëª©ì†Œë¦¬ê°€ ì•ˆ ë“¤ë¦¬ëŠ”êµ¬ë¨¼. ë‹¤ì‹œ ë§í•´ì£¼ê²Œ."`).

### 7.5 UX ê°€ì´ë“œ (ë„ì‚¬ í˜ë¥´ì†Œë‚˜ + ì±…ì„ ê²½ê³ )

- ëª¨ë“  ìµœì¢… assistant ë©”ì‹œì§€ëŠ” ë°˜ë“œì‹œ **íˆ¬ì ì±…ì„ ê²½ê³  ë¬¸êµ¬**ë¥¼ í¬í•¨í•´ì•¼ í•œë‹¤.
  - ì˜ˆ: `"íˆ¬ìì˜ ìµœì¢… ì±…ì„ì€ ìë„¤ì—ê²Œ ìˆë‹¤ë„¤."`
- í”„ë¡ íŠ¸ì—ì„œ:
  - LLM ì‘ë‹µ ë‚´ì— í•´ë‹¹ ë¬¸ì¥ì´ ì—†ë‹¤ë©´ í›„ì²˜ë¦¬ë¡œ í•œ ì¤„ì„ ì¶”ê°€í•˜ê±°ë‚˜, ë³„ë„ ì‘ê²Œ ê³ ì • ë¬¸êµ¬ë¥¼ UI í•˜ë‹¨ì— í‘œì‹œí•  ìˆ˜ ìˆë‹¤.
- ìŠ¤ì¼ˆë ˆí†¤/ë¡œë”©:
  - SSE ìˆ˜ì‹  ì¤‘ì—ëŠ” ì„¸ ê°œì˜ ì ì´ íŠ€ëŠ” ì• ë‹ˆë©”ì´ì…˜(typing indicator)ì„ ì¢Œì¸¡(assistant ìœ„ì¹˜)ì— í‘œì‹œ.

---

## 8. ìš´ì˜ / ë°°í¬ / ê´€ì°°ì„±

### 8.1 Docker / Compose êµ¬ì¡° (ê°œìš”)

- `ai-gateway` (FastAPI)
  - í¬íŠ¸: 9000
  - ì˜ì¡´: `vllm-llama8b`, `vllm-dolphin8b`, `llama-cpu`
- `vllm-llama8b`
  - í¬íŠ¸: 8001, GPU ì‚¬ìš©
- `vllm-dolphin8b`
  - í¬íŠ¸: 8002, GPU ì‚¬ìš©
- `llama-cpu`
  - í¬íŠ¸: 8003, CPU-only

> ì‹¤ì œ `docker-compose.yml` ë˜ëŠ” K8s ë§¤ë‹ˆí˜ìŠ¤íŠ¸ëŠ” ì´ êµ¬ì¡°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë³„ë„ ì‘ì„±í•œë‹¤.

### 8.2 ì„¤ì • / ë¹„ë°€ ê´€ë¦¬

- `.env` ì˜ˆì‹œ

```env
AI_INTERNAL_SECRET=change-me
AI_LLAM8B_MODEL_PATH=/models/llama3.1-8b-instruct
AI_DOLPHIN_MODEL_PATH=/models/dolphin3.0-llama3.1-8b
AI_GPT20B_MODEL_PATH=/models/gpt-oss-20b
AI_CPU_MODEL_PATH=/models/tiny-llama-1.1b
AI_MAX_CONCURRENT_REQUESTS=16
```

### 8.3 ë¡œê¹… / ëª¨ë‹ˆí„°ë§

- ë¡œê·¸
  - ìš”ì²­ ë©”íƒ€: `userId`, `useCase`, `model`, `latency_ms`, `tokens_prompt`, `tokens_completion`.
  - í”„ë¡¬í”„íŠ¸/ì‘ë‹µ ì›ë¬¸ì€ PII/ë³´ì•ˆ ì´ìŠˆë¡œ **ìš”ì•½ ë˜ëŠ” í•´ì‹œ**ë§Œ ë‚¨ê¸´ë‹¤.
- ë©”íŠ¸ë¦­
  - ëª¨ë¸ë³„ QPS, í‰ê· /95p/99p latency.
  - ì—ëŸ¬ ì½”ë“œë³„ ì¹´ìš´íŠ¸(`AI_001~AI_004` ë“±).
  - GPU ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰/ì˜¨ë„ (Prometheus + nvidia exporter ì—°ê³„).

