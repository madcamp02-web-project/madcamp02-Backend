package com.madcamp02.dto.response;

//Response란?
//함수(Function)가 아니라, 클래스(Class)입니다.
//서버가 프론트엔드에게 대답할 때 사용하는 편지지 양식(Response DTO)

//Response란? --> 백엔드 서버가 클라이언트에게 보내줄때 쓰는 템플릿이라고 생각하면 됨.
//DTO(request)를 작성하고 요청에 대한 서식을 하나 지정을 해줘야 할꺼 아냐?
//그 요청에 대한 응답의 json 템플릿이 이 객체임.

/*
이 코드는 **함수(Function)가 아니라, 클래스(Class)**입니다. 더 정확히 말하면 **"서버가 프론트엔드에게 대답할 때 사용하는 편지지 양식(Response DTO)"**입니다.

질문하신 **"Response는 뭐하는 역할인가?"**에 대해 핵심만 짚어 드릴게요.

---

### 1. 함수가 아니라 '그릇'입니다 🥣

* **Service, Controller:** 얘네들이 **함수(로직)**입니다. 요리를 하고, 계산을 합니다.
* **AuthResponse:** 얘는 **그릇(데이터)**입니다. 요리가 완성되면 이 그릇에 담아서 손님(프론트엔드)에게 내보냅니다.

즉, 이 코드는 **"우리 서버는 로그인 성공하면 무조건 이런 모양의 데이터를 줄 거야!"**라고 미리 약속해 놓은 설계도입니다.

---

### 2. Node.js와 비교하면 단박에 이해됩니다 ⚡️

님께서 익숙한 Node.js(Express)에서는 보통 이렇게 응답을 보냅니다.

**Node.js (Express) 스타일:**

            ```javascript
            // 그때그때 객체를 만들어서 보냄 (자유로움)
            res.json({
                accessToken: "토큰...",
                userId: 1,
                nickname: "철수",
                isNewUser: true
            });
            ```

**Spring Boot 스타일 (`AuthResponse` 사용):**
스프링은 엄격해서, 미리 클래스를 만들어 둬야 합니다.

            ```java
            // AuthResponse라는 미리 만들어둔 틀에 데이터를 채워서 보냄 (안전함)
            return AuthResponse.builder()
                    .accessToken("토큰...")
                    .userId(1L)
                    .nickname("철수")
                    .isNewUser(true)
                    .build();

            ```

**차이점:**

* **Node.js:** 개발자가 `nitname`이라고 오타를 내도 서버는 그냥 보냅니다. (프론트에서 에러 남)
* **Spring:** `AuthResponse`에 없는 필드를 넣으려고 하면 **컴파일 에러(빨간 줄)**가 나서 서버 실행조차 안 됩니다. **실수를 원천 봉쇄**하는 역할입니다.

---

### 3. 이 '편지지(Response)'의 구성 요소 분석(내 코드에 대한 분석)

이 `AuthResponse` 안에는 크게 3가지 덩어리의 정보가 담겨서 나갑니다.

#### A. 출입증 (토큰 정보) 🔑

* `accessToken`: 당장 API 쓸 때 필요한 짧은 출입증.
* `refreshToken`: 나중에 출입증 만료되면 재발급받을 때 쓰는 교환권.
* `expiresIn`: "1시간 뒤에 만료돼요"라고 알려주는 타이머용 숫자.

#### B. 신분증 (사용자 정보) 🪪

* `userId`, `email`, `nickname`: 화면 상단에 "반갑습니다, OOO님!" 띄워줄 때 필요한 정보들.
* `sajuElement`, `avatarUrl`: 이 앱만의 특수 정보(사주 오행, 캐릭터).

#### C. 안내 표지판 (상태 정보) 🚩

* `isNewUser`: 이게 **프론트엔드 개발자에게 가장 중요한 정보**입니다.
* `true`면?  "아, 처음 왔구나. **온보딩(생년월일 입력) 화면**으로 이동시켜야지."
* `false`면?  "기존 회원이네. 바로 **메인 화면**으로 보내야지."


서버가 이 값을 `Response`에 담아주기 때문에, 프론트엔드가 **화면 전환 로직**을 짤 수 있는 것입니다.

---

### 요약: Response의 역할

> **"Request(요청)"가 손님의 주문서라면,**
> **"Response(응답)"는 주방에서 나온 완성된 요리 쟁반입니다.**

이 `AuthResponse` 클래스는 **"우리 식당은 요리 쟁반에 토큰, 닉네임, 신규유저여부 딱 3가지만 담아서 나갑니다"**라고 정해둔 **쟁반 규격**입니다.
*/







//======================================
// AuthResponse - 인증 응답 DTO
//======================================
// 서버 → 클라이언트로 전송되는 인증 결과 데이터 구조
//
// 사용 시점:
//   - POST /api/v1/auth/login 응답
//   - POST /api/v1/auth/refresh 응답
//   - GET /api/v1/auth/me 응답
//
// 포함 정보:
//   1. 토큰 정보 (accessToken, refreshToken, expiresIn)
//   2. 사용자 정보 (userId, email, nickname 등)
//   3. 상태 정보 (isNewUser)
//
// 클라이언트 활용:
//   - accessToken: API 요청 시 Authorization 헤더에 포함
//   - refreshToken: 토큰 만료 시 갱신용으로 안전하게 저장
//   - isNewUser: true면 온보딩(생년월일 입력) 화면으로 이동
//======================================

import lombok.Builder;
import lombok.Getter;
import java.time.LocalDate;

@Getter
@Builder
public class AuthResponse {

    //==========================================
    // 토큰 정보
    //==========================================

    //------------------------------------------
    // Access Token
    //------------------------------------------
    // API 요청 시 인증에 사용하는 JWT
    //
    // 사용 방법:
    //   Authorization: Bearer {accessToken}
    //
    // 특징:
    //   - 유효기간: 1시간
    //   - Payload에 userId, email, nickname 포함
    //   - 탈취되어도 금방 만료되어 피해 최소화
    //------------------------------------------
    private String accessToken;

    //------------------------------------------
    // Refresh Token
    //------------------------------------------
    // Access Token 재발급용 토큰
    //
    // 저장 위치 권장:
    //   - 웹: HttpOnly Cookie (XSS 방지)
    //   - 모바일: Secure Storage
    //
    // 특징:
    //   - 유효기간: 7일
    //   - 서버 Redis에도 저장됨 (검증용)
    //   - 한 번 사용하면 새 토큰으로 교체됨
    //------------------------------------------
    private String refreshToken;

    //------------------------------------------
    // 만료 시간 (초)
    //------------------------------------------
    // Access Token 만료까지 남은 시간
    // 클라이언트가 타이머 설정에 활용 가능
    //------------------------------------------
    private Integer expiresIn;

    //==========================================
    // 사용자 정보
    //==========================================

    //------------------------------------------
    // 사용자 고유 ID (PK)
    //------------------------------------------
    private Long userId;

    //------------------------------------------
    // 생년월일 (온보딩 기준 필드)
    //------------------------------------------
    // - null: 온보딩 미완료 또는 아직 입력 전
    // - 값 존재: 온보딩을 통해 기본 프로필이 확정된 상태
    // 프론트의 hasCompletedOnboarding(user) 헬퍼가
    // birthDate + sajuElement 조합으로 온보딩 완료 여부를 판별하므로,
    // /auth/me 응답에는 반드시 이 필드를 포함해 줘야 한다.
    //------------------------------------------
    private LocalDate birthDate;

    //------------------------------------------
    // 이메일
    //------------------------------------------
    // Google 계정 이메일 (고유, 변경 불가)
    //------------------------------------------
    private String email;

    //------------------------------------------
    // 닉네임
    //------------------------------------------
    // 앱 내 표시 이름 (수정 가능)
    //------------------------------------------
    private String nickname;

    //------------------------------------------
    // 사주 오행
    //------------------------------------------
    // 생년월일 기반 계산 결과
    // 예: "wood", "fire", "earth", "metal", "water"
    // null이면 온보딩 미완료 상태
    //------------------------------------------
    private String sajuElement;

    //------------------------------------------
    // 아바타 URL
    //------------------------------------------
    // 사용자 프로필 이미지 경로
    // 가챠로 획득한 아이템 적용 가능
    //------------------------------------------
    private String avatarUrl;

    //==========================================
    // 상태 정보
    //==========================================

    //------------------------------------------
    // 신규 사용자 여부
    //------------------------------------------
    // true: 첫 로그인 → 온보딩 화면으로 이동
    // false: 기존 사용자 → 메인 화면으로 이동
    //
    // 온보딩에서 입력받는 정보:
    //   - 생년월일 (사주 계산용)
    //   - 닉네임 (선택사항)
    //------------------------------------------
    private Boolean isNewUser;
}
